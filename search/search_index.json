{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Welcome to Ganesh Documents","text":""},{"location":"index.html#overview","title":"Overview","text":"<p>This the documets where all the Cloud, DevOps, DevSecOps, Security, Compliance, Micro service related information is prepared by Ganesh kinkar giri.</p>"},{"location":"index.html#below-are-the-document-present","title":"Below are the document present.","text":"<ul> <li>Cloud</li> <li>DevOps</li> <li>DevSecOps</li> <li>Security</li> <li>Compliance</li> <li>Micro service</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html","title":"AZ-500: Microsoft Certified: Azure Security Engineer Associate","text":""},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#implement-platform-protection","title":"Implement platform protection","text":"<ol> <li>Implement perimeter security<ul> <li>Introduction</li> <li>Define defense in depth</li> <li>Explore virtual network security</li> <li>Enable Distributed Denial of Service (DDoS) Protection</li> <li>Configure a distributed denial of service protection implementation</li> <li>Explore Azure Firewall features</li> <li>Deploy an Azure Firewall implementation</li> <li>Configure VPN forced tunneling</li> <li>Create User Defined Routes and Network Virtual Appliances</li> <li>Explore hub and spoke topology</li> <li>Perform try-this exercises</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> <li>Configure network security<ul> <li>Introduction</li> <li>Explore Network Security Groups (NSG)</li> <li>Deploy a Network Security Groups implementation</li> <li>Create Application Security Groups</li> <li>Enable service endpoints</li> <li>Configure service endpoint services</li> <li>Deploy private links</li> <li>Implement an Azure application gateway</li> <li>Deploy a web application firewall</li> <li>Configure and manage Azure front door</li> <li>Review ExpressRoute</li> <li>Perform try-this exercises</li> <li>Knowledge check</li> <li>Summary 3 Configure and manage host security</li> <li>Introduction</li> <li>Enable endpoint protection</li> <li>Define a privileged access device strategy</li> <li>Deploy privileged access workstations</li> <li>Create virtual machine templates</li> <li>Enable and secure remote access management</li> <li>Configure update management</li> <li>Deploy disk encryption</li> <li>Managed disk encryption options</li> <li>Deploy and configure Windows Defender</li> <li>Microsoft cloud security benchmark in Defender for Cloud</li> <li>Explore Microsoft Defender for Cloud recommendations</li> <li>Perform Try-This exercises</li> <li>Knowledge check</li> <li>Summary 4 Enable Containers security</li> <li>Introduction</li> <li>Explore containers</li> <li>Configure Azure Container Instances security</li> <li>Manage security for Azure Container Instances (ACI)\u200b</li> <li>Explore the Azure Container Registry (ACR)</li> <li>Enable Azure Container Registry authentication</li> <li>Review Azure Kubernetes Service (AKS)</li> <li>Implement an Azure Kubernetes Service architecture\u200b</li> <li>Configure Azure Kubernetes Service networking</li> <li>Deploy Azure Kubernetes Service storage\u200b</li> <li>Secure authentication to Azure Kubernetes Service with Active Directory</li> <li>Manage access to Azure Kubernetes Service using Azure role-based access controls</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#introduction","title":"Introduction","text":"<p>Think of security in layers. You need to lock down the perimeter first, and then work your way inward locking down each layer. The more work and cost a bad-actor has to invest to get to valuable information the more likely they are to leave you alone.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#scenario","title":"Scenario","text":"<p>A security engineer uses perimeter security features to block network traffic away from your primary network resources; you will work on such tasks as:</p> <ul> <li>Setup DDoS (denial-of-service) Protection.</li> <li>Configure and maintain firewalls.</li> <li>Use dedicated routes and network appliance to protect your network.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#define-defense-in-depth","title":"Define defense in depth","text":"<p>The Defense in depth approach includes other controls in the design to mitigate risk to the organization in the event a primary security control fails. This design should consider how likely the primary control is to fail, the potential organizational risk if it does, and the effectiveness of the additional control (especially in the likely cases that would cause the primary control to fail).</p> <p>During this module, we will explore the defense-in-depth design of Azure services and capabilities to help you securely manage and monitor your cloud data and infrastructure as a managed service. Microsoft designs and operates its cloud services with security at the core and provides you built-in controls and tools to meet your security needs. In addition, with Machine Learning (ML) and Microsoft's significant investments in cyber defense you can benefit from unique intelligence and proactive measures to protect you from threats. Azure offers unified security management and advanced threat protection for your resources whether they're in the cloud, your data center, or both. Each Service in Azure is built with security in mind from the ground up to host your infrastructure apps and data. All services are designed and operated to support multiple layers of defense, spanning your data apps, virtual machines, network perimeter-related policies, and physical security within our data centers. Including how the data sensors and systems that run Azure are architected and operated to the controls you can apply as part of your defense in-depth security management. An example strategy is illustrated in the following image.</p> <p></p> <p>As more of a company\u2019s digital resources reside outside the corporate network, in the cloud and on personal devices, it becomes obvious that a perimeter only based security, i.e. firewalls, DMZ, VNets, are no longer adequate. The adoption of software-defined networking (SDN) and software-defined data center (SDDC) technologies are driving Network Segmentation concepts to be more granular, i.e. Network Micro-Segmentation.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#network-micro-segmentation","title":"Network Micro-Segmentation","text":"<p>Micro-segmentation is a way to create secure zones in data centers and Azure deployments that allow you to isolate workloads and protect them individually. Security policies in a virtual environment can be assigned to virtual connections that can move with an application if the network is reconfigured \u2013 making the security policy persistent.</p> <p>A best practice recommendation is to adopt a Zero Trust strategy based on user, device, and application identities. In contrast to network access controls that are based on elements such as source and destination IP address, protocols, and port numbers, Zero Trust enforces and validates access control at \u201caccess time\u201d. Granting access at access-time avoids the need to play a prediction game for an entire deployment, network, or subnet \u2013 only the destination resource needs to provide the necessary access controls.</p> <ul> <li>Azure Network Security Groups can be used for basic layer 3 &amp; 4 access controls between Azure Virtual Networks, their subnets, and the Internet.</li> <li>Application Security Groups enable you to define fine-grained network security policies based on workloads, centralized on applications, instead of explicit IP addresses.</li> <li>Azure Web Application Firewall and the Azure Firewall can be used for more advanced network access controls that require application layer support.</li> <li>Local Admin Password Solution (LAPS) or a third-party Privileged Access Management can set strong local admin passwords and just in time access to them.</li> </ul> <p>Additionally, third parties offer micro-segmentation approaches that may enhance your network controls by applying zero trust principles to networks you control with legacy assets on them.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#explore-virtual-network-security","title":"Explore virtual network security","text":""},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#azure-networking-components","title":"Azure Networking Components","text":"<p>The following sections define key terminology for Azure networking. Later, this course will cover each of these areas in more detail.</p> <p>Azure Virtual Networks are a key component of Azure security services. The Azure network infrastructure enables you to securely connect Azure resources to each other with virtual networks (VNets). A VNet is a representation of your own network in the cloud. A VNet is a logical isolation of the Azure cloud network dedicated to your subscription. You can connect VNets to your on-premises networks.</p> <p></p> <p>Azure supports dedicated WAN link connectivity to your on-premises network and an Azure Virtual Network with ExpressRoute. The link between Azure and your site uses a dedicated connection that does not go over the public Internet. If your Azure application is running in multiple datacenters, you can use Azure Traffic Manager to route requests from users intelligently across instances of the application. You can also route traffic to services not running in Azure if they are accessible from the Internet.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#virtual-networks","title":"Virtual networks","text":"<p>Organizations can use virtual networks to connect resources. Virtual networks in Azure are network overlays that you can use to configure and control the connectivity among Azure resources, such as VMs and load balancers.</p> <p>Azure Virtual Network enables many types of Azure resources, such as Azure Virtual Machines (VM), to securely communicate with each other, the internet, and on-premises networks. A virtual network is scoped to a single Azure region. An Azure region is a set of datacenters deployed within a latency-defined perimeter and connected through a dedicated regional low-latency network.</p> <p>Virtual networks are made up of subnets. A subnet is a range of IP addresses within your virtual network. Subnets, like virtual networks, are scoped to a single Azure region. You can implement multiple virtual networks within each Azure subscription and Azure region. Each virtual network is isolated from other virtual networks. For each virtual network you can:</p> <ul> <li>Specify a custom private IP address space using public and private addresses. Azure assigns resources in a virtual network a private IP address from the address space that you assign.</li> <li>Segment the virtual network into one or more subnets and allocate a portion of the virtual network's address space to each subnet.</li> <li>Use Azure-provided name resolution, or specify your own DNS server, for use by resources in a virtual network.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#ip-addresses","title":"IP addresses","text":"<p>VMs, Azure load balancers, and application gateways in a single virtual network require unique Internet Protocol (IP) addresses the same way that clients in an on-premises subnet do. This enables these resources to communicate with each other. A virtual network uses two types of IP addresses:</p> <ul> <li>Private - A private IP address is dynamically or statically allocated to a VM from the defined scope of IP addresses in the virtual network. VMs use these addresses to communicate with other VMs in the same or connected virtual networks through a gateway / Azure ExpressRoute connection. These private IP addresses, or non-routable IP addresses, conform to RFC 1918.</li> <li>Public - Public IP addresses, which allow Azure resources to communicate with external clients, are assigned directly at the virtual network adapter of the VM or to the load balancer. Public IP address can also be added to Azure-only virtual networks. All IP blocks in the virtual network will be routable only within the customer's network, and they won't be reachable from outside. Virtual network packets travel through the high-speed Azure backplane.</li> </ul> <p>You can control the dynamic IP addresses assigned to VMs and cloud services within an Azure virtual network by specifying an IP addressing scheme. Planning an IP addressing scheme within an Azure virtual network is much like planning an IP addressing scheme on-premises. The same ranges are often used, and the same rules applied. However, conditions exist that are unique to Azure virtual networks.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#subnets","title":"Subnets","text":"<p>You can further divide your network by using subnets for the logical and security-related isolation of Azure resources. Each subnet contains a range of IP addresses that fall within the virtual network address space. Subnetting hides the details of internal network organization from external routers. Subnetting also segments the host within the network, making it easier to apply network security at the interconnections between subnets.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#network-adapters","title":"Network adapters","text":"<p>VMs communicate with other VMs and other resources on the network by using virtual network adapters. Virtual network adapters configure VMs with private and, optionally, public IP address. A VM can have more than one network adapter for different network configurations.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#enable-distributed-denial-of-service-ddos-protection","title":"Enable Distributed Denial of Service (DDoS) Protection","text":"<p>A denial of service attack (DoS) is an attack that has the goal of preventing access to services or systems. If the attack originates from one location, it is called a DoS. If the attack originates from multiple networks and systems, it is called distributed denial of service (DDoS).</p> <p>Before learning more about DDoS, you need to know what botnets are. Botnets are collections of internet-connected systems that an individual controls and uses without their owners\u2019 knowledge. Botnet owners use them to perform various actions of their choosing.</p> <p>Often, they use them for spamming, data storage, DDoS, or various other actions that are up to the person in control of the botnet. In the past, botnets were made up just of compromised computers, but now, botnets are also made up of Internet of Things (IoT) devices. Malicious hackers can get these poorly secured security cameras, digital video recorders, thermostats, and other internet-connected devices under their control.</p> <p>So, DDoS is a collection of attack types aimed at disrupting the availability of a target. These attacks involve a coordinated effort that uses multiple internet-connected systems to launch many network requests against DNS, web services, email, and more. Pretty much any application that the malicious hacker can access might become the target of a DDoS. The malicious hacker\u2019s goal is to overwhelm system resources on targeted servers so they can no longer process legitimate traffic, effectively making the system inaccessible.</p> <p>A DDoS generally involves many systems sending traffic to targets as part of a botnet. In most cases, the owners of the systems in a botnet don\u2019t know that their devices are compromised and participating in an attack. Botnets are becoming a bigger problem than before because of the increasing numbers of connected devices.</p> <p>Designing and building for DDoS resiliency requires planning and designing for a variety of failure modes. The following table lists the best practices for building DDoS-resilient services in Azure.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#best-practice-1","title":"Best practice 1","text":"<p>Ensure that security is a priority throughout the entire lifecycle of an application, from design and implementation to deployment and operations. Applications might have bugs that allow a relatively low volume of requests to use a lot of resources, resulting in a service outage.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#solution-1","title":"Solution 1","text":"<p>To help protect a service running in Azure, understand your application architecture, and focus on the five pillars of software quality. They are:</p> Pillar Description Scalability The ability of a system to handle increased load Availability The proportion of time that a system is functional and   working Resiliency The ability of a system to recover from failures and   continue to function Management Operations processes that keep a system running in   production Security Protecting applications and data from threats <p>You should know typical traffic volumes, the connectivity model between the application and other applications, and the service endpoints that are exposed to the public internet.</p> <p>Helping ensure that an application is resilient enough to handle a DoS targeted at the application itself is most important. Security and privacy features are built in to the Azure platform, beginning with the Microsoft Security Development Lifecycle (SDL). The SDL addresses security at every development phase and ensures that Azure is continually updated to make it even more secure. We will look at SDL later in this course.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#best-practice-2","title":"Best practice 2","text":"<p>Design your applications to scale horizontally to meet the demands of an amplified load\u2014specifically, in the event of a DDoS. If your application depends on a single instance of a service, it creates a single point of failure. Provisioning multiple instances makes your system more resilient and more scalable.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#solution-2","title":"Solution 2","text":"<p>For Azure App Service, select an App Service plan that offers multiple instances. For Azure Cloud Services, configure each of your roles to use multiple instances. For Azure Virtual Machines, ensure that your VM architecture includes more than one VM and that each VM is included in an availability set. We recommend using virtual machine scale sets for autoscaling capabilities.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#best-practice-3","title":"Best practice 3","text":"<p>Layer security defenses in an application to reduce the chance of a successful attack. Implement security-enhanced designs for your applications by using the built-in capabilities of the Azure platform.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#solution-3","title":"Solution 3","text":"<p>Be aware that the risk of attack increases with the size, or surface area, of the application. You can reduce the surface area by using IP allowlists to close down the exposed IP address space and listening ports that aren\u2019t needed on the load balancers (for Azure Load Balancer and Azure Application Gateway).</p> <p>You can also use NSGs to reduce the attack surface. You can use service tags and application security groups as a natural extension of an application\u2019s structure to minimize complexity for creating security rules and configuring network security.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#configure-a-distributed-denial-of-service-protection-implementation","title":"Configure a distributed denial of service protection implementation","text":"<p>Azure Distributed Denial of Service (DDoS) protection, combined with application design best practices, provide defense against DDoS attacks. Azure DDoS protection provides the following service tiers:</p> <ul> <li>Basic: Automatically enabled as part of the Azure platform. Always-on traffic monitoring, and real-time mitigation of common network-level attacks, provide the same defenses utilized by Microsoft's online services. The entire scale of Azure's global network can be used to distribute and mitigate attack traffic across regions. Protection is provided for IPv4 and IPv6 Azure public IP addresses.</li> <li>Standard: Provides additional mitigation capabilities over the Basic service tier that are tuned specifically to Azure Virtual Network resources. DDoS Protection Standard is simple to enable, and requires no application changes. Protection policies are tuned through dedicated traffic monitoring and machine learning algorithms. Policies are applied to public IP addresses associated to resources deployed in virtual networks, such as Azure Load Balancer, Azure Application Gateway, and Azure Service Fabric instances, but this protection does not apply to App Service Environments. Real-time telemetry is available through Azure Monitor views during an attack, and for history. Rich attack mitigation analytics are available via diagnostic settings. Application layer protection can be added through the Azure Application Gateway Web Application Firewall or by installing a 3rd party firewall from Azure Marketplace. Protection is provided for IPv4 and IPv6 Azure public IP addresses.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#how-azure-denial-of-service-protection-works","title":"How Azure denial-of-service protection works","text":"<p>DDoS Protection Standard monitors actual traffic utilization and constantly compares it against the thresholds defined in the DDoS policy. When the traffic threshold is exceeded, DDoS mitigation is automatically initiated. When traffic returns to a level below the threshold, the mitigation is removed.</p> <p></p> <p>During mitigation, DDoS Protection redirects traffic sent to the protected resource and performs several checks, including:    - Helping ensure that packets conform to internet specifications and aren\u2019t malformed.    - Interacting with the client to determine if the traffic might be a spoofed packet (for example, using SYN Auth or SYN Cookie or dropping a packet for the source to retransmit it).    - Using rate-limit packets if it can\u2019t perform any other enforcement method.</p> <p>DDoS Protection blocks attack traffic and forwards the remaining traffic to its intended destination. Within a few minutes of attack detection, you\u2019ll be notified with Azure Monitor metrics. By configuring logging on DDoS Protection Standard telemetry, you can write the logs to available options for future analysis. Azure Monitor retains metric data for DDoS Protection Standard for 30 days.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#types-of-denial-of-service-attacks-that-azure-protection-mitigates","title":"Types of denial-of-service attacks that Azure protection mitigates","text":"<p>DDoS Protection Standard can mitigate the following types of attacks:</p> <ul> <li>Volumetric attacks: The attack's goal is to flood the network layer with a substantial amount of seemingly legitimate traffic. It includes UDP floods, amplification floods, and other spoofed-packet floods. DDoS Protection Standard mitigates these potential multi-gigabyte attacks by absorbing and scrubbing them, with Azure's global network scale, automatically.</li> <li>Protocol attacks: These attacks render a target inaccessible, by exploiting a weakness in the layer 3 and layer 4 protocol stack. It includes, SYN flood attacks, reflection attacks, and other protocol attacks. DDoS Protection Standard mitigates these attacks, differentiating between malicious and legitimate traffic, by interacting with the client, and blocking malicious traffic.</li> <li>Resource (application) layer attacks: These attacks target web application packets, to disrupt the transmission of data between hosts. The attacks include HTTP protocol violations, SQL injection, cross-site scripting, and other layer 7 attacks. Use a Web Application Firewall, such as the Azure Application Gateway web application firewall, as well as DDoS Protection Standard to provide defense against these attacks. There are also third-party web application firewall offerings available in the Azure Marketplace.</li> </ul> <p> Important</p> <pre><code>DDoS Protection Standard protects resources in a virtual network including public IP addresses associated with virtual machines, load balancers, and application gateways. When coupled with the Application Gateway web application firewall, or a third-party web application firewall deployed in a virtual network with a public IP, DDoS Protection Standard can provide full layer 3 to layer 7 mitigation capability.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#explore-azure-firewall-features","title":"Explore Azure Firewall features","text":"<p>Azure Firewall is a managed, cloud-based network security service that protects your Azure Virtual Network resources. It\u2019s a fully stateful firewall-as-a-service with built-in high availability and unrestricted cloud scalability. By default, Azure Firewall blocks traffic.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#the-azure-firewall-features-include","title":"The Azure firewall features include","text":"<ul> <li>Built-in high availability - Because high availability is built in, no additional load balancers are required and there\u2019s nothing you need to configure.</li> <li>Unrestricted cloud scalability - Azure Firewall can scale up as much as you need, to accommodate changing network traffic flows so you don't need to budget for your peak traffic.</li> <li>Application Fully Qualified Domain Name (FQDN) filtering rules - You can limit outbound HTTP/S traffic to a specified list of FQDNs, including wild cards. This feature does not require SSL termination.</li> <li>Network traffic filtering rules - You can centrally create allow or deny network filtering rules by source and destination IP address, port, and protocol. Azure Firewall is fully stateful, so it can distinguish legitimate packets for different types of connections. Rules are enforced and logged across multiple subscriptions and virtual networks.</li> <li>Qualified domain tags - Fully Qualified Domain Names (FQDN) tags make it easier for you to allow well known Azure service network traffic through your firewall. For example, say you want to allow Windows Update network traffic through your firewall. You create an application rule and include the Windows Update tag. Now network traffic from Windows Update can flow through your firewall.</li> <li>Outbound Source Network Address Translation (OSNAT) support - All outbound virtual network traffic IP addresses are translated to the Azure Firewall public IP. You can identify and allow traffic originating from your virtual network to remote internet destinations.</li> <li>Inbound Destination Network Address Translation (DNAT) support - Inbound network traffic to your firewall public IP address is translated and filtered to the private IP addresses on your virtual networks.    -Azure Monitor logging- All events are integrated with Azure Monitor, allowing you to archive logs to a storage account, stream events to your Event Hub, or send them to Azure Monitor logs.</li> </ul> <p>Grouping the features above into logical groups reveals that Azure Firewall has three rule types: NAT rules, network rules, and application rules. The application order precedence for the rules are that network rules are applied first, then application rules. Rules are terminating, which means if a match is found in network rules, then application rules are not processed. If there\u2019s no network rule match, and if the packet protocol is HTTP/HTTPS, the packet is then evaluated by the application rules. If no match continues to be found, then the packet is evaluated against the infrastructure rule collection. If there\u2019s still no match, then the packet is denied by default.</p> <p>NAT rules</p> <p>You can configure inbound connectivity by configuring Destination Network Address Translation (DNAT) as described in: Filter inbound traffic with Azure Firewall DNAT using the Azure portal. DNAT rules are applied first. If a match is found, an implicit corresponding network rule to allow the translated traffic is added. You can override this behavior by explicitly adding a network rule collection with deny rules that match the translated traffic. No application rules are applied for these connections.</p> <p>Firewall rules to secure Azure Storage</p> <p>Azure Storage provides a layered security model, which enables you to secure your storage accounts to a specific set of supported networks. When network rules are configured, only applications requesting data from over the specified set of networks can access a storage account.</p> <p>An application that accesses a storage account when network rules are in effect requires proper authorization on the request. Authorization is supported with Azure AD credentials for blobs and queues, a valid account access key, or a SAS token.</p> <p>By default, storage accounts accept connections from clients on any network. To limit access to selected networks, you must first change the default action. Making changes to network rules can impact your applications' ability to connect to Azure Storage. Setting the default network rule to Deny blocks all access to the data unless specific network rules that grant access are also applied. Be sure to grant access to any allowed networks using network rules before you change the default rule to deny access.</p> <p>Grant access from a virtual network</p> <p>You can configure storage accounts to allow access only from specific VNets.</p> <p>You enable a service endpoint for Azure Storage within the VNet. This endpoint gives traffic an optimal route to the Azure Storage service. The identities of the virtual network and the subnet are also transmitted with each request. Administrators can then configure network rules for the storage account that allow requests to be received from specific subnets in the VNet. Clients granted access via these network rules must continue to meet the authorization requirements of the storage account to access the data.</p> <p>Each storage account supports up to 100 virtual network rules, which could be combined with IP network rules.</p> <p>Controlling outbound and inbound network access is an important part of an overall network security plan. Network traffic is subjected to the configured firewall rules when you route your network traffic to the firewall as the default gateway.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#deploy-an-azure-firewall-implementation","title":"Deploy an Azure Firewall implementation","text":"<p>Controlling outbound network access is an important part of an overall network security plan. For example, you may want to limit access to web sites. Or, you may want to limit the outbound IP addresses and ports that can be accessed.</p> <p>One way you can control outbound network access from an Azure subnet is with Azure Firewall. With Azure Firewall, you can configure:</p> <ul> <li>Application rules that define fully qualified domain names (FQDNs) that can be accessed from a subnet.</li> <li>Network rules that define source address, protocol, destination port, and destination address.</li> </ul> <p>Network traffic is subjected to the configured firewall rules when you route your network traffic to the firewall as the subnet default gateway.</p> <p></p> <p>Fully Qualified Domain Name (FQDN) tag</p> <p>An FQDN tag represents a group of fully qualified domain names (FQDNs) associated with well known Microsoft services. You can use an FQDN tag in application rules to allow the required outbound network traffic through your firewall.</p> <p>For example, to manually allow Windows Update network traffic through your firewall, you need to create multiple application rules per the Microsoft documentation. Using FQDN tags, you can create an application rule, include the Windows Updates tag, and now network traffic to Microsoft Windows Update endpoints can flow through your firewall.</p> <p>Infrastructure qualified domain names</p> <p>Azure Firewall includes a built-in rule collection for infrastructure FQDNs that are allowed by default. These FQDNs are specific for the platform and can't be used for other purposes.</p> <p>The following services are included in the built-in rule collection:</p> <ul> <li>Compute access to storage Platform Image Repository (PIR)</li> <li>Managed disks status storage access</li> <li>Azure Diagnostics and Logging (MDS)</li> </ul> <p>Logs and metrics</p> <p>You can monitor Azure Firewall using firewall logs. You can also use activity logs to audit operations on Azure Firewall resources.</p> <p>You can access some of these logs through the portal. Logs can be sent to Azure Monitor logs, Storage, and Event Hubs and analyzed in Azure Monitor logs or by different tools such as Excel and Power BI.</p> <p>Metrics are lightweight and can support near real-time scenarios making them useful for alerting and fast issue detection.</p> <p>Threat intelligence-based filtering</p> <p>Threat intelligence-based filtering can be enabled for your firewall to alert and deny traffic from/to known malicious IP addresses and domains. The IP addresses and domains are sourced from the Microsoft Threat Intelligence feed. Intelligent Security Graph powers Microsoft threat intelligence and is used by multiple services including Microsoft Defender for Cloud. If you've enabled threat intelligence-based filtering, the associated rules are processed before any of the NAT rules, network rules, or application rules.</p> <p>You can choose to just log an alert when a rule is triggered, or you can choose alert and deny mode. By default, threat intelligence-based filtering is enabled in alert mode.</p> <p>Rule processing logic You can configure NAT rules, network rules, and applications rules on Azure Firewall. Rule collections are processed according to the rule type in priority order, lower numbers to higher numbers from 100 to 65,000. A rule collection name can have only letters, numbers, underscores, periods, or hyphens. It must begin with a letter or number, and end with a letter, number or underscore. The maximum name length is 80 characters.</p> <p>It's best to initially space your rule collection priority numbers in 100 increments (100, 200, 300, and so on) so you have room to add more rule collections if needed.</p> <p>Service tags</p> <p>A service tag represents a group of IP address prefixes to help minimize complexity for security rule creation. You cannot create your own service tag, nor specify which IP addresses are included within a tag. Microsoft manages the address prefixes encompassed by the service tag, and automatically updates the service tag as addresses change.</p> <p>Azure Firewall service tags can be used in the network rules destination field. You can use them in place of specific IP addresses.</p> <p>Remote work support</p> <p>VDI</p> <p>Work from home policies requires many IT organizations to address fundamental changes in capacity, network, security, and governance. Employees aren't protected by the layered security policies associated with on-premises services while working from home. Virtual Desktop Infrastructure (VDI) deployments on Azure can help organizations rapidly respond to this changing environment. However, you need a way to protect inbound/outbound Internet access to and from these VDI deployments. You can use Azure Firewall DNAT rules along with its threat intelligence-based filtering capabilities to protect your VDI deployments.</p> <p>Virtual Desktop support</p> <p>Azure Virtual Desktop is a comprehensive desktop and app virtualization service running in Azure. It\u2019s the only virtual desktop infrastructure (VDI) that delivers simplified management, multi-session Windows 10, optimizations for Microsoft 365 ProPlus, and support for Remote Desktop Services (RDS) environments. You can deploy and scale your Windows desktops and apps on Azure in minutes and get built-in security and compliance features. Windows Virtual Desktop doesn't require you to open any inbound access to your virtual network. However, you must allow a set of outbound network connections for the Windows Virtual Desktop virtual machines that run in your virtual network.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#configure-vpn-forced-tunneling","title":"Configure VPN forced tunneling","text":"<p>Why do some cases require forced tunneling? - A virtual private network (VPN) consists of remote peers sending private data securely to one another over an unsecured network, such as the Internet. This is called Internet tunneling. Site-to-site (S2S) VPNs use tunnels to encapsulate data packets within normal IP packets for forwarding over IP-based networks, using encryption to ensure privacy and authentication to ensure integrity of data.</p> <p>Forced tunneling lets you redirect, or force, all internet-bound traffic back to your on-premises location via a site-to-site VPN tunnel for inspection and auditing. This is a critical security requirement for most enterprise IT policies. Without forced tunneling, internet-bound traffic from your VMs in Azure always traverses from the Azure network infrastructure directly to the internet\u2014without the option to allow you to inspect or audit the traffic. Unauthorized internet access potentially leads to information disclosure or other types of security breaches.</p> <p>As stated earlier, Azure currently works with two deployment models: The Resource Manager deployment model and the classic deployment model. The two models aren\u2019t completely compatible with each other. The following exercise goes through configuring tunneling for virtual networks that were created via the Resource Manager deployment model.</p> <p>The following figure depicts how forced tunneling works.</p> <p></p> <p>In the preceding figure, the front-end subnet doesn\u2019t use forced tunneling. The workloads in the front-end subnet can continue to accept and respond to customer requests that come directly from the internet. The mid-tier and back-end subnets use forced tunneling. Any outbound connections from these two subnets to the internet are forced back to an on-premises site via one of the S2S VPN tunnels.</p> <p>This allows you to restrict and inspect internet access from your VMs or cloud services in Azure while continuing to enable your multi-tier service architecture. If no internet-facing workloads exist in your VMs, you can also apply forced tunneling to the entire virtual network.</p> <p>You configure forced tunneling in Azure via virtual network User Defined Routes (UDR). Redirecting traffic to an on-premises site is expressed as a default route to the Azure VPN gateway. This example uses UDRs to create a routing table to first add a default route and then associate the routing table with your virtual network subnets to enable forced tunneling on those subnets.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#create-user-defined-routes-and-network-virtual-appliances","title":"Create User Defined Routes and Network Virtual Appliances","text":"<p>User Defined Routes</p> <p>A User Defined Routes (UDR) is a custom route in Azure that overrides Azure's default system routes or adds routes to a subnet's route table. In Azure, you create a route table and then associate that route table with zero or more virtual network subnets. Each subnet can have zero or one route table associated with it. If you create a route table and associate it to a subnet, Azure either combines its routes with the default routes that Azure adds to a subnet or overrides those default routes.</p> <p>In this diagram UDRs are used to direct traffic from the Gateway subnet and the Web tier to the Network Virtual Appliance (NVA).</p> <p></p> <p>Network Virtual Appliances</p> <p>You can deploy an NVA to a perimeter network in many architectures. In the previous diagram, the NVA helps provide a secure network boundary by checking all inbound and outbound network traffic and then passing only the traffic that meets the network security rules. However, the fact that all network traffic passes through the NVA means that the NVA is a single point of failure in the network. If the NVA fails, no other path will exist for network traffic, and all the back-end subnets will become unavailable.</p> <p>To make an NVA highly available, deploy more than one NVA into an availability set.</p> <p>The following figure shows a high-availability architecture that implements an ingress perimeter network behind an internet-facing load balancer. This architecture is designed to provide connectivity to Azure workloads for layer 7 traffic, such as HTTP or HTTPS traffic.</p> <p></p> <p>The benefit of this architecture is that all NVAs are active, and if one fails, the load balancer directs network traffic to the other NVA. Both NVAs route traffic to the internal load balancer, so if one NVA is active, traffic will continue to flow. The NVAs are required to terminate SSL traffic intended for the web tier VMs. These NVAs can\u2019t be extended to handle on-premises traffic, because on-premises traffic requires another dedicated set of NVAs with their own network.</p> <p>UDRs and NSGs help provide layer 3 and layer 4 (of the OSI model) security. NVAs help provide layer 7, application layer, security.</p>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#explore-hub-and-spoke-topology","title":"Explore hub and spoke topology","text":"<p>This reference architecture shows how to implement a hub-spoke topology in Azure. The hub is a virtual network in Azure that acts as a central point of connectivity to your on-premises network. The spokes are virtual networks that peer with the hub and can be used to isolate workloads. Traffic flows between the on-premises datacenter and the hub through an ExpressRoute or VPN gateway connection.</p> <p></p> <p>Typical uses for this architecture include:</p> <ul> <li>Workloads deployed in different environments, such as development, testing, and production, that require shared services such as DNS, IDS, NTP, or AD DS. Shared services are placed in the hub virtual network, while each environment is deployed to a spoke to maintain isolation.</li> <li>Workloads that do not require connectivity to each other, but require access to shared services.</li> <li>Enterprises that require central control over security aspects, such as a firewall in the hub as a DMZ, and segregated management for the workloads in each spoke.</li> </ul> <p>The architecture consists of the following components.</p> <ul> <li>On-premises network - A private local-area network running within an organization.</li> <li>VPN device - A device or service that provides external connectivity to the on-premises network. The VPN device may be a hardware device or a software solution such as the Routing and Remote Access Service (RRAS) in Windows Server 2012. For a list of supported VPN appliances and information on configuring selected VPN appliances for connecting to Azure, see About VPN devices for Site-to-Site VPN Gateway connections.</li> <li>VPN virtual network gateway or ExpressRoute gateway - The virtual network gateway enables the virtual network to connect to the VPN device, or ExpressRoute circuit, used for connectivity with your on-premises network. For more information, see Connect an on-premises network to a Microsoft Azure virtual network.</li> <li>Hub virtual network - The virtual network is used as the hub in the hub-spoke topology. The hub is the central point of connectivity to your on-premises network, and a place to host services that can be consumed by the different workloads hosted in the spoke virtual networks.</li> <li>Gateway subnet - The virtual network gateways are held in the same subnet.</li> <li>Spoke virtual networks - One or more virtual networks that are used as spokes in the hub-spoke topology. Spokes can be used to isolate workloads in their own virtual networks, managed separately from other spokes. Each workload might include multiple tiers, with multiple subnets connected through Azure load balancers. For more information about the application infrastructure, see Running Windows VM workloads and Running Linux VM workloads.</li> <li>Virtual network peering - Two virtual networks can be connected using a peering connection. Peering connections are non-transitive, low latency connections between virtual networks. Once peered, the virtual networks exchange traffic by using the Azure backbone, without the need for a router. In hub-spoke network topology, you use virtual network peering to connect the hub to each spoke. You can peer virtual networks in the same region or different regions. For more information, see Requirements and constraints.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#perform-try-this-exercises","title":"Perform try-this exercises","text":"<p>VNet Peering</p> <p>This lab requires two virtual machines. Each virtual machine should be in a different virtual network. For these instructions, we have AZ500vm01, AZ500vm02, AZ500-vnet, AZ500-vnet1, and az500-rg.</p> <p>To save time, you can connect to each virtual machine. Also, it might be helpful to edit the default.htm page on each machine, so the page provides the virtual machine name. For example, This is AZ500vm01.</p> <p>In this demonstration, you will configure and test VNet peering.</p> <p>Review the infrastructure setup</p> <p>In this task, you will review the infrastructure that has been configured for this demonstration.</p> <ol> <li>In the Portal, navigate to Virtual Machines.</li> <li>Show there are two virtual machines, AZ500vm01 and AZ500vm02.</li> <li>Select AZ500vm01 and review the IP addresses.</li> <li>Select AZ500vm02 and review the IP addresses. Make a note of the private IP address.</li> <li>Based on the addressing, discuss how each machine is in a different subnet.</li> <li>In the Portal navigate to Virtual networks.</li> <li>Show there are two virtual networks, AZ500-vnet and AZ500-vnet1.</li> </ol> <p>Test the virtual machine connections</p> <p>In this task, you will test connecting from AZ500vm01 to AZ500vm02's private IP address. This connection will not work. The virtual machines are in different virtual networks.</p> <ol> <li>Use RDP to connect to AZ500vm01.</li> <li>In a browser, view the http://localhost.default.htm</li> <li>This page should display without error.</li> <li>Use RDP to connect to AZ500vm02</li> <li>In a browser, view the http://localhost.default.htm</li> <li>This page should display without error.</li> <li>The above steps show that IIS is working on the virtual machines.</li> <li>Return to your AZ500vm01 RDP session.</li> <li>We will now try to access AZ500vm02.</li> <li>In a browser, view the http://private_IP_address_of_AZ500vm02/default.htm</li> <li>The page will not display.</li> <li>AZ500vm01 cannot access AZ500vm02 using the private address.</li> </ol> <p>Configure VNet peering and test the connections</p> <p>In this task, you will configure VNet peering and test the previous connection. The connection will now work.</p> <ol> <li>In the Portal, navigate to the AZ500-vnet virtual network.</li> <li>Under Settings select Peerings.</li> <li> <ul> <li> <p>Add a virtual network peering. The page adapts as you make selections.</p> </li> <li> <p>Name of the peering from az500-vnet to remote virtual network: Peering-A-to-B</p> </li> <li>Virtual network: AZ500-vnet1 (az500-rg)</li> <li>Name of the peering from az500-vnet1 to az500-vnet: Peering-B-to-A</li> <li>Discuss the other configuration options.</li> <li>Click OK.</li> <li>Follow the notifications while the virtual network peerings are deployed.</li> <li>Return to your AZ500vm01 RDP session.</li> <li>In the browser, refresh the http://private_IP_address_of_AZ500vm02/default.htm</li> <li>This page should now display.</li> </ul> </li> </ol> <p>Azure Firewall</p> <p>This task requires a virtual network with two subnets, Subnet1 and Jumpnet. Subnet1 has the 10.0.0.0/24 address range. Jumpnet has the 10.0.1.0/24 address range. Subnet1 includes a Windows virtual machine. Your resource names may be different.</p> <p>Configure the firewall subnet</p> <ol> <li>In the Portal, select your virtual network.</li> <li>Under Settings, select Subnets.</li> <li> <p>Click + Subnet to add a new subnet for the firewall.</p> <ul> <li>Name: AzureFirewallSubnet</li> <li>Address range: 10.0.2.0/24</li> <li>There is not need for a NAT Gateway, NSG, Route table, or services.</li> <li>Click Add.</li> <li>Wait for the subnet to deploy.</li> </ul> </li> </ol> <p>Add and configure the firewall</p> <ol> <li>Search for and select Firewalls.</li> <li>Discuss the benefits of a firewall and how it can be used to increase perimeter security.</li> <li>Click + Add.</li> <li>Complete the required configuration information: subscription, resource group, name, and region.</li> <li>Select your Virtual network.</li> <li>Add a new Firewall public IP address.</li> <li>Create the firewall and wait for it to deploy.</li> <li>Navigate to your new firewall.</li> <li>On the Overview blade, locate the Firewall private IP.</li> <li>Copy the address to the clipboard.</li> </ol> <p>Create a route table and route that uses the firewall</p> <ol> <li>Search for and select Route tables.</li> <li>Add a new route table.</li> <li>Complete the required configuration information: name, subscription, resource group, and location.</li> <li>Disable Virtual network gateway route propagation. Review what this means.</li> <li>Create the route table and wait for it to deploy.</li> <li>Navigate to the new route table.</li> <li>Under Settings, click Routes.</li> <li>Add a new route. This route will ensure traffic goes through the firewall. Discuss the different next hop types.<ul> <li>Route name: your choice</li> <li>Address prefix: 0.0.0.0/0/</li> <li>Next hop type: Virtual appliance</li> <li>Next hope address: Firewall_private_IP_address</li> <li>When finished click Ok and wait for the new route to deploy.</li> </ul> </li> </ol> <p>Associate the route table with Subnet1</p> <ol> <li>Still in the route table resource, under Settings click Subnets.</li> <li>Associate your virtual network and Subnet1. This will ensure Subnet1 uses the route table.</li> <li>When you are finished click Ok and wait for the association to complete.</li> </ol> <p>Test the firewall</p> <ol> <li>In the Portal, navigate to a virtual machine in Subnet1.</li> <li>From the Overview blade, ensure the VM is running.</li> <li>Click Connect and RDP into the VM.</li> <li>On the virtual machine, open a browser.</li> <li>Try to access: www.msn.com</li> <li>Notice the error. Action denied. No rule matches.</li> </ol> <p>Add a firewall application rule</p> <ol> <li>In the Portal, navigate to your firewall.</li> <li>Under Settings select Rules.</li> <li>Select the Application rule selection tab.</li> <li>Click Add application rule collection.</li> <li>Review how application rules work and complete the required information.<ul> <li>Name: your choice</li> <li>Priority: 300</li> <li>Action: Allow</li> </ul> </li> <li>Continue completing the rule, under Target FQDNs. This will allow Subnet1 IP address to traverse the firewall.<ul> <li>Name: Allow-MSN</li> <li>Source type: IP address</li> <li>Source: 10.0.0.0/24</li> <li>Protocol:Port: http,https</li> <li>Target FQDNs: www.msn.com</li> </ul> </li> <li>Click Add and wait for the firewall to be updated.</li> </ol> <p>Test the firewall again</p> <ol> <li>In your VM RDP session, refresh the browser page.</li> <li>The MSN.com page should now display.</li> </ol> <p>Knowledge check</p> <ol> <li> <p>Which of the following features of Azure networking enables the redirect of Internet traffic back to the company's on-premises servers for packet inspection?</p> <ul> <li>User Defined Routes (Ans)     User-defined routes and forced tunneling. Use forced tunneling to redirect internet bound traffic back to the company's on-premises infrastructure. Forced tunneling is commonly used in scenarios where organizations want to implement packet inspection or corporate audits. Forced tunneling in Azure is configured via virtual network user-defined routes (UDR).</li> <li>Cross-premises network connectivity</li> <li>Traffic Manager</li> </ul> </li> <li> <p>When configuring Azure Firewall, the organization needs to allow Windows Update network traffic through the firewall. Which of the following rules should be configured?</p> <ul> <li>Destination inbound rules</li> <li>NAT rules</li> <li>Application rules(Ans)     Application rules. Application rules define fully qualified domain names (FQDNs) that can be accessed from a subnet. Usage of FQDNs would be appropriate to allow Windows Update network traffic.</li> </ul> </li> <li> <p>An organization would like to limit outbound Internet traffic from a subnet, which product should be installed and configured?</p> <ul> <li>Azure Web Application Firewall</li> <li>Azure Firewall(Ans)     Azure Firewall. Azure Firewall can limit the outbound IP addresses and ports that can be accessed. Define network rules that assign source address, protocol, destination port, and destination address.</li> <li>Load Balancer</li> </ul> </li> <li> <p>An organization has a web application and is concerned about attacks that flood the network layer with a substantial amount of seemingly legitimate traffic, how can this type of attack be blocked?</p> <ul> <li>Add a Web Application Firewall</li> <li>Add an Azure Firewall</li> <li>Create a DDoS policy(Ans)     Create a DDoS policy to provide defense against the exhaustion resources. This exhaustion could make an application unavailable to legitimate users for example.</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#configure-network-security","title":"Configure network security","text":"<p>Introduction Network security could be defined as the process of protecting resources from unauthorized access or attack by applying controls to network traffic. The goal is to ensure that only legitimate traffic is allowed. Azure includes a robust networking infrastructure to support your application and service connectivity requirements. Network connectivity is possible between resources located in Azure, between on-premises and Azure hosted resources, and to and from the internet and Azure.</p> <p>Scenario A security engineer uses network security features to restrict, monitor, and manage network traffic once it reaches your Azure network; you will work on such tasks as:</p> <ul> <li>Setup network security groups and application security groups.</li> <li>Deploy Service Endpoints and Private Links.</li> <li>Configure Front Door and ExpressRoute.</li> </ul> <p>Skills measured Securing the Azure platform your cloud solutions run on is a part of Exam AZ-500: Microsoft Azure Security Engineer.</p> <p>Implement platform protection (15-20%)</p> <p>Implement advanced network security    - Secure the connectivity of virtual networks (VPN authentication, Express Route encryption)    - Configure Network Security Groups (NSGs) and Application Security Groups (ASGs)    - Configure Azure Front Door service as an Application Gateway    - Configure a Web Application Firewall (WAF) on Azure Application Gateway    - Implement Service Endpoints</p> <p>Explore Network Security Groups (NSG) Network traffic can be filtered to and from Azure resources in an Azure virtual network with a network security group. A network security group contains security rules that allow or deny inbound network traffic to, or outbound network traffic from, several types of Azure resources. For each rule, you can specify source and destination, port, and protocol.</p> <p>VMs that you create via the Resource Manager deployment model can have direct connectivity to the internet by using a public IP address that is directly assigned to the VMs. Only the host firewall configured inside the VMs helps protect these VMs from the internet.</p> <p>VMs that you create by using the classic deployment model communicate with internet resources through the cloud service that is assigned the public IP address, which is also known as the VIP. VMs that reside inside the cloud service share that VIP and establish communication with internet resources by using endpoints. If you remove the VM endpoints that map the public port and public IP address of the cloud service to the private port and private IP address of the VM, the VM becomes unreachable from the internet via the public IP address.</p> <p>Network Security Groups (NSGs) help provide advanced security for the VMs you create via either deployment model (Resource Manager or classic). NSGs control inbound and outbound traffic passing through a network adapter (in the Resource Manager deployment model), a VM (in the classic deployment model), or a subnet (in both deployment models).</p> <p>Network Security Group rules NSGs contain rules that specify whether traffic will be approved or denied. Each rule is based on a source IP address, a source port, a destination IP address, and a destination port. Based on whether the traffic matches this combination, the rule either allows or denies the traffic. Each rule consists of the following properties:</p> <ul> <li>Name. This is a unique identifier for the rule.</li> <li>Direction. This specifies whether the traffic is inbound or outbound.</li> <li>Priority. If multiple rules match the traffic, rules with a higher priority apply.</li> <li>Access. This specifies whether the traffic is allowed or denied.</li> <li>Source IP address prefix. This prefix identifies where the traffic originated from. It can be based on a single IP address; a range of IP addresses in Classless Interdomain Routing (CIDR) notation; or the asterisk (*), which is a wildcard that matches all possible IP addresses.</li> <li>Source port range. This specifies source ports by using either a single port number from 1 through 65,535; a range of ports (for example, 200\u2013400); or the asterisk (*) to denote all possible ports.</li> <li>Destination IP address prefix. This identifies the traffic destination based on a single IP address, a range of IP addresses in CIDR notation, or the asterisk (*) to match all possible IP addresses.</li> <li>Destination port range. This specifies destination ports by using either a single port number from 1 through 65,535; a range of ports (for example, 200\u2013400); or the asterisk (*) to denote all possible ports.</li> <li>Protocol. This specifies a protocol that matches the rule. It can be UDP, TCP, or the asterisk (*).</li> </ul> <p>Custom Network Security Group rules Predefined default rules exist for inbound and outbound traffic. You can\u2019t delete these rules, but you can override them, because they have the lowest priority. The default rules allow all inbound and outbound traffic within a virtual network, allow outbound traffic towards the internet, and allow inbound traffic to an Azure load balancer. A default rule with the lowest priority also exists in both the inbound and outbound sets of rules that denies all network communication.</p> <p>When you create a custom rule, you can use default tags in the source and destination IP address prefixes to specify predefined categories of IP addresses. These default tags are:</p> <ul> <li>Internet. This tag represents internet IP addresses.</li> <li>Virtual_network. This tag identifies all IP addresses that the IP range for the virtual network defines. It also includes IP address ranges from on-premises networks when they are defined as local network to virtual network.</li> <li>Azure_loadbalancer. This tag specifies the default Azure load balancer destination.</li> </ul> <p>Planning Network Security Groups You can design NSGs to isolate virtual networks in security zones, like the model used by on-premises infrastructure does. You can apply NSGs to subnets, which allows you to create protected screened subnets, or DMZs, that can restrict traffic flow to all the machines residing within that subnet. With the classic deployment model, you can also assign NSGs to individual computers to control traffic that is both destined for and leaving the VM. With the Resource Manager deployment model, you can assign NSGs to a network adapter so that NSG rules control only the traffic that flows through that network adapter. If the VM has multiple network adapters, NSG rules won\u2019t automatically be applied to traffic that is designated for other network adapters.</p> <p>You create NSGs as resources in a resource group, but you can share them with other resource groups in your subscription.</p> <p>Deploy a Network Security Groups implementation When implementing NSGs, these are the limits to keep in mind:</p> <ul> <li>By default, you can create 100 NSGs per region per subscription. You can raise this limit to 400 by contacting Azure support.</li> <li>You can apply only one NSG to a VM, subnet, or network adapter.</li> <li>By default, you can have up to 200 rules in a single NSG. You can raise this limit to 500 by contacting Azure support.</li> <li>You can apply an NSG to multiple resources.</li> </ul> <p>An individual subnet can have zero, or one, associated NSG. An individual network interface can also have zero, or one, associated NSG. So, you can effectively have dual traffic restriction for a virtual machine by associating an NSG first to a subnet, and then another NSG to the VM's network interface. The application of NSG rules in this case depends on the direction of traffic and priority of applied security rules.</p> <p>Consider a simple example with one virtual machine as follows:</p> <ul> <li>The virtual machine is placed inside the Contoso Subnet.</li> <li>Contoso Subnet is associated with Subnet NSG.</li> <li>The VM network interface is additionally associated with VM NSG.</li> </ul> <p></p> <p>In this example, for inbound traffic, the Subnet NSG is evaluated first. Any traffic allowed through Subnet NSG is then evaluated by VM NSG. The reverse is applicable for outbound traffic, with VM NSG being evaluated first. Any traffic allowed through VM NSG is then evaluated by Subnet NSG.</p> <p>This allows for granular security rule application. For example, you might want to allow inbound internet access to a few application VMs (such as frontend VMs) under a subnet but restrict inbound internet access to other VMs (such as database and other backend VMs). In this case you can have a more lenient rule on the Subnet NSG, allowing internet traffic, and restrict access to specific VMs by denying access on VM NSG. The same can be applied for outbound traffic.</p> <p>To help secure and protect your Azure resources, make sure NSG planning is standard operating procedure (SOP) for your deployments.</p> <p>How traffic is evaluated Several resources from Azure services can be deployed into an Azure virtual network. You can associate zero, or one, network security group to each virtual network subnet and network interface in a virtual machine. The same network security group can be associated to as many subnets and network interfaces as you choose.</p> <p>The following picture illustrates different scenarios for how network security groups might be deployed to allow network traffic to and from the internet over TCP port 80:</p> <p></p> <p>Reference the above diagram, along with the following text, to understand how Azure processes inbound and outbound rules for network security groups:</p> <p>Inbound traffic</p> <p>For inbound traffic, Azure processes the rules in a network security group associated to a subnet first, if there is one, and then the rules in a network security group associated to the network interface, if there is one.</p> <ul> <li>VM1: The security rules in NSG1 are processed, since it is associated to Subnet1 and VM1 is in Subnet1. Unless you've created a rule that allows port 80 inbound, the traffic is denied by the DenyAllInbound default security rule, and never evaluated by NSG2, since NSG2 is associated to the network interface. If NSG1 has a security rule that allows port 80, the traffic is then processed by NSG2. To allow port 80 to the virtual machine, both NSG1 and NSG2 must have a rule that allows port 80 from the internet.</li> <li>VM2: The rules in NSG1 are processed because VM2 is also in Subnet1. Since VM2 does not have a network security group associated to its network interface, it receives all traffic allowed through NSG1 or is denied all traffic denied by NSG1. Traffic is either allowed or denied to all resources in the same subnet when a network security group is associated to a subnet.</li> <li>VM3: Since there is no network security group associated to Subnet2, traffic is allowed into the subnet and processed by NSG2, because NSG2 is associated to the network interface attached to VM3.</li> <li>VM4: Traffic is allowed to VM4, because a network security group isn't associated to Subnet3, or the network interface in the virtual machine. All network traffic is allowed through a subnet and network interface if they don't have a network security group associated to them.</li> </ul> <p>Outbound traffic</p> <p>For outbound traffic, Azure processes the rules in a network security group associated to a network interface first, if there is one, and then the rules in a network security group associated to the subnet, if there is one.</p> <ul> <li>VM1: The security rules in NSG2 are processed. Unless you create a security rule that denies port 80 outbound to the internet, the traffic is allowed by the AllowInternetOutbound default security rule in both NSG1 and NSG2. If NSG2 has a security rule that denies port 80, the traffic is denied, and never evaluated by NSG1. To deny port 80 from the virtual machine, either, or both of the network security groups must have a rule that denies port 80 to the internet.</li> <li>VM2: All traffic is sent through the network interface to the subnet, since the network interface attached to VM2 does not have a network security group associated to it. The rules in NSG1 are processed.</li> <li>VM3: If NSG2 has a security rule that denies port 80, the traffic is denied. If NSG2 has a security rule that allows port 80, then port 80 is allowed outbound to the internet, since a network security group is not associated to Subnet2.</li> <li>VM4: All network traffic is allowed from VM4, because a network security group isn't associated to the network interface attached to the virtual machine, or to Subnet3.</li> </ul> <p>Intra-subnet traffic It's important to note that security rules in an NSG associated to a subnet can affect connectivity between VM's within it. For example, if a rule is added to NSG1 which denies all inbound and outbound traffic, VM1 and VM2 will no longer be able to communicate with each other. Another rule would have to be added specifically to allow this.</p> <p>General guidelines Unless you have a specific reason to, we recommended that you associate a network security group to a subnet, or a network interface, but not both. Since rules in a network security group associated to a subnet can conflict with rules in a network security group associated to a network interface, you can have unexpected communication problems that require troubleshooting.</p> <p>Create Application Security Groups</p> <p>In this topic we look at Application Security Groups (ASGs), which are built on network security groups. A quick review of Security groups reminds us that you can filter network traffic to and from Azure resources in an Azure virtual network with a network security group. A network security group contains security rules that allow or deny inbound network traffic to, or outbound network traffic from, several types of Azure resources.</p> <p>For each rule, you can specify source and destination, port, and protocol. You can enable network security group flow logs to analyze network traffic to and from resources that have an associated network security group.</p> <p>Application security groups ASGs enable you to configure network security as a natural extension of an application's structure. You then can group VMs and define network security policies based on those groups.</p> <p>You also can reuse your security policy at scale without manual maintenance of explicit IP addresses. The platform manages the complexity of explicit IP addresses and multiple rule sets, allowing you to focus on your business logic. Consider the following illustration.</p> <p></p> <p>In the illustration, NIC1 and NIC2 are members of the AsgWeb ASG. NIC3 is a member of the AsgLogic ASG. NIC4 is a member of the AsgDb ASG. Though each network interface in this example is a member of only one ASG, a network interface can be a member of multiple ASGs, up to the Azure limits. None of the network interfaces have an associated network security group. NSG1 is associated to both subnets and contains the following rules:</p> <ul> <li>Allow-HTTP-Inbound-Internet</li> <li>Deny-Database-All</li> <li>Allow-Database-BusinessLogic</li> </ul> <p>The rules that specify an ASG as the source or destination are only applied to the network interfaces that are members of the ASG. If the network interface is not a member of an ASG, the rule is not applied to the network interface even though the network security group is associated to the subnet.</p> <p>Application security groups have the following constraints</p> <ul> <li>There are limits to the number of ASGs you can have in a subscription, in addition to other limits related to ASGs.</li> <li>You can specify one ASG as the source and destination in a security rule. You cannot specify multiple ASGs in the source or destination.</li> <li>All network interfaces assigned to an ASG must exist in the same virtual network that the first network interface assigned to the ASG is in. For example, if the first network interface assigned to an ASG named AsgWeb is in the virtual network named VNet1, then all subsequent network interfaces assigned to ASGWeb must exist in VNet1. You cannot add network interfaces from different virtual networks to the same ASG.</li> <li>If you specify an ASG as the source and destination in a security rule, the network interfaces in both ASGs must exist in the same virtual network. For example, if AsgLogic contained network interfaces from VNet1, and AsgDb contained network interfaces from VNet2, you could not assign AsgLogic as the source and AsgDb as the destination in a rule. All network interfaces for both the source and destination ASGs need to exist in the same virtual network.</li> </ul> <p>Summary Application Security Groups along with NSGs, have brought multiple benefits on the network security area:</p> <ul> <li>A single management experience</li> <li>Increased limits on multiple dimensions</li> <li>A great level of simplification</li> <li>A seamless integration with your architecture</li> </ul> <p>Enable service endpoints</p> <p>A virtual network service endpoint provides the identity of your virtual network to the Azure service. Once service endpoints are enabled in your virtual network, you can secure Azure service resources to your virtual network by adding a virtual network rule to the resources.</p> <p>Today, Azure service traffic from a virtual network uses public IP addresses as source IP addresses. With service endpoints, service traffic switches to use virtual network private addresses as the source IP addresses when accessing the Azure service from a virtual network. This switch allows you to access the services without the need for reserved, public IP addresses used in IP firewalls.</p> <p>A common usage case for service endpoints is a virtual machine accessing storage. The storage account restricts access to the virtual machines private IP address.</p> <p></p> <p>Why use a service endpoint?</p> <ul> <li>Improved security for your Azure service resources. VNet private address space can be overlapping and so, cannot be used to uniquely identify traffic originating from your VNet. Service endpoints provide the ability to secure Azure service resources to your virtual network, by extending VNet identity to the service. Once service endpoints are enabled in your virtual network, you can secure Azure service resources to your virtual network by adding a virtual network rule to the resources. This provides improved security by fully removing public Internet access to resources, and allowing traffic only from your virtual network.</li> <li>Optimal routing for Azure service traffic from your virtual network. Today, any routes in your virtual network that force Internet traffic to your premises and/or virtual appliances, known as forced-tunneling, also force Azure service traffic to take the same route as the Internet traffic. Service endpoints provide optimal routing for Azure traffic.</li> <li>Endpoints always take service traffic directly from your virtual network to the service on the Microsoft Azure backbone network. Keeping traffic on the Azure backbone network allows you to continue auditing and monitoring outbound Internet traffic from your virtual networks, through forced-tunneling, without impacting service traffic.</li> <li>Simple to set up with less management overhead. You no longer need reserved, public IP addresses in your virtual networks to secure Azure resources through IP firewall. There are no NAT or gateway devices required to set up the service endpoints. Service endpoints are configured through a simple click on a subnet. There is no additional overhead to maintaining the endpoints.</li> </ul> <pre><code>Important:\n\nWith service endpoints, the source IP addresses of the virtual machines in the subnet for service traffic switches from using public IPv4 addresses to using private IPv4 addresses. Existing Azure service firewall rules using Azure public IP addresses will stop working with this switch. Please ensure Azure service firewall rules allow for this switch before setting up service endpoints. You may also experience temporary interruption to service traffic from this subnet while configuring service endpoints.\n</code></pre> <p>Configure service endpoint services</p> <p>Service endpoints would provide benefits in the following Scenarios.</p> <p>Scenarios</p> <ul> <li>Peered, connected, or multiple virtual networks: To secure Azure services to multiple subnets within a virtual network or across multiple virtual networks, you can enable service endpoints on each of the subnets independently, and secure Azure service resources to all of the subnets.</li> <li>Filtering outbound traffic from a virtual network to Azure services: If you want to inspect or filter the traffic sent to an Azure service from a virtual network, you can deploy a network virtual appliance within the virtual network. You can then apply service endpoints to the subnet where the network virtual appliance is deployed, and secure Azure service resources only to this subnet. This scenario might be helpful if you want use network virtual appliance filtering to restrict Azure service access from your virtual network only to specific Azure resources.</li> <li>Securing Azure resources to services deployed directly into virtual networks: You can directly deploy various Azure services into specific subnets in a virtual network. You can secure Azure service resources to managed service subnets by setting up a service endpoint on the managed service subnet.</li> <li>Disk traffic from an Azure virtual machine: Virtual Machine Disk traffic for managed and unmanaged disks isn't affected by service endpoints routing changes for Azure Storage. This traffic includes diskIO as well as mount and unmount. You can limit REST access to page blobs to select networks through service endpoints and Azure Storage network rules.</li> </ul> <p></p> <p>Deploy private links</p> <p>Azure Private Link works on an approval call flow model wherein the Private Link service consumer can request a connection to the service provider for consuming the service. The service provider can then decide whether to allow the consumer to connect or not. Azure Private Link enables the service providers to manage the private endpoint connection on their resources</p> <p></p> <p>There are two connection approval methods that a Private Link service consumer can choose from:</p> <ul> <li>Automatic: If the service consumer has RBAC permissions on the service provider resource, the consumer can choose the automatic approval method. In this case, when the request reaches the service provider resource, no action is required from the service provider and the connection is automatically approved.</li> <li>Manual: On the contrary, if the service consumer doesn\u2019t have RBAC permissions on the service provider resource, the consumer can choose the manual approval method. In this case, the connection request appears on the service resources as Pending. The service provider has to manually approve the request before connections can be established. In manual cases, service consumer can also specify a message with the request to provide more context to the service provider.</li> </ul> <p>The service provider has following options to choose from for all Private Endpoint connections:</p> <ul> <li>Approved</li> <li>Reject</li> <li>Remove</li> </ul> <p>Manage private endpoint connections on Azure PaaS resources</p> <p>Portal is the preferred method for managing private endpoint connections on Azure PaaS resources.</p> <p>Implement an Azure application gateway</p> <p>Azure Application Gateway is a web traffic load balancer that enables you to manage traffic to your web applications. Traditional load balancers operate at the transport layer (OSI layer 4 - TCP and UDP) and route traffic based on the source IP address and port to a destination IP address and port.</p> <p>Application Gateway can make routing decisions based on additional attributes of an HTTP request, for example, URI path or host headers. For example, you can route traffic based on the incoming URL. So if /images are in the incoming URL, you can route traffic to a specific set of servers (known as a pool) configured for images. If /video is in the URL, that traffic is routed to another pool that's optimized for videos. This type of routing is known as application layer (OSI layer 7) load balancing.</p> <p></p> <p>Application Gateway includes the following features:</p> <ul> <li>Secure Sockets Layer (SSL/TLS) termination - Application gateway supports SSL/TLS termination at the gateway, after which traffic typically flows unencrypted to the backend servers. This feature allows web servers to be unburdened from costly encryption and decryption overhead.</li> <li>Autoscaling - Application Gateway Standard_v2 supports autoscaling and can scale up or down based on changing traffic load patterns. Autoscaling also removes the requirement to choose a deployment size or instance count during provisioning.</li> <li>Zone redundancy - A Standard_v2 Application Gateway can span multiple Availability Zones, offering better fault resiliency and removing the need to provision separate Application Gateways in each zone.</li> <li>Static VIP - The application gateway Standard_v2 SKU supports static VIP type exclusively. This ensures that the VIP associated with application gateway doesn't change even over the lifetime of the Application Gateway.</li> <li>Web Application Firewall - Web Application Firewall (WAF) is a service that provides centralized protection of your web applications from common exploits and vulnerabilities. WAF is based on rules from the OWASP (Open Web Application Security Project) core rule sets 3.1 (WAF_v2 only), 3.0, and 2.2.9.</li> <li>Ingress Controller for AKS - Application Gateway Ingress Controller (AGIC) allows you to use Application Gateway as the ingress for an Azure Kubernetes Service (AKS) cluster.</li> <li>URL-based routing - URL Path Based Routing allows you to route traffic to back-end server pools based on URL Paths of the request. One of the scenarios is to route requests for different content types to different pool.</li> <li>Multiple-site hosting - Multiple-site hosting enables you to configure more than one web site on the same application gateway instance. This feature allows you to configure a more efficient topology for your deployments by adding up to 100 web sites to one Application Gateway (for optimal performance).</li> <li>Redirection - A common scenario for many web applications is to support automatic HTTP to HTTPS redirection to ensure all communication between an application and its users occurs over an encrypted path.</li> <li>Session affinity - The cookie-based session affinity feature is useful when you want to keep a user session on the same server.</li> <li>Websocket and HTTP/2 traffic - Application Gateway provides native support for the WebSocket and HTTP/2 protocols. There's no user-configurable setting to selectively enable or disable WebSocket support.</li> <li>Connection draining - Connection draining helps you achieve graceful removal of backend pool members during planned service updates.</li> <li>Custom error pages - Application Gateway allows you to create custom error pages instead of displaying default error pages. You can use your own branding and layout using a custom error page.</li> <li>Rewrite HTTP headers - HTTP headers allow the client and server to pass additional information with the request or the response.</li> <li>Sizing - Application Gateway Standard_v2 can be configured for autoscaling or fixed size deployments. This SKU doesn't offer different instance sizes.</li> </ul> <p>New Application Gateway v1 SKU deployments can take up to 20 minutes to provision. Changes to instance size or count aren't disruptive, and the gateway remains active during this time.</p> <p>Most deployments that use the v2 SKU take around 6 minutes to provision. However it can take longer depending on the type of deployment. For example, deployments across multiple Availability Zones with many instances can take more than 6 minutes.</p> <p>Deploy a web application firewall</p> <p>Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities. Web applications are increasingly targeted by malicious attacks that exploit commonly known vulnerabilities. SQL injection and cross-site scripting are among the most common attacks.</p> <p></p> <p>Preventing such attacks in application code is challenging. It can require rigorous maintenance, patching, and monitoring at multiple layers of the application topology. A centralized web application firewall helps make security management much simpler. A WAF also gives application administrators better assurance of protection against threats and intrusions.</p> <p>A WAF solution can react to a security threat faster by centrally patching a known vulnerability, instead of securing each individual web application.</p> <p>Supported service</p> <p>WAF can be deployed with Azure Application Gateway, Azure Front Door, and Azure Content Delivery Network (CDN) service from Microsoft. WAF on Azure CDN is currently under public preview. WAF has features that are customized for each specific service.</p> <p>Configure and manage Azure front door</p> <p>Azure Front Door enables you to define, manage, and monitor the global routing for your web traffic by optimizing for best performance and instant global failover for high availability. With Front Door, you can transform your global (multi-region) consumer and enterprise applications into robust, high-performance personalized modern applications, APIs, and content that reaches a global audience with Azure.</p> <p>Front Door works at Layer 7 or HTTP/HTTPS layer and uses split TCP-based anycast protocol. Front Door ensures that your end users promptly connect to the nearest Front Door POP (Point of Presence). So, per your routing method selection in the configuration, you can ensure that Front Door is routing your client requests to the fastest and most available application backend. An application backend is any Internet-facing service hosted inside or outside of Azure. Front Door provides a range of traffic-routing methods and backend health monitoring options to suit different application needs and automatic failover models. Like Traffic Manager, Front Door is resilient to failures, including the failure of an entire Azure region.</p> <p></p> <p>The following features are included with Front Door:</p> <ul> <li>Accelerate application performance - Using split TCP-based anycast protocol, Front Door ensures that your end users promptly connect to the nearest Front Door POP (Point of Presence).</li> <li>Increase application availability with smart health probes - Front Door delivers high availability for your critical applications using its smart health probes, monitoring your backends for both latency and availability and providing instant automatic failover when a backend goes down.</li> <li>URL-based routing - URL Path Based Routing allows you to route traffic to backend pools based on URL paths of the request. One of the scenarios is to route requests for different content types to different backend pools.</li> <li>Multiple-site hosting - Multiple-site hosting enables you to configure more than one web site on the same Front Door configuration.</li> <li>Session affinity - The cookie-based session affinity feature is useful when you want to keep a user session on the same application backend.</li> <li>TLS termination - Front Door supports TLS termination at the edge that is, individual users can set up a TLS connection with Front Door environments instead of establishing it over long haul connections with the application backend.</li> <li>Custom domains and certificate management - When you use Front Door to deliver content, a custom domain is necessary if you would like your own domain name to be visible in your Front Door URL.</li> <li>Application layer security - Azure Front Door allows you to author custom Web Application Firewall (WAF) rules for access control to protect your HTTP/HTTPS workload from exploitation based on client IP addresses, country code, and http parameters.</li> <li>URL redirection - With the strong industry push on supporting only secure communication, web applications are expected to automatically redirect any HTTP traffic to HTTPS.</li> <li>URL rewrite - Front Door supports URL rewrite by allowing you to configure an optional Custom Forwarding Path to use when constructing the request to forward to the backend.</li> <li>Protocol support - IPv6 and HTTP/2 traffic - Azure Front Door natively supports end-to-end IPv6 connectivity and HTTP/2 protocol.</li> </ul> <p>As mentioned above, routing to the Azure Front Door environments leverages Anycast for both DNS (Domain Name System) and HTTP (Hypertext Transfer Protocol) traffic, so user traffic will go to the closest environment in terms of network topology (fewest hops). This architecture typically offers better round-trip times for end users (maximizing the benefits of Split TCP). Front Door organizes its environments into primary and fallback \"rings\". The outer ring has environments that are closer to users, offering lower latencies. The inner ring has environments that can handle the failover for the outer ring environment in case an issue happens. The outer ring is the preferred target for all traffic, but the inner ring is necessary to handle traffic overflow from the outer ring. In terms of VIPs (Virtual Internet Protocol addresses), each frontend host, or domain served by Front Door is assigned a primary VIP, which is announced by environments in both the inner and outer ring, as well as a fallback VIP, which is only announced by environments in the inner ring.</p> <p>This overall strategy ensures that requests from your end users always reach the closest Front Door environment and that even if the preferred Front Door environment is unhealthy then traffic automatically moves to the next closest environment.</p> <p>Review ExpressRoute</p> <p>ExpressRoute is a direct, private connection from your WAN (not over the public Internet) to Microsoft Services, including Azure. Site-to-Site VPN traffic travels encrypted over the public Internet. Being able to configure Site-to-Site VPN and ExpressRoute connections for the same virtual network has several advantages.</p> <p>You can configure a Site-to-Site VPN as a secure failover path for ExpressRoute, or use Site-to-Site VPNs to connect to sites that are not part of your network, but that are connected through ExpressRoute. Notice that this configuration requires two virtual network gateways for the same virtual network, one using the gateway type 'Vpn', and the other using the gateway type 'ExpressRoute'.</p> <p></p> <p>ExpressRoute encryption</p> <p>IPsec over ExpressRoute for Virtual WAN</p> <p>Azure Virtual WAN uses an Internet Protocol Security (IPsec) Internet Key Exchange (IKE) VPN connection from your on-premises network to Azure over the private peering of an Azure ExpressRoute circuit. This technique can provide an encrypted transit between the on-premises networks and Azure virtual networks over ExpressRoute, without going over the public internet or using public IP addresses. The following diagram shows an example of VPN connectivity over ExpressRoute private peering.</p> <p></p> <p>The diagram shows a network within the on-premises network connected to the Azure hub VPN gateway over ExpressRoute private peering. The connectivity establishment is straightforward:</p> <ol> <li>Establish ExpressRoute connectivity with an ExpressRoute circuit and private peering.</li> <li>Establish the VPN connectivity.</li> </ol> <p>An important aspect of this configuration is routing between the on-premises networks and Azure over both the ExpressRoute and VPN paths.</p> <p>ExpressRoute supports a couple of encryption technologies to ensure confidentiality and integrity of the data traversing between your network and Microsoft's network.</p> <p>Point-to-point encryption by MACsec</p> <p>MACsec is an IEEE standard. It encrypts data at the Media Access control (MAC) level or Network Layer 2. You can use MACsec to encrypt the physical links between your network devices and Microsoft's network devices when you connect to Microsoft via ExpressRoute Direct. MACsec is disabled on ExpressRoute Direct ports by default. You bring your own MACsec key for encryption and store it in Azure Key Vault. You decide when to rotate the key.</p> <p>End-to-end encryption by IPsec and MACsec</p> <p>IPsec is an IETF standard. It encrypts data at the Internet Protocol (IP) level or Network Layer 3. You can use IPsec to encrypt an end-to-end connection between your on-premises network and your virtual network (VNET) on Azure.</p> <p>MACsec secures the physical connections between you and Microsoft. IPsec secures the end-to-end connection between you and your virtual networks on Azure. You can enable them independently.</p> <p>ExpressRoute Direct</p> <p>ExpressRoute Direct gives you the ability to connect directly into Microsoft\u2019s global network at peering locations strategically distributed across the world. ExpressRoute Direct provides dual 100 Gbps or 10 Gbps connectivity, which supports Active/Active connectivity at scale</p> <p>Key features that ExpressRoute Direct provides include, but aren't limited to:</p> <ul> <li>Massive Data Ingestion into services like Storage and Cosmos DB</li> <li>Physical isolation for industries that are regulated and require dedicated and isolated connectivity like: Banking, Government, and Retail</li> <li>Granular control of circuit distribution based on business unit</li> </ul> <p>ExpressRoute Direct supports massive data ingestion scenarios into Azure storage and other big data services. ExpressRoute circuits on 100 Gbps ExpressRoute Direct now also support 40 Gbps and 100 Gbps circuit SKUs. The physical port pairs are 100 or 10 Gbps only and can have multiple virtual circuits.</p> <p>ExpressRoute Direct supports both QinQ and Dot1Q VLAN tagging.</p> <ul> <li>QinQ VLAN Tagging allows for isolated routing domains on a per ExpressRoute circuit basis. Azure dynamically allocates an S-Tag at circuit creation and cannot be changed. Each peering on the circuit (Private and Microsoft) will utilize a unique C-Tag as the VLAN. The C-Tag is not required to be unique across circuits on the ExpressRoute Direct ports.</li> <li>Dot1Q VLAN Tagging allows for a single tagged VLAN on a per ExpressRoute Direct port pair basis. A C-Tag used on a peering must be unique across all circuits and peerings on the ExpressRoute Direct port pair.</li> </ul> <p>ExpressRoute Direct provides the same enterprise-grade SLA with Active/Active redundant connections into the Microsoft Global Network. ExpressRoute infrastructure is redundant and connectivity into the Microsoft Global Network is redundant and diverse and scales accordingly with customer requirements.</p> <p>Perform try-this exercises</p> <p>Use this short Try-This exercises to get some hands-on experience with using Azure. An individual Azure subscription is required to perform the exercise tasks. To subscribe, browse to https://www.azure.microsoft.com/free.</p> <p>Task 1 - Network security groups</p> <p>This task requires a Windows virtual machine associated with a network security group. The NSG should have an inbound security rule that allows RDP. The virtual machine should be in a running state and have a public IP address.</p> <p>In this task, we will review networking rules, confirm the public IP page does not display, configure an inbound NSG rule, and confirm the public IP page now displays.</p> <p>Review networking rules</p> <ol> <li>In the Portal, navigate to your virtual machine.</li> <li>Under Settings, click Networking.</li> <li>Discuss the default inbound and outbound rules.</li> <li>Review the inbound rules and ensure RDP is allowed.</li> <li>Make a note of the public IP address.</li> </ol> <p>Connect to the virtual machine and test the public IP address</p> <ol> <li>From the Overview blade, click Connect and RDP into the virtual machine.</li> <li>On the virtual machine, open a browser.</li> <li>Test the default localhost IIS HTML page: http://localhost/default.htm. This page should appear.</li> <li>Test the default public IP IIS HTML page: http://public_IP_address/default.htm. This page should not display.</li> </ol> <p>Configure an inbound rule to allow public access on port 80</p> <ol> <li>Return to the Portal and the Networking blade.</li> <li>Make a note of the virtual machine's private IP address.</li> <li> <p>On the Inbound port rules tab, click Add inbound port rule. This rule will only allow certain IP addresses on port 80. As you go through the configuration settings, be sure to discuss each one.</p> <ul> <li>Source: Service Tag</li> <li>Source service tag: Internet</li> <li>Destination: IP addresses</li> <li>Destination IP addresses/CIDR range: private_IP_address/32</li> <li>Destination port range: 80</li> <li>Protocol: TCP</li> <li>Action: Allow</li> <li>Name: Allow_Port_80</li> <li>Click Add</li> </ul> </li> <li> <p>Wait for your new inbound rule to be added.</p> </li> </ol> <p>Retest the public IP address</p> <ol> <li>On the virtual machine, return to the browser.</li> <li>Refresh the default public IP IIS HTML page: http://public_IP_address/default.htm. This page should now display.</li> </ol> <p>Task 2 - Application service groups</p> <p>This task requires a Windows virtual machine with IIS installed. These steps use VM1. Your machine name may be different.</p> <p>In this task, we will connect to a virtual machine, create an inbound deny rule, configure an application security group, and test connectivity.</p> <p>Connect to the virtual machine</p> <ol> <li>In the Portal, navigate to VM1.</li> <li>On the Networking blade, make a note of the private IP address.</li> <li>Ensure there is an Inbound port rule that allows RDP.</li> <li>From the Overview blade, ensure VM1 is running.</li> <li>Click Connect and RDP into the VM1.</li> <li>On VM1, open a browser.</li> <li>Ensure the default IIS page display for the private IP address: http://private_IP_address/default.htm.</li> </ol> <p>Add an inbound deny rule and test the rule</p> <ol> <li>Continue in the Portal from the Networking blade.</li> <li> <p>On the Inbound port rules tab, click Add inbound port rule. Add a rule that denies all inbound traffic.</p> <ul> <li>Destination port ranges: *</li> <li>Action: Deny</li> <li>Name: Deny_All</li> <li>Click Add</li> </ul> </li> <li> <p>Wait for your new inbound rule to be added.</p> </li> <li>On VM1, refresh the browser page: http://private_IP_address/default.htm.</li> <li>Verify that the page does not display.</li> </ol> <p>Configure an application security group</p> <ol> <li>In the Portal, search for and select Application security groups.</li> <li>Create a new Application security group.</li> <li>Provide the required information: subscription, resource group, name, and region.</li> <li>Wait for the ASG to deploy.</li> <li>In the Portal, return to VM1.</li> <li>On the Networking blade, select the Application security groups tab.</li> <li>Click Configure the application security groups.</li> <li>Select your new application security group, and Save your changes.</li> <li> <p>From the Inbound port rules tab, click Add inbound rule. This will allow the ASG.</p> <ul> <li>Source: Application security group</li> <li>Source application security group: your_ASG</li> <li>Destination: IP addresses</li> <li>Destination IP addresses: private_IP_address/32</li> <li>Destination port range: 80</li> <li>Priority: 250</li> <li>Name: Allow_ASG</li> <li>Click Add</li> </ul> </li> <li> <p>Wait for your new inbound rule to be added.</p> </li> </ol> <p>Test the application security group</p> <ol> <li>On VM1, refresh the browser page: http://private_IP_address/default.htm.</li> <li>Verify that the page now displays.</li> </ol> <p>Task 3 - Storage endpoints (you could do this in the storage lesson)</p> <p>This task requires a storage account and virtual network with a subnet. Storage Explorer is also required.</p> <p>In this task, we will secure a storage endpoint.</p> <ol> <li>In the Portal.</li> <li>Locate your storage account.</li> <li>Create a file share, and upload a file.</li> <li>Use the Shared Access Signature blade to Generate SAS and connection string.</li> <li>Use Storage Explorer and the connection string to access the file share.</li> <li>Ensure you can view your uploaded file.</li> <li>Locate your virtual network, and then select a subnet in the virtual network.</li> <li>Under Service Endpoints, view the Services drop-down and the different services that can be secured with an endpoint.</li> <li>Check the Microsoft.Storage option.</li> <li>Save your changes.</li> <li>Return to your storage account.</li> <li>Select Firewalls and virtual networks.</li> <li>Change to Selected networks.</li> <li>Add your virtual network and verify your subnet with the new service endpoint is listed.</li> <li>Save your changes.</li> <li>Return to the Storage Explorer.</li> <li>Refresh the storage account.</li> <li>Verify you can no longer access the file share.</li> </ol> <p>Knowledge check</p> <ol> <li>When deploying the Azure Application Gateway and there's a need to ensure incoming requests are checked for common security threats like cross-site scripting and crawlers; how can this concern be addressed?</li> <li>Install a load balancer</li> <li>Install Azure Firewall</li> <li> <p>Install the Web Application Firewall(Ans)      Install the Web Application Firewall. The web application firewall (WAF) is an optional component that handles incoming requests before they reach a listener. The web application firewall checks each request for many common threats, based on the Open Web Application Security Project (OWASP).</p> </li> <li> <p>Which services below are features of Azure Application Gateway?</p> </li> <li>Authentication</li> <li>Layer 7 load balancing(Ans)      Layer 7 load balancing, Offloading of CPUT intensive SSL termination, Round robin distribution of incoming traffic. Azure Application Gateway is a dedicated virtual offering various layer 7 load balancing capabilities for your application. It lets customers optimize web farm productivity by offloading CPU intensive SSL termination to the application gateway, round robin distribution of incoming traffic, cookie-based session affinity, URL path-based routing, and the ability to host multiple websites behind a single Application Gateway.</li> <li> <p>Vulnerability assessments</p> </li> <li> <p>A company is configuring a Network Security Group. To configure the group to allow traffic from public sources, what rule needs to be added to the default rules?</p> </li> <li>Allow all virtual networks inbound and outbound</li> <li>Allow Azure load balancer inbound</li> <li> <p>Allow Internet inbound(Ans)      Allow Internet inbound. NSGs have default inbound and outbound rules. There is a default allow Internet outbound rule, but not an allow Internet inbound rule.</p> </li> <li> <p>An organization has web servers in different regions and this organization wants to optimize the availability of the servers. Which of the network security is best suited for this purpose?</p> </li> <li>Azure Application Gateway</li> <li>Azure Front Door(Ans)      Azure Front Door. Azure Front Door grants the ability to define, manage, and monitor the global routing for web traffic by optimizing for best performance and instant global failover for high availability.</li> <li>Custom routing</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#configure-and-manage-host-security","title":"Configure and manage host security","text":"<p>Introduction Once you have your network and perimeter secure, you need to lock down the host machines where your applications run. Installing updates, using jump boxes to only access servers, and following Microsoft Defender for Cloud recommendations are great tools to keep your hosts secure.</p> <p>Scenario A security engineer uses host security tools like privilege access workstation and virtual machine templates to keep application host machines secure; you will work on such tasks as:</p> <ul> <li>Deploy endpoint protection.</li> <li>Create and use a privileged access workstation.</li> <li>Set up protection tools like disk encryption and Windows Defender.</li> </ul> <p>Enable endpoint protection Microsoft Defender for Endpoint is an enterprise endpoint security platform designed to help enterprise networks prevent, detect, investigate, and respond to advanced threats.</p> <p>Defender for Endpoint uses the following combination of technology built into Windows 10 and Microsoft's robust cloud service:</p> <ul> <li>Endpoint behavioral sensors: Embedded in Windows 10, these sensors collect and process behavioral signals from the operating system and send this sensor data to your private, isolated cloud instance of Microsoft Defender for Endpoint.</li> <li>Cloud security analytics: Leveraging big data, device learning, and unique Microsoft optics across the Windows ecosystem, enterprise cloud products (such as Office 365), and online assets, behavioral signals are translated into insights, detections, and recommended responses to advanced threats.</li> <li>Threat intelligence: Generated by Microsoft hunters, security teams, and augmented by threat intelligence provided by partners, threat intelligence enables Defender for Endpoint to identify attacker tools, techniques, and procedures and generate alerts when they are observed in collected sensor data.</li> </ul> <p></p> <pre><code>Important\n\nThe capabilities on non-Windows platforms may be different from the ones for Windows.\n</code></pre> <p>Core Defender Vulnerability Management Built-in core vulnerability management capabilities use a modern risk-based approach to the discovery, assessment, prioritization, and remediation of endpoint vulnerabilities and misconfigurations.</p> <p>Attack surface reduction The attack surface reduction set of capabilities provides the first line of defense in the stack. By ensuring configuration settings are properly set and exploit mitigation techniques are applied, the capabilities resist attacks and exploitation. This set of capabilities also includes network protection and web protection, which regulate access to malicious IP addresses, domains, and URLs.</p> <p>Next-generation protection To further reinforce the security perimeter of your network, Microsoft Defender for Endpoint uses next-generation protection designed to catch all types of emerging threats.</p> <p>Endpoint detection and response Endpoint detection and response capabilities are put in place to detect, investigate, and respond to advanced threats that may have made it past the first two security pillars. Advanced hunting provides a query-based threat-hunting tool that lets you proactively find breaches and create custom detections.</p> <p>Automated investigation and remediation In conjunction with being able to quickly respond to advanced attacks, Microsoft Defender for Endpoint offers automatic investigation and remediation capabilities that help reduce the volume of alerts in minutes at scale.</p> <p>Microsoft Secure Score for Devices Defender for Endpoint includes Microsoft Secure Score for Devices to help you dynamically assess the security state of your enterprise network, identify unprotected systems, and take recommended actions to improve the overall security of your organization.</p> <p>Microsoft Threat Experts Microsoft Defender for Endpoint's new managed threat hunting service provides proactive hunting, prioritization, and additional context and insights that further empower Security operation centers (SOCs) to identify and respond to threats quickly and accurately.</p> <pre><code>Important\n\nDefender for Endpoint customers need to apply for the Microsoft Threat Experts managed threat hunting service to get proactive Targeted Attack Notifications and to collaborate with experts on demand. Experts on Demand is an add-on service. Targeted Attack Notifications are always included after you have been accepted into Microsoft Threat Experts managed threat hunting service.\n</code></pre> <p>Centralized configuration and administration, APIs</p> <p>Integrate Microsoft Defender for Endpoint into your existing workflows.</p> <p>Integration with Microsoft solutions</p> <p>Defender for Endpoint directly integrates with various Microsoft solutions, including:</p> <ul> <li>Microsoft Defender for Cloud</li> <li>Microsoft Sentinel</li> <li>Intune</li> <li>Microsoft Defender for Cloud Apps</li> <li>Microsoft Defender for Identity</li> <li>Microsoft Defender for Office</li> <li>Skype for Business</li> </ul> <p>Microsoft 365 Defender With Microsoft 365 Defender, Defender for Endpoint, and various Microsoft security solutions, form a unified pre- and post-breach enterprise defense suite that natively integrates across endpoint, identity, email, and applications to detect, prevent, investigate, and automatically respond to sophisticated attacks.</p> <p>Define a privileged access device strategy To ensure the most secure conditions for your company to you need to ensure security from the time of purchase of a new device, to its first usage, and beyond. Zero Trust, means that you don't purchase from generic retailers but only supply hardware from an authorized OEM that support Autopilot.</p> <p>For this solution, root of trust will be deployed using Windows Autopilot technology with hardware that meets the modern technical requirements. To secure a workstation, Autopilot lets you leverage Microsoft OEM-optimized Windows 10 devices. These devices come in a known good state from the manufacturer. Instead of reimaging a potentially insecure device, Autopilot can transform a Windows 10 device into a \u201cbusiness-ready\u201d state. It applies settings and policies, installs apps, and even changes the edition of Windows 10.</p> <p></p> <p>Hardware root-of-trust To have a secured workstation you need to make sure the following security technologies are included on the device:</p> <ul> <li>Trusted Platform Module (TPM) 2.0</li> <li>BitLocker Drive Encryption</li> <li>UEFI Secure Boot</li> <li>Drivers and Firmware Distributed through Windows Update</li> <li>Virtualization and HVCI Enabled</li> <li>Drivers and Apps HVCI-Ready</li> <li>Windows Hello</li> <li>DMA I/O Protection</li> <li>System Guard</li> <li>Modern Standby</li> </ul> <p>Levels of device security</p> Device Type Common usage scenario Permitted activities Security guidance Enterprise Device Home users, small business users, general purpose developers, and enterprise Run any application, browse any website Anti-malware and virus protection and policy based security posture for the enterprise. Specialized Device Specialized or secure enterprise users Run approved applications, but cannot install apps. Email and web browsing allowed. No admin controls No self administration of device, no application installation, policy based security, and endpoint management Privileged Device Extremely sensitive roles IT Operations No local admins, no productivity tools, locked down browsing. PAW device <p>This chart shows the level of device security controls based on how the device will be used.</p> <p></p> <p>Device security controls</p> <p>A secure workstation requires it be part of an end-to-end approach including device security, account security, and security policies applied to the device at all times. Here are some common security measures you should consider implementing based on the users' needs. Using a device with security measures directly aligned to the security needs of it users is the more secure solution.</p> Security Control Enterprise Device Specialized Device Privileged Device Microsoft Endpoint Manager (MEM) managed Yes Yes Yes Deny BYOD Device enrollment No Yes Yes MEM security baseline applied Yes Yes Yes Microsoft Defender for Endpoint Yes Yes Yes Join personal device via Autopilot Yes Yes No URLs restricted to approved list Allow Most Allow Most Deny Default Removal of admin rights Yes Yes Application execution control (AppLocker) Audit -&gt; Enforced Yes Applications installed only by MEM Yes Yes <p>Deploy privileged access workstations Privileged Access Workstations (PAWs) provide a dedicated system for sensitive tasks that is protected from Internet attacks and threat vectors. Separating these sensitive tasks and accounts from the daily use workstations and devices provides very strong protection from phishing attacks, application and OS vulnerabilities, various impersonation attacks, and credential theft attacks such as keystroke logging, Pass-the-Hash, and Pass-The-Ticket.</p> <p>PAW workstations PAW is a hardened and locked down workstation designed to provide high security assurances for sensitive accounts and tasks. PAWs are recommended for administration of identity systems, cloud services, and private cloud fabric as well as sensitive business functions. In order to provide the greatest security, PAWs should always run the most up-to-date and secure operating system available: Microsoft strongly recommends Windows 10 Enterprise, which includes several additional security features not available in other editions (in particular, Credential Guard and Device Guard).</p> <p>The PAW security controls are focused on mitigating high impact and high probability risks of compromise. These include mitigating attacks on the environment and risks that can decrease the effectiveness of PAW controls over time:</p> <ul> <li>Internet attacks - Isolating the PAW from the open internet is a key element to ensuring the PAW is not compromised.</li> <li>Usability risk - If a PAW is too difficult to use for daily tasks, administrators will be motivated to create workarounds to make their jobs easier.</li> <li>Environment risks - Minimizing the use of management tools and accounts that have access to the PAWs to secure and monitor these specialized workstations.</li> <li>Supply chain tampering - Taking a few key actions can mitigate critical attack vectors that are readily available to attackers. This includes validating the integrity of all installation media (Clean Source Principle) and using a trusted and reputable supplier for hardware and software.</li> <li>Physical attacks - Because PAWs can be physically mobile and used outside of physically secure facilities, they must be protected against attacks that leverage unauthorized physical access to the computer.</li> </ul> <p>Architecture overview The diagram below depicts a separate \"channel\" for administration (a highly sensitive task) that is created by maintaining separate dedicated administrative accounts and workstations.</p> <p></p> <p>This architectural approach builds on the protections found in the Windows 10 Credential Guard and Device Guard features and goes beyond those protections for sensitive accounts and tasks.</p> <p>This methodology is appropriate for accounts with access to high value assets:</p> <ul> <li>Administrative Privileges - PAWs provide increased security for high impact IT administrative roles and tasks. This architecture can be applied to administration of many types of systems including Active Directory Domains and Forests, Microsoft Azure Active Directory tenants, Microsoft 365 tenants, Process Control Networks (PCN), Supervisory Control and Data Acquisition (SCADA) systems, Automated Teller Machines (ATMs), and Point of Sale (PoS) devices.</li> <li>High Sensitivity Information workers - The approach used in a PAW can also provide protection for highly sensitive information worker tasks and personnel such as those involving pre-announcement Merger and Acquisition activity, pre-release financial reports, organizational social media presence, executive communications, unpatented trade secrets, sensitive research, or other proprietary or sensitive data. This guidance does not discuss the configuration of these information worker scenarios in depth or include this scenario in the technical instructions.</li> </ul> <p>Securing privileged access is a critical first step to establishing security assurances for business assets in a modern organization. The security of most or all business assets in an IT organization depends on the integrity of the privileged accounts used to administer, manage, and develop.</p> <p>Jump Box</p> <p>Administrative \"Jump Box\" architectures set up a small number administrative console servers and restrict personnel to using them for administrative tasks. This is typically based on remote desktop services, a 3rd-party presentation virtualization solution, or a Virtual Desktop Infrastructure (VDI) technology.</p> <p>This approach is frequently proposed to mitigate risk to administration and does provide some security assurances, but the jump box approach by itself is vulnerable to certain attacks because it violates the clean source principle. The clean source principle requires all security dependencies to be as trustworthy as the object being secured.</p> <p></p> <p>This figure depicts a simple control relationship. Any subject in control of an object is a security dependency of that object. If an adversary can control a security dependency of a target object (subject), they can control that object.</p> <p>The administrative session on the jump server relies on the integrity of the local computer accessing it. If this computer is a user workstation subject to phishing attacks and other internet-based attack vectors, then the administrative session is also subject to those risks.</p> <p>While some advanced security controls like multifactor authentication can increase the difficulty of an attacker taking over this administrative session from the user workstation, no security feature can fully protect against technical attacks when an attacker has administrative access of the source computer (e.g. injecting illicit commands into a legitimate session, hijacking legitimate processes, and so on.)</p> <p>The default configuration in this PAW guidance installs administrative tools on the PAW, but a jump server architecture can also be added if required.</p> <p></p> <p>This above figure shows how reversing the control relationship and accessing user apps from an admin workstation gives the attacker no path to the targeted object. The user jump box is still exposed to risk so appropriate protective controls, detective controls, and response processes should still be applied for that internet-facing computer.</p> <p>Create virtual machine templates</p> <p>Before diving into configuring VM policies and templates, you need to understand the features and functionality of Azure Resource Manager.</p> <p>Resource Manager is the deployment and management service for your Azure subscription. It provides a consistent management layer that allows you to create, update, and delete resources in your Azure subscription. You can use its access control, auditing, and tagging features to help secure and organize your resources after deployment.</p> <p>When you take actions through the Azure portal, Azure PowerShell, the Azure CLI, REST APIs, or client SDKs, the Resource Manager API handles your request. Because the same API handles all requests, you get consistent results and capabilities in all the different tools.</p> <p>Here are some additional terms to know when using Resource Manager:</p> <ul> <li>Resource provider. A service that supplies Azure resources. For example, a common resource provider is Microsoft.Compute, which supplies the VM resource. Microsoft.Storage is another common resource provider.</li> <li>Resource Manager template. A JSON file that defines one or more resources to deploy to a resource group or subscription. You can use the template to consistently and repeatedly deploy the resources.</li> <li>Declarative syntax. Syntax that lets you state, \"Here\u2019s what I intend to create\" without having to write the sequence of programming commands to create it. The Resource Manager template is an example of declarative syntax. In the file, you define the properties for the infrastructure to deploy to Azure.</li> </ul> <p>You can use the Resource Manager template to define your VMs. After they are defined you can easily deploy and redeploy them. We recommend periodically redeploying your VMs to force the deployment of a freshly updated and security-enhanced VM OS.</p> <p>Template design How you define templates and resource groups is entirely up to you and how you want to manage your solution. For example, you can deploy your three tier application through a single template to a single resource group.</p> <p></p> <p>But, you don't have to define your entire infrastructure in a single template. Often, it makes sense to divide your deployment requirements into a set of targeted, purpose-specific templates. You can easily reuse these templates for different solutions. To deploy a particular solution, you create a master template that links all the required templates. If you envision your tiers having separate lifecycles, you can deploy your three tiers to separate resource groups. Notice the resources can still be linked to resources in other resource groups.</p> <p></p> <pre><code>Important\n\nWhen you deploy a template, Resource Manager converts the template into REST API operations.\n</code></pre> <p>Enable and secure remote access management</p> <p>This topic explains how to connect to and sign into the virtual machines (VMs) you created on Azure. Once you've successfully connected, you can work with the VM as if you were locally logged on to its host server.</p> <p>Connect to a Windows VM</p> <p>The most common way to connect to a Windows based VM running in Azure is by using Remote Desktop Protocol (RDP). Most versions of Windows natively contain support for the remote desktop protocol (RDP). If you are connecting to a Windows VM from a Mac, you will need to install an RDP client for Mac.</p> <p>If you are using PowerShell and have the Azure PowerShell module installed you may also connect using the Get-AzRemoteDesktopFile cmdlet.</p> <p>Connect to a Linux-based VM</p> <p>To connect the Linux-based VM, you need a secure shell protocol (SSH) client. The most used free tool is PuTTY SSH terminal. The following shows the PuTTY configuration dialog.</p> <p></p> <p>Azure Bastion The Azure Bastion service is a fully platform-managed PaaS service that you provision inside your virtual network. It provides secure and seamless RDP/SSH connectivity to your virtual machines directly in the Azure portal over TLS. When you connect using Azure Bastion, your virtual machines do not need a public IP address.</p> <p>Bastion provides secure RDP and SSH connectivity to all the VMs in the virtual network in which it is provisioned. Using Azure Bastion protects your virtual machines from exposing RDP/SSH ports to the outside world, while still providing secure access using RDP/SSH. With Azure Bastion, you connect to the virtual machine directly from the Azure portal.</p> <p>Architecture Azure Bastion is deployed to a virtual network and supports virtual network peering. Specifically, Azure Bastion manages RDP/SSH connectivity to VMs created in the local or peered virtual networks.</p> <p>RDP and SSH are some of the fundamental means through which you can connect to your workloads running in Azure. Exposing RDP/SSH ports over the Internet isn't desired and is seen as a significant threat surface. This is often due to protocol vulnerabilities. To contain this threat surface, you can deploy bastion hosts (also known as jump-servers) at the public side of your perimeter network. Bastion host servers are designed and configured to withstand attacks. Bastion servers also provide RDP and SSH connectivity to the workloads sitting behind the bastion, as well as further inside the network.</p> <p></p> <p>This figure shows the architecture of an Azure Bastion deployment. In this diagram:</p> <ul> <li>The Bastion host is deployed in the virtual network.</li> <li>The user connects to the Azure portal using any HTML5 browser.</li> <li>The user selects the virtual machine to connect to.</li> <li>With a single click, the RDP/SSH session opens in the browser.</li> <li>No public IP is required on the Azure VM.</li> </ul> <p>Key features</p> <p>The following features are available:</p> <ul> <li>RDP and SSH directly in Azure portal: You can directly get to the RDP and SSH session directly in the Azure portal using a single click seamless experience.</li> <li>Remote Session over TLS and firewall traversal for RDP/SSH: Azure Bastion uses an HTML5 based web client that is automatically streamed to your local device, so that you get your RDP/SSH session over TLS on port 443 enabling you to traverse corporate firewalls securely.</li> <li>No Public IP required on the Azure VM: Azure Bastion opens the RDP/SSH connection to your Azure virtual machine using private IP on your VM. You don't need a public IP on your virtual machine.</li> <li>No hassle of managing NSGs: Azure Bastion is a fully managed platform PaaS service from Azure that is hardened internally to provide you secure RDP/SSH connectivity. You don't need to apply any NSGs on Azure Bastion subnet. Because Azure Bastion connects to your virtual machines over private IP, you can configure your NSGs to allow RDP/SSH from Azure Bastion only.</li> <li>Protection against port scanning: Because you do not need to expose your virtual machines to public Internet, your VMs are protected against port scanning by rogue and malicious users located outside your virtual network.</li> <li>Protect against zero-day exploits. Hardening in one place only: Azure Bastion is a fully platform-managed PaaS service. Because it sits at the perimeter of your virtual network, you don\u2019t need to worry about hardening each of the virtual machines in your virtual network.</li> </ul> <p>Configure update management</p> <p>Azure Update Management is a service included as part of your Azure subscription. With Update Management, you can assess your update status across your environment and manage your Windows Server and Linux server updates from a single location\u2014for both your on-premises and Azure environments.</p> <p>Update Management is available at no additional cost (you pay only for the log data that Azure Log Analytics stores), and you can easily enable it for Azure and on-premises VMs. To try it, navigate to your VM tab in Azure, and then enable Update Management for one or more of your VMs. You can also enable Update Management for VMs directly from your Azure Automation account. Making updates easy, is one of the key factors in maintaining good security hygiene.</p> <p>Azure Update Management overview</p> <p>Computers that Update Management manages use the following configurations to perform assessment and update deployments:</p> <ul> <li>Microsoft Monitoring Agent (MMA) for Windows or Linux</li> <li>Desired State Configuration (DSC) in Windows PowerShell for Linux</li> <li>Hybrid Runbook Worker in Azure Automation</li> <li>Microsoft Update or Windows Server Update Services (WSUS) for Windows computers</li> </ul> <p>Azure Automation uses runbooks to install updates. You can't view these runbooks, and they don\u2019t require any configuration. When an update deployment is created, it creates a schedule that starts a master update runbook at the specified time for the included computers. The master runbook starts a child runbook on each agent to install the required updates.</p> <p>The following diagram is a conceptual depiction of the behavior and data flow together with how the solution assesses and applies security updates to all connected Windows Server and Linux computers in a workspace.</p> <p></p> <p>Manage updates for multiple machines</p> <p>You can use the Update Management solution to manage updates and patches for your Windows and Linux virtual machines. From your Azure Automation account, you can:</p> <ul> <li>Onboard virtual machines</li> <li>Assess the status of available updates</li> <li>Schedule installation of required updates</li> <li>Review deployment results to verify that updates were applied successfully to all virtual machines for which Update Management is enabled</li> </ul> <p>The Log Analytics agent for Windows and Linux needs to be installed on the VMs that are running on your corporate network or other cloud environment in order to enable them with Update Management.</p> <p>After you enable Update Management for your machines, you can view machine information by selecting Computers. You can view information about machine name, compliance status, environment, OS type, critical and security updates installed, other updates installed, and update agent readiness for your computers.</p> <p></p> <p>Computers that have recently been enabled for Update Management might not have been assessed yet. The compliance state status for those computers is Not assessed.</p> <p>Update inclusion</p> <p>Azure Update Management provides the ability to deploy patches based on classifications. However, there are scenarios where you may want to explicitly list the exact set of patches. Common scenarios include allowing specific patches after canary environment testing and zero-day patch rollouts.</p> <p>With update inclusion lists you can choose exactly which patches you want to deploy instead of relying on patch classifications.</p> <p>Deploy disk encryption</p> <p>Azure Disk Encryption for Windows VMs helps protect and safeguard your data to meet your organizational security and compliance commitments. It uses the BitLocker feature of Windows to provide volume encryption for the OS and data disks of Azure virtual machines (VMs), and is integrated with Azure Key Vault to help you control and manage the disk encryption keys and secrets.</p> <p></p> <p>If you use Microsoft Defender for Cloud, you'll be alerted if you have VMs that aren't encrypted. The alerts show as High Severity and the recommendation is to encrypt these VMs.</p> <p>Azure Disk Encryption is zone resilient, the same way as Virtual Machines.</p> <p>Supported VMs and operating systems</p> <p>Supported VMs Windows VMs are available in a range of sizes. Azure Disk Encryption is supported on Generation 1 and Generation 2 VMs. Azure Disk Encryption is also available for VMs with premium storage.</p> <p>Azure Disk Encryption is not available on Basic, A-series VMs, or on virtual machines with less than 2 GB of memory.</p> <p>Supported operating systems    - Windows client: Windows 8 and later.    - Windows Server: Windows Server 2008 R2 and later.    - Windows 10 Enterprise multi-session.</p> <p>Networking requirements To enable Azure Disk Encryption, the VMs must meet the following network endpoint configuration requirements:</p> <ul> <li>To get a token to connect to your key vault, the Windows VM must be able to connect to an Azure Active Directory endpoint, [login.microsoftonline.com].</li> <li>To write the encryption keys to your key vault, the Windows VM must be able to connect to the key vault endpoint.</li> <li>The Windows VM must be able to connect to an Azure storage endpoint that hosts the Azure extension repository and an Azure storage account that hosts the VHD files.</li> <li>If your security policy limits access from Azure VMs to the Internet, you can resolve the preceding URI and configure a specific rule to allow outbound connectivity to the IPs.</li> </ul> <p>Group Policy requirements</p> <p>Azure Disk Encryption uses the BitLocker external key protector for Windows VMs. For domain joined VMs, don't push any group policies that enforce TPM protectors.</p> <p>BitLocker policy on domain joined virtual machines with custom group policy must include the following setting: Configure user storage of BitLocker recovery information -&gt; Allow 256-bit recovery key. Azure Disk Encryption will fail when custom group policy settings for BitLocker are incompatible. On machines that didn't have the correct policy setting, apply the new policy, force the new policy to update (gpupdate.exe /force), and then restarting may be required.</p> <p>Azure Disk Encryption will fail if domain level group policy blocks the AES-CBC algorithm, which is used by BitLocker.</p> <p>Encryption key storage requirements</p> <p>Azure Disk Encryption requires an Azure Key Vault to control and manage disk encryption keys and secrets. Your key vault and VMs must reside in the same Azure region and subscription.</p> <p>Azure Disk Encryption for Linux VMs</p> <p>Azure Disk Encryption helps protect and safeguard your data to meet your organizational security and compliance commitments. It uses the DM-Crypt feature of Linux to provide volume encryption for the OS and data disks of Azure virtual machines (VMs) and is integrated with Azure Key Vault to help you control and manage the disk encryption keys and secrets.</p> <p>As for Windows VMs, if you use Microsoft Defender for Cloud, you're alerted if you have VMs that aren't encrypted. The alerts show as High Severity and the recommendation is to encrypt these VMs.</p> <p>Supported VMs and operating systems</p> <p>Supported VMs Linux VMs are available in a range of sizes. Azure Disk Encryption is supported on Generation 1 and Generation 2 VMs. Azure Disk Encryption is also available for VMs with premium storage.</p> <p>Note: Azure Disk Encryption is not available on Basic, A-series VMs, or on virtual machines that do not meet these minimum memory requirements:</p> Virtual machine Minimum memory requirement Linux VMs when only encrypting data volumes 2 GB Linux VMs when encrypting both data and OS volumes, and where the root (/) file system usage is 4GB or less 8 GB Linux VMs when encrypting both data and OS volumes, and where the root (/) file system usage is greater than 4GB The root file system usage * 2. For instance, a 16 GB of root file system usage requires at least 32GB of RAM <p>Once the OS disk encryption process is complete on Linux virtual machines, the VM can be configured to run with less memory.</p> <p>Azure Disk Encryption requires the dm-crypt and vfat modules to be present on the system. Removing or disabling vfat from the default image will prevent the system from reading the key volume and obtaining the key needed to unlock the disks on subsequent reboots. System hardening steps that remove the vfat module from the system are not compatible with Azure Disk Encryption</p> <p>Managed disk encryption options</p> <p>Managed disk Encryption Options</p> <p>There are several types of encryption available for your managed disks, including Azure Disk Encryption (ADE), Server-Side Encryption (SSE), and encryption at the host.</p> <ul> <li>Azure Disk Encryption helps protect and safeguard your data to meet organizational security and compliance commitments. ADE encrypts the OS and data disks of Azure virtual machines (VMs) inside your VMs by using the device mapper DM-Crypt feature of Linux or the BitLocker feature of Windows. Azure Disk Encryption (ADE) is integrated with Azure Key Vault to help you control and manage the disk encryption keys and secrets.</li> <li>Azure Disk Storage Server-Side Encryption (also referred to as encryption-at-rest or Azure Storage encryption) automatically encrypts data stored on Azure-managed disks (OS and data disks) when persisting on the Storage Clusters. When configured with a Disk Encryption Set (DES), it supports customer-managed keys as well.</li> <li>Encryption at the host ensures that data stored on the VM host hosting your VM is encrypted at rest and flows encrypted to the Storage clusters.</li> <li>Confidential disk encryption binds disk encryption keys to the virtual machine's TPM (Trusted Platform Module) and makes the protected disk content accessible only to the VM. The TPM and VM guest state is always encrypted in attested code using keys released by a secure protocol that bypasses the hypervisor and host operating system. Currently only available for the OS disk. Encryption at the host may be used for other disks on a Confidential VM in addition to Confidential Disk Encryption.</li> </ul> <p>Encryption is part of a layered approach to security and should be used with other recommendations to secure Virtual Machines and their disks.</p> <p>Comparison</p> <p>The following is a comparison of Storage Server-Side Encryption (SSE), Azure Disk Encryption (ADE), encryption at the host, and Confidential disk encryption.</p> <p></p> <pre><code>Important\n\nFor Encryption at the host and Confidential disk encryption, Microsoft Defender for Cloud does not detect the encryption state. We are in the process of updating Microsoft Defender.\n</code></pre> <p>Deploy and configure Windows Defender Windows 10, Windows Server 2019, and Windows Server 2016 include key security features. They are Windows Defender Credential Guard, Windows Defender Device Guard, and Windows Defender Application Control.</p> <p>Windows Defender Credential Guard Introduced in Windows 10 Enterprise and Windows Server 2016, Windows Defender Credential Guard uses virtualization-based security enhancement to isolate secrets so that only privileged system software can access them. Unauthorized access to these secrets might lead to credential theft attacks, such as Pass-the-Hash or pass-the-ticket attacks. Windows Defender Credential Guard helps prevent these attacks by helping protect Integrated Windows Authentication (NTLM) password hashes, Kerberos authentication ticket-granting tickets, and credentials that applications store as domain credentials.</p> <p>By enabling Windows Defender Credential Guard, you get the following features and solutions:</p> <ul> <li>Hardware security enhancement. NTLM, Kerberos, and Credential Manager take advantage of platform security features, including Secure Boot and virtualization, to help protect credentials.</li> <li>Virtualization-based security enhancement. NTLM-derived credentials, Kerberos-derived credentials, and other secrets run in a protected environment that is isolated from the running operating system.</li> <li>Better protection against advanced persistent threats. When virtualization-based security enhancement helps protect Credential Manager domain credentials, NTLM-derived credentials, and Kerberos-derived credentials, the credential theft attack techniques and tools that many targeted attacks use are blocked. Malware running in the OS with administrative privileges can\u2019t extract secrets that virtualization-based security helps protect. Although Windows Defender Credential Guard provides powerful mitigation, persistent threat attacks will likely shift to new attack techniques, so you should also incorporate Windows Defender Device Guard and other security strategies and architectures.</li> </ul> <p>Windows Defender Device Guard and Windows Defender Application Control</p> <p>The configuration state of Windows Defender Device Guard was originally designed with a specific security idea in mind. Although no direct dependencies existed between the two main OS features of the Windows Defender Device Guard configuration\u2014that is, between configurable code integrity and Hypervisor-protected code integrity (HVCI)\u2014the discussion intentionally focused on the Windows Defender Device Guard lockdown state that can be achieved when they\u2019re deployed together.</p> <p>However, the use of the term device guard to describe this configuration state has unintentionally left many IT pros with the impression that the two features are inexorably linked and can\u2019t be separately deployed. Additionally, because HVCI relies on security based on Windows virtualization, it comes with additional hardware, firmware, and kernel driver compatibility requirements that some older systems can\u2019t meet.</p> <p>As a result, many IT pros assumed that because some systems couldn't use HVCI, they couldn\u2019t use configurable code integrity, either. But configurable code integrity has no specific hardware or software requirements other than running Windows 10, which means that many IT pros were wrongly denied the benefits of this powerful application control capability.</p> <p>Since the initial release of Windows 10, the world has witnessed numerous hacking and malware attacks where application control alone might have prevented the attack altogether. Configurable code integrity is now documented as an independent technology within the Microsoft security stack and given a name of its own: Windows Defender Application Control.</p> <p>Application control is a crucial line of defense for helping protect enterprises given today\u2019s threat landscape, and it has an inherent advantage over traditional antivirus solutions. Specifically, application control moves away from the traditional application trust model, in which all applications are assumed trustworthy by default, to one where applications must earn trust to run. Many organizations understand this and frequently cite application control as one of the most effective means for addressing the threat of malware based on executable files (such as .exe and .dll files).</p> <p>Windows Defender Application Control helps mitigate these types of threats by restricting the applications that users can run and the code that runs in the system core, or kernel. Policies in Windows Defender Application Control also block unsigned scripts and MSIs, and Windows PowerShell runs in Constrained language mode.</p> <p>Does this mean the Windows Defender Device Guard configuration state is going away? Not at all. The term device guard will continue to describe the fully locked down state achieved using Windows Defender Application Control, HVCI, and hardware and firmware security features. It will also allow Microsoft to work with its original equipment manufacturer (OEM) partners to identify specifications for devices that are device guard capable\u2014so that joint customers can easily purchase devices that meet all the hardware and firmware requirements of the original locked down scenario of Windows Defender Device Guard for Windows 10 devices.</p> <p>Microsoft Defender for Endpoint - Supported Operating Systems</p> <p></p> <p>Microsoft cloud security benchmark in Defender for Cloud</p> <p>The Microsoft cloud security benchmark (MCSB) provides prescriptive best practices and recommendations to help improve the security of workloads, data, and services on Azure and your multicloud environment. This benchmark focuses on cloud-centric control areas with input from a set of holistic Microsoft and industry security guidance that includes:</p> <ul> <li>Cloud Adoption Framework: Guidance on security, including strategy, roles and responsibilities, Azure Top 10 Security Best Practices, and reference implementation.</li> <li>Azure Well-Architected Framework: Guidance on securing your workloads on Azure.</li> <li>The Chief Information Security Officer (CISO) Workshop: Program guidance and reference strategies to accelerate security modernization using Zero Trust principles.</li> <li>Other industry and cloud service provider's security best practice standards and framework: Examples include the Amazon Web Services (AWS) Well-Architected Framework, Center for Internet Security (CIS) Controls, National Institute of Standards and Technology (NIST), and Payment Card Industry Data Security Standard (PCI-DSS).</li> </ul> <p>Microsoft cloud security benchmark features</p> <p>Comprehensive multicloud security framework: Organizations often have to build an internal security standard to reconcile security controls across multiple cloud platforms to meet security and compliance requirements on each of them. This often requires security teams to repeat the same implementation, monitoring, and assessment across the different cloud environments (often for different compliance standards). This creates unnecessary overhead, cost, and effort. To address this concern, we enhanced the Azure Security Benchmark (ASB) to the Microsoft cloud security benchmark (MCSB) to help you quickly work with different clouds by:</p> <ul> <li>Providing a single control framework to easily meet the security controls across clouds</li> <li>Providing consistent user experience for monitoring and enforcing the multicloud security benchmark in Defender for Cloud</li> <li>Staying aligned with Industry Standards (e.g., Center for Internet Security, National Institute of Standards and Technology, Payment Card Industry)</li> </ul> <p></p> <p>Automated control monitoring for AWS in Microsoft Defender for Cloud: You can use Microsoft Defender for Cloud Regulatory Compliance Dashboard to monitor your AWS environment against Microsoft cloud security benchmark (MCSB), just like how you monitor your Azure environment. We developed approximately 180 AWS checks for the new AWS security guidance in MCSB, allowing you to monitor your AWS environment and resources in Microsoft Defender for Cloud.</p> <p>Example: Microsoft Defender for Cloud - Regulatory compliance dashboard</p> <p></p> <p>Azure guidance and security principles: Azure security guidance, security principles, features, and capabilities.</p> <p>Controls</p> Control Domains Description Network security (NS) Network Security covers controls to secure and protect networks, including securing virtual networks, establishing private connections, preventing and mitigating external attacks, and securing Domain Name System (DNS). Identity Management (IM) Identity Management covers controls to establish a secure identity and access controls using identity and access management systems, including the use of single sign-on, strong authentications, managed identities (and service principals) for applications, conditional access, and account anomalies monitoring. Privileged Access (PA) Privileged Access covers controls to protect privileged access to your tenant and resources, including a range of controls to protect your administrative model, administrative accounts, and privileged access workstations against deliberate and inadvertent risk. Data Protection (DP) Data Protection covers control of data protection at rest, in transit, and via authorized access mechanisms, including discover, classify, protect, and monitoring sensitive data assets using access control, encryption, key management, and certificate management. Asset Management (AM) Asset Management covers controls to ensure security visibility and governance over your resources, including recommendations on permissions for security personnel, security access to asset inventory and managing approvals for services and resources (inventory, track, and correct). Logging and Threat Detection (LT) Logging and Threat Detection covers controls for detecting threats on the cloud and enabling, collecting, and storing audit logs for cloud services, including enabling detection, investigation, and remediation processes with controls to generate high-quality alerts with native threat detection in cloud services; it also includes collecting logs with a cloud monitoring service, centralizing security analysis with a security event management (SEM), time synchronization, and log retention. Incident Response (IR) Incident Response covers controls in the incident response life cycle - preparation, detection and analysis, containment, and post-incident activities, including using Azure services (such as Microsoft Defender for Cloud and Sentinel) and/or other cloud services to automate the incident response process. Posture and Vulnerability Management (PV) Posture and Vulnerability Management focuses on controls for assessing and improving the cloud security posture, including vulnerability scanning, penetration testing, and remediation, as well as security configuration tracking, reporting, and correction in cloud resources. Endpoint Security (ES) Endpoint Security covers controls in endpoint detection and response, including the use of endpoint detection and response (EDR) and anti-malware service for endpoints in cloud environments. Backup and Recovery (BR) Backup and Recovery covers controls to ensure that data and configuration backups at the different service tiers are performed, validated, and protected. DevOps Security (DS) DevOps Security covers the controls related to the security engineering and operations in the DevOps processes, including deployment of critical security checks (such as static application security testing and vulnerability management) prior to the deployment phase to ensure the security throughout the DevOps process; it also includes common topics such as threat modeling and software supply security. Governance and Strategy (GS) Governance and Strategy provides guidance for ensuring a coherent security strategy and documented governance approach to guide and sustain security assurance, including establishing roles and responsibilities for the different cloud security functions, unified technical strategy, and supporting policies and standards. <p>Explore Microsoft Defender for Cloud recommendations</p> <p>What is a security recommendation?</p> <p>Using the policies, Defender for Cloud periodically analyzes the compliance status of your resources to identify potential security misconfigurations and weaknesses. It then provides you with recommendations on how to remediate those issues. Recommendations result from assessing your resources against the relevant policies and identifying resources that aren't meeting your defined requirements.</p> <p>Defender for Cloud makes its security recommendations based on your chosen initiatives. When a policy from your initiative is compared against your resources and finds one or more that aren't compliant, it is presented as a recommendation in Defender for Cloud.</p> <p>Example: Microsoft Defender for Cloud - All recommendations</p> <p></p> <p>Recommendations are actions for you to take to secure and harden your resources. Each recommendation provides you with the following information:</p> <ul> <li>A short description of the issue</li> <li>The remediation steps to carry out in order to implement the recommendation</li> <li>The affected resources</li> </ul> <p>In practice, it works like this:</p> <ol> <li>Azure Security Benchmark is an initiative that contains requirements.       For example, Azure Storage accounts must restrict network access to reduce their attack surface.</li> <li>The initiative includes multiple policies, each requiring a specific resource type. These policies enforce the requirements in the initiative.    To continue the example, the storage requirement is enforced with the policy \"Storage accounts should restrict network access using virtual network rules.\"</li> <li>Microsoft Defender for Cloud continually assesses your connected subscriptions. If it finds a resource that doesn't satisfy a policy, it displays a recommendation to fix that situation and harden the security of resources that aren't meeting your security requirements.</li> </ol> <p>For example, if an Azure Storage account on your protected subscriptions isn't protected with virtual network rules, you'll see the recommendation to harden those resources.</p> <p>So, (1) an initiative includes (2) policies that generate (3) environment-specific recommendations.</p> <p>Perform Try-This exercises</p> <p>Use this Try-This exercises to get some hands-on experience with Azure.</p> <p>In this demonstration, we'll configure the Bastion service, virtual machine updates, virtual machine extensions, and disk encryption. Optionally, we'll use RDP to connect to a Windows virtual machine and SSH to connect to a Linux machine.</p> <p>Task 1 - Use the Bastion service</p> <pre><code>Note\n\nThis task requires a virtual machine. If you are doing the next task, virtual machine updates, use a Windows virtual machine and keep the session running.\n</code></pre> <p>In this task, we'll configure the Bastion service and connect to a virtual machine with service.</p> <p>Configure the Bastion service</p> <ol> <li>In the Portal navigate to your Windows virtual machine.</li> <li>Ensure the virtual machine is Running.</li> <li>Click Connect and select Bastion.</li> <li>Click Use Bastion. Note installing the service is only required once.</li> <li>Because you are creating the Bastion service from the target virtual machine, mention that most of the networking information has automatically been filled in. Note the Bastion service will be assigned a public IP address.</li> <li>To create the Bastion subnet in the virtual network, click Manage subnet configuration.</li> <li>On the virtual network subnet blade, click + Subnet.</li> <li>On the Add subnet page, type AzureBastionSubnet as the subnet name. Note this name can't be changed.</li> <li>Specify the address range in CIDR notation. For example, 10.1.1.0/27.</li> <li>Click Ok, then click Create. It will take a few minutes for the service to deploy.</li> </ol> <p>Connect to the virtual machine using Bastion</p> <ol> <li>From the target virtual machine\u2019s Overview blade, select Connect and then Bastion</li> <li>On the Connect to Bastion page, enter the virtual machine login credentials.</li> <li>Notice the checkbox to open the session in a new window.</li> <li>Click Connect. If you receive a message that popup windows are blocked, allow the session.</li> <li>Once your session is connected, launch the Bastion clipboard access tool palette by selecting the two arrows. The arrows are located on the left center of the session. Explain this copy and paste feature.</li> <li>In the Portal, navigate to the Bastion host and under Settings select Sessions.</li> <li>Review the session management experience and the ability to delete a session.</li> <li>As you have time, review the Bastion components and how this provides a secure way to access your virtual machines.</li> </ol> <p>Task 2 - Virtual Machine Updates</p> <pre><code>Note\n\nThis task requires a virtual machine in the running state. You may want to enable Update management prior to this lesson.\n</code></pre> <p>In this task, we'll review virtual machine update management.</p> <ol> <li>In the Portal, navigate to your virtual machine.</li> <li>Under Operations select Update management.</li> <li>Select the Azure Log Analytics workspace and Automation account, and then click Enable.</li> <li>Wait for update management to deploy. It can take up to 15 minutes for the deployment and longer for results to be provided.</li> <li>Select Missing Updates and use the Information link to open the support article for the update.</li> <li>Select Schedule update deployment.</li> <li>Review the various options including maintenance windows, reboot options, scheduling, classifications, kbs to include and exclude.</li> <li>You can view the status for the deployment on the Update deployments tab. The available values aren't attempted, succeeded, and failed.</li> </ol> <p>Task 3 - Virtual Machine Extensions</p> <p>In this task, we'll install the IaaSAntimalware extension.</p> <ol> <li>In the Portal, select your virtual machine.</li> <li>Under Settings, click Extensions. Review how extensions are used.</li> <li>On the Extensions page, click + Add.</li> <li>Scroll through the available extensions and review what extensions are available.</li> <li>Select Microsoft Antimalware. Discuss the features of this extension.</li> <li>Click Create.</li> <li>On the Install extension page use the informational icons to explain Excluded files and locations, Excluded file extensions, and Excluded processes.</li> <li>Review Real-time protection and Run a scheduled scan.</li> <li>Review other options of interest.</li> <li>After the extension is deployed, the extensions page will show the IaaSAntimalware extension.</li> </ol> <p>Task 4 - Disk Encryption</p> <pre><code>Note\n\nThis task requires a storage account.\n</code></pre> <p>In this task, we'll enable disk encryption for a storage account.</p> <p>Review encryption key options</p> <ol> <li>In the Portal, access your storage account.</li> <li>Under Security + networking, select Encryption.</li> <li>Review Storage Service Encryption and why it is used.</li> <li>Review the two types of keys: Microsoft Managed Keys and Customer Managed Keys.</li> <li>Select Customer Managed Keys.</li> </ol> <p>Create the customer managed key</p> <ol> <li>For Encryption key choose Select from key vault.</li> <li>Click Select a key vault and key.</li> <li>You will now create a new key vault. If you already had a key vault you could use that.</li> <li> <p>For Key vault select Create new.</p> <ul> <li>Notice the key vault will be created in the same region as the storage account.</li> <li>Give your key vault a name.</li> <li>Click Review + create.</li> <li>Once the validation passes, click Create.</li> <li>Wait for the key vault to be created.</li> </ul> </li> <li> <p>You will now create a key in the key vault. If you already had a key you could use that.</p> </li> <li>On the Select key from Azure key vault page, for Key select Create new.<ul> <li>Review the options for creating a key.</li> <li>Give your key a name.</li> <li>Notice the activation and expiration options.</li> <li>Click Create.</li> </ul> </li> <li>Now that you have created a key vault and key, Select the key vault and key.</li> <li>Save your changes on the Encryption page.</li> <li>Review the information that is now available: Current key, Automated key rotation, and Key version in use.</li> </ol> <p>Review the key options</p> <ol> <li>Return to the resource group that includes your storage account.</li> <li>Refresh the page and ensure your new key vault is listed as a resource.</li> <li>Select the key vault.</li> <li>Under Settings click Keys.</li> <li>Ensure your new key is Enabled. Notice the ability to regenerate the key.</li> <li>Select the key and review the current version information.</li> <li>Return to the key vault page.</li> <li>Under Settings select Access policies.</li> <li>Under Current access policies your storage account will be listed.</li> <li>Notice the drop-downs for Key Permissions, Secret Permissions, and Certificate Permissions.</li> <li>Select Key Permissions and notice the properties that are checked (Get, Unwrap key, and Wrap key).</li> </ol> <p>Task 5 - Use RDP to connect to a Windows VM (optional)</p> <pre><code>Note\n\nThis task requires a Windows VM with a public IP address. You also need the login credentials for the machine.\n</code></pre> <p>In this task, we'll use RDP to connect to a Windows virtual machine.</p> <ol> <li>In the Portal navigate to your Windows virtual machine.</li> <li>Ensure the virtual machine is Running.</li> <li>From the Overview blade select Connect and then RDP.</li> <li>In the Connect to virtual machine page, keep the default options to connect by DNS name over port 3389 and click Download RDP file.</li> <li>Mention that if the VM has a just-in-time policy set, you first need to select the Request access button to request access before you can download the RDP file.</li> <li>Open the downloaded RDP file and then click Connect.</li> <li>In the Windows Security window, select More choices and then Use a different account.</li> <li>Type the username as localhost\\username, enter password you created for the virtual machine, and then select OK.</li> <li>You may receive a certificate warning during the sign-in process. Select Yes or Continue to create the connection.</li> <li>Explain how RDP is different from the Bastion service.</li> </ol> <p>Task 6 - Use SSH to connect to a Linux VM (optional)</p> <pre><code>Note\n\nThis task requires a Linux VM. Ensure port 22 is open.\n</code></pre> <p>In this task, we'll create an SSH private key with PuTTYgen, and then use SSH to connect to a Linux virtual machine.</p> <p>Create the SSH Keys</p> <ol> <li>Download the PuTTY tool. This will include PuTTYgen - https://putty.org/</li> <li>Once installed, locate and open the PuTTYgen program.</li> <li>In the Parameters option group choose RSA.</li> <li>Click the Generate button.</li> <li>Move your mouse around the blank area in the window to generate some randomness.</li> <li>Copy the text of the Public key for pasting into authorized keys file.</li> <li>Optionally you can specify a Key passphrase and then Confirm passphrase. You will be prompted for the passphrase when you authenticate to the VM with your private SSH key. Without a passphrase, if someone obtains your private key, they can sign in to any VM or service that uses that key. We recommend you create a passphrase. However, if you forget the passphrase, there is no way to recover it.</li> <li>Click Save private key.</li> <li>Choose a location and filename and click Save. You'll need this file to access the VM.</li> </ol> <p>Create the Linux machine and assign the public SSH key</p> <ol> <li>In the portal navigate to your Linux machine.</li> <li>Choose SSH Public Key for the Authentication type (instead of Password ).</li> <li>Provide a Username.</li> <li>Paste the public SSH key from PuTTY into the SSH public key text area. Ensure the key validates with a checkmark.</li> <li>Create the VM. Wait for it to deploy.</li> <li>Access the running VM.</li> <li>From the Overview blade, click Connect.</li> <li>Make a note of your login information including user and public IP address.</li> </ol> <p>Access the server using SSH</p> <ol> <li>Open the PuTTY tool.</li> <li>Enter username@publicIpAddress where username is the value you assigned when creating the VM and publicIpAddress is the value you obtained from the Azure portal.</li> <li>Specify 22 for the Port.</li> <li>Choose SSH in the Connection Type option group.</li> <li>Navigate to SSH in the Category panel, then click Auth.</li> <li>Click the Browse button next to Private key file for authentication.</li> <li>Navigate to the private key file saved when you generated the SSH keys and click Open.</li> <li>From the main PuTTY screen click Open.</li> <li>You will now be connected to your server command line.</li> <li>Explain how SSH is different from the Bastion service.</li> </ol> <p>Knowledge check</p> <ol> <li> <p>An organization has a security policy that prohibits exposing SSH ports to the outside world. You need to connect to an Azure Linux virtual machine to install software. What should you do?</p> </li> <li> <p>Configure the Bastion service(Ans)</p> </li> <li>Configure a Guest configuration on the virtual machine</li> <li> <p>Create a custom script extension</p> </li> <li> <p>What type of disk encryption is used for Linux disks?</p> </li> <li> <p>BitLocker</p> </li> <li>DM-Crypt(Ans)</li> <li> <p>FileVault</p> </li> <li> <p>A company with both Azure and on-premises virtual machines needs to ensure virtual machines are up to date with security patches. Update Management is the Azure tool they will use. Which of the following would enable the company to assess the status of available updates and manage the installation of required updates on virtual machines?</p> </li> <li> <p>The Microsoft Monitoring Agent must be installed for both Windows and Linux virtual machines on-premises.</p> </li> <li>Both the Update Management feature and the log data storage are free for the customer.</li> <li> <p>Update Management in Azure Automation collects information about Windows and Linux virtual machines and manages operating system updates.(Ans)</p> </li> <li> <p>Which of the following recommendations from Security Center is a medium-severity recommendation for virtual machines and servers?</p> </li> <li> <p>Disk encryption should be applied on virtual machines.</p> </li> <li>Install endpoint protection solution on virtual machines.(Ans)</li> <li> <p>System updates should be installed on your machines.</p> </li> <li> <p>Which attacks will using a Privileged access workstations protect companies from?</p> </li> <li> <p>Protects against attackers who have gained administrative access.</p> </li> <li>Protects against server-based phishing attacks, various impersonation attacks, and credential theft attacks such as keystroke logging.</li> <li>Protects high impact IT administrative roles and tasks.(Ans)</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Implement-platform-protection.html#enable-containers-security","title":"Enable Containers security","text":"<p>Introduction</p> <p>Containers are a great choice for running applications in Azure. Just like virtual machines, those containers must be locked to protect your data and business. Use the built-in Azure container tools to keep your container-based solutions secure.</p> <p>Scenario</p> <p>A security engineer uses Azure Container Instances, the Container Registry, and access controls to protect your containers; you will work on such tasks as:</p> <ul> <li>Deploy containers from the Container Registry into Azure Container Instances.</li> <li>Use RBAC and Conditional Access to control access.</li> <li>Use proper architecture, storage, and network design to optimize container security.</li> </ul> <p>Explore containers A container is an isolated, lightweight silo for running an application on the host operating system. Containers build on top of the host operating system's kernel (which can be thought of as the buried plumbing of the operating system), and contain only apps and some lightweight operating system APIs and services that run in user mode. While a container shares the host operating system's kernel, the container doesn't get unfettered access to it. Instead, the container gets an isolated\u2013and in some cases virtualized\u2013view of the system. For example, a container can access a virtualized version of the file system and registry, but any changes affect only the container and are discarded when it stops. To save data, the container can mount persistent storage such as an Azure Disk or a file share (including Azure Files).</p> <p>You need Docker in order to work with Windows Containers. Docker consists of the Docker Engine (dockerd.exe), and the Docker client (docker.exe).</p> <p>How it works A container builds on top of the kernel, but the kernel doesn't provide all of the APIs and services an app needs to run\u2013most of these are provided by system files (libraries) that run above the kernel in user mode. Because a container is isolated from the host's user mode environment, the container needs its own copy of these user mode system files, which are packaged into something known as a base image. The base image serves as the foundational layer upon which your container is built, providing it with operating system services not provided by the kernel.</p> <p></p> <p>Because containers require far fewer resources (for example, they don't need a full OS), they're easy to deploy and they start fast. This allows you to have higher density, meaning that it allows you to run more services on the same hardware unit, thereby reducing costs.</p> <p>As a side effect of running on the same kernel, you get less isolation than VMs.</p> <p>Features of Containers</p> Features Description Isolation Typically provides lightweight isolation from the host and   other containers, but doesn't provide as strong a security boundary as a VM.   (You can increase the security by using Hyper-V isolation mode to isolate   each container in a lightweight VM). Operating System Runs the user mode portion of an operating system, and can be   tailored to contain just the needed services for your app, using fewer system   resources. Deployment Deploy individual containers by using Docker via command line;   deploy multiple containers by using an orchestrator such as Azure Kubernetes   Service. Persistent storage Use Azure Disks for local storage for a single node, or Azure   Files (SMB shares) for storage shared by multiple nodes or servers. Fault tolerance If a cluster node fails, any containers running on it are   rapidly recreated by the orchestrator on another cluster node. Networking Uses an isolated view of a virtual network adapter, providing   a little less virtualization\u2013the host's firewall is shared with   containers\u2013while using less resources. <p>In Docker, each layer is the resulting set of changes that happen to the filesystem after executing a command, such as, installing a program. So, when you view the filesystem after the layer has been copied, you can view all the files, including the layer when the program was installed. You can think of an image as an auxiliary read-only hard disk ready to be installed in a \"computer\" where the operating system is already installed. Similarly, you can think of a container as the \"computer\" with the image hard disk installed. The container, just like a computer, can be powered on or off.</p> <p>Configure Azure Container Instances security</p> <p>Use a private registry</p> <p>Containers are built from images that are stored in one or more repositories. These repositories can belong to a public registry, like Docker Hub, or to a private registry. An example of a private registry is the Docker Trusted Registry, which can be installed on-premises or in a virtual private cloud. You can also use cloud-based private container registry services, including Azure Container Registry.</p> <p>A publicly available container image does not guarantee security. Container images consist of multiple software layers, and each software layer might have vulnerabilities. To help reduce the threat of attacks, you should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry. In addition to providing a managed private registry, Azure Container Registry supports service principal-based authentication through Azure Active Directory for basic authentication flows. This authentication includes role-based access for read-only (pull), write (push), and other permissions.</p> <p>Monitor and scan container images continuously</p> <p>Take advantage of solutions to scan container images in a private registry and identify potential vulnerabilities. It\u2019s important to understand the depth of threat detection that the different solutions provide.</p> <p>For example, Azure Container Registry optionally integrates with Microsoft Defender for Cloud to automatically scan all Linux images pushed to a registry. Microsoft Defender for Cloud integrated Qualys scanner detects image vulnerabilities, classifies them, and provides remediation guidance.</p> <p>Protect credentials Containers can spread across several clusters and Azure regions. So, you must secure credentials required for logins or API access, such as passwords or tokens. Ensure that only privileged users can access those containers in transit and at rest. Inventory all credential secrets, and then require developers to use emerging secrets-management tools that are designed for container platforms. Make sure that your solution includes encrypted databases, TLS encryption for secrets data in transit, and least-privilege role-based access control. Azure Key Vault is a cloud service that safeguards encryption keys and secrets (such as certificates, connection strings, and passwords) for containerized applications. Because this data is sensitive and business critical, secure access to your key vaults so that only authorized applications and users can access them.</p> <p>Use vulnerability management as part of your container development lifecycle</p> <p>By using effective vulnerability management throughout the container development lifecycle, you improve the odds that you identify and resolve security concerns before they become a more serious problem.</p> <p>Scan for vulnerabilities</p> <p>New vulnerabilities are discovered all the time, so scanning for and identifying vulnerabilities is a continuous process. Incorporate vulnerability scanning throughout the container lifecycle:</p> <ul> <li>As a final check in your development pipeline, you should perform a vulnerability scan on containers before pushing the images to a public or private registry.</li> <li>Continue to scan container images in the registry both to identify any flaws that were somehow missed during development and to address any newly discovered vulnerabilities that might exist in the code used in the container images.</li> </ul> <p>Ensure that only approved images are used in your environment</p> <p>There\u2019s enough change and volatility in a container ecosystem without allowing unknown containers as well. Allow only approved container images. Have tools and processes in place to monitor for and prevent the use of unapproved container images.</p> <p>An effective way of reducing the attack surface and preventing developers from making critical security mistakes is to control the flow of container images into your development environment. For example, you might sanction a single Linux distribution as a base image, preferably one that is lean (Alpine or CoreOS rather than Ubuntu), to minimize the surface for potential attacks.</p> <p>Image signing or fingerprinting can provide a chain of custody that enables you to verify the integrity of the containers. For example, Azure Container Registry supports Docker's content trust model, which allows image publishers to sign images that are pushed to a registry, and image consumers to pull only signed images.</p> <p>Enforce least privileges in runtime</p> <p>The concept of least privileges is a basic security best practice that also applies to containers. When a vulnerability is exploited, it generally gives the attacker access and privileges equal to those of the compromised application or process. Ensuring that containers operate with the lowest privileges and access required to get the job done reduces your exposure to risk.</p> <p>Reduce the container attack surface by removing unneeded privileges</p> <p>You can also minimize the potential attack surface by removing any unused or unnecessary processes or privileges from the container runtime. Privileged containers run as root. If a malicious user or workload escapes in a privileged container, the container will then run as root on that system.</p> <p>Log all container administrative user access for auditing</p> <p>Maintain an accurate audit trail of administrative access to your container ecosystem, including your Kubernetes cluster, container registry, and container images. These logs might be necessary for auditing purposes and will be useful as forensic evidence after any security incident. Azure solutions include:</p> <ul> <li>Integration of Azure Kubernetes Service with Microsoft Defender for Cloud to monitor the security configuration of the cluster environment and generate security recommendations</li> <li>Azure Container Monitoring solution</li> <li>Resource logs for Azure Container Instances and Azure Container Registry</li> </ul> <p>Manage security for Azure Container Instances (ACI)</p> <p>Azure Container Instances (ACI), is a PaaS service for scenario that can operate in isolated containers, including simple applications, task automation, and build jobs. For scenarios where you need full container orchestration, including service discovery across multiple containers, automatic scaling, and coordinated application upgrades, we recommend Azure Kubernetes Service (which will be covered later on in this lesson).</p> <p>Features of ACI</p> <p>Fast startup times Containers offer significant startup benefits over virtual machines (VMs). Azure Container Instances can start containers in Azure in seconds, without the need to provision and manage VMs.</p> <p>Container access</p> <ul> <li>Azure Container Instances enables exposing your container groups directly to the internet with an IP address and a fully qualified domain name (FQDN). When you create a container instance, you can specify a custom DNS name label so your application is reachable at customlabel.azureregion.azurecontainer.io.</li> <li>Azure Container Instances also supports executing a command in a running container by providing an interactive shell to help with application development and troubleshooting. Access takes places over HTTPS, using TLS to secure client connections.</li> </ul> <p>Container deployment</p> <p>Deploy containers from DockerHub or Azure Container Registry.</p> <p>Hypervisor-level security Historically, containers have offered application dependency isolation and resource governance but have not been considered sufficiently hardened for hostile multi-tenant usage. Azure Container Instances guarantees your application is as isolated in a container as it would be in a VM.</p> <p>Custom sizes Containers are typically optimized to run just a single application, but the exact needs of those applications can differ greatly. Azure Container Instances provides optimum utilization by allowing exact specifications of CPU cores and memory. You pay based on what you need and get billed by the second, so you can fine-tune your spending based on actual need.</p> <p>For compute-intensive jobs such as machine learning, Azure Container Instances can schedule Linux containers to use NVIDIA Tesla GPU resources.</p> <p>Persistent storage To retrieve and persist state with Azure Container Instances, we offer direct mounting of Azure Files shares backed by Azure Storage.</p> <p>Flexible billing</p> <p>Supports per-GB, per-CPU, and per-second billing.</p> <p>Linux and Windows containers Azure Container Instances can schedule both Windows and Linux containers with the same API. Simply specify the OS type when you create your container groups.</p> <p>Some features are currently restricted to Linux containers:</p> <ul> <li>Multiple containers per container group</li> <li>Volume mounting (Azure Files, emptyDir, GitRepo, secret)</li> <li>Resource usage metrics with Azure Monitor</li> <li>Virtual network deployment</li> <li>GPU resources (preview)</li> </ul> <p>For Windows container deployments, use images based on common Windows base images.</p> <p>Co-scheduled groups Azure Container Instances supports scheduling of multi-container groups that share a host machine, local network, storage, and lifecycle. This enables you to combine your main application container with other supporting role containers, such as logging sidecars.</p> <p>Virtual network deployment Currently available for production workloads in a subset of Azure regions, this feature of Azure Container Instances enables deployment of container instances into an Azure virtual network. By deploying container instances into a subnet within your virtual network, they can communicate securely with other resources in the virtual network, including those that are on premises (through VPN gateway or ExpressRoute).</p> <p>Explore the Azure Container Registry (ACR)</p> <p>A container registry is a service that stores and distributes container images. Docker Hub is a public container registry that supports the open source community and serves as a general catalog of images. Azure Container Registry provides users with direct control of their images, with integrated authentication, geo-replication supporting global distribution and reliability for network-close deployments, virtual network and firewall configuration, tag locking, and many other enhanced features.</p> <p>In addition to Docker container images, Azure Container Registry supports related content artifacts including Open Container Initiative (OCI) image formats.</p> <p></p> <p>Security and access</p> <p>You log in to a registry using the Azure CLI or the standard docker login command. Azure Container Registry transfers container images over HTTPS, and supports TLS to secure client connections. Azure Container Registry requires all secure connections from servers and applications to use TLS 1.2. Enable TLS 1.2 by using any recent docker client (version 18.03.0 or later). You control access to a container registry using an Azure identity, an Azure Active Directory-backed service principal, or a provided admin account. Use role-based access control (RBAC) to assign users or systems fine-grained permissions to a registry.</p> <p>Security features of the Premium SKU include content trust for image tag signing, and firewalls and virtual networks to restrict access to the registry. Microsoft Defender for Cloud optionally integrates with Azure Container Registry to scan images whenever an image is pushed to a registry.</p> <p>Repository</p> <p>Container registries manage repositories, collections of container images or other artifacts with the same name, but different tags. For example, the following three images are in the \"acr-helloworld\" repository:</p> <ul> <li>acr-helloworld:latest</li> <li>acr-helloworld:v1</li> <li>acr-helloworld:v2</li> </ul> <p>Image</p> <p>A container image or other artifact within a registry is associated with one or more tags, has one or more layers, and is identified by a manifest. Understanding how these components relate to each other can help you manage your registry effectively.</p> <p>Monitor container activity and user access</p> <p>As with any IT environment, you should consistently monitor activity and user access to your container ecosystem to quickly identify any suspicious or malicious activity. The container monitoring solution in Log Analytics can help you view and manage your Docker and Windows container hosts in a single location.</p> <p>By using Log Analytics, you can:</p> <ul> <li>View detailed audit information that shows commands used with containers.</li> <li>Troubleshoot containers by viewing and searching centralized logs without having to remotely view Docker or Windows hosts.</li> <li>Find containers that may be noisy and consuming excess resources on a host.</li> <li>View centralized CPU, memory, storage, and network usage and performance information for containers.</li> </ul> <p>On computers running Windows, you can centralize and compare logs from Windows Server, Hyper-V, and Docker containers. The solution supports container orchestrators such as Docker Swarm, DC/OS, Kubernetes, Service Fabric, and Red Hat OpenShift.</p> <p>Container technology is causing a structural change in the cloud-computing world. Containers make it possible to run multiple instances of an application on a single instance of an operating system, thereby using resources more efficiently. Containers give organizations consistency and flexibility. They enable continuous deployment because the application can be developed on a desktop, tested in a virtual machine, and then deployed for production in the cloud. Containers provide agility, streamlined operations, scalability, and reduced costs due to resource optimization.</p> <p>Enable Azure Container Registry authentication</p> <p>There are several ways to authenticate with an Azure container registry, each of which is applicable to one or more registry usage scenarios.</p> <p>Recommended ways include authenticating to a registry directly via individual login, or your applications and container orchestrators can perform unattended, or \"headless,\" authentication by using an Azure Active Directory (Azure AD) service principal.</p> <p>Authentication options</p> <p>The following table lists available authentication methods and recommended scenarios.</p> Identity Usage scenario Details Azure AD identities including   user and service principals Unattended push from DevOps, unattended pull to Azure or   external services Role-based access control - Reader, Contributor, Owner Individual AD Identity Interactive push/pull by developers and testers Admin user Interactive push/pull by individual developers and testers By default, disabled. <p>Individual login with Azure AD</p> <p>When working with your registry directly, such as pulling images to and pushing images from a development workstation, authenticate by using the az acr login command in the Azure CLI. When you log in with az acr login, the CLI uses the token created when you executed az login to seamlessly authenticate your session with your registry. To complete the authentication flow, Docker must be installed and running in your environment. az acr login uses the Docker client to set an Azure Active Directory token in the docker.config file. Once you've logged in this way, your credentials are cached, and subsequent docker commands in your session do not require a username or password.</p> <p>Service principal</p> <p>If you assign a service principal to your registry, your application or service can use it for headless authentication. Service principals allow role-based access to a registry, and you can assign multiple service principals to a registry. Multiple service principals allow you to define different access for different applications.</p> <p>The available roles for a container registry include:</p> <ul> <li>AcrPull: pull</li> <li>AcrPush: pull and push</li> <li>Owner: pull, push, and assign roles to other users</li> </ul> <p>Admin account</p> <p>Each container registry includes an admin user account, which is disabled by default. You can enable the admin user and manage its credentials in the Azure portal, or by using the Azure CLI or other Azure tools. The admin account is provided with two passwords, both of which can be regenerated. Two passwords allow you to maintain connection to the registry by using one password while you regenerate the other. If the admin account is enabled, you can pass the username and either password to the docker login command when prompted for basic authentication to the registry.</p> <p>Review Azure Kubernetes Service (AKS)</p> <p>As application development moves towards a container-based approach, the need to orchestrate and manage resources is important. Kubernetes is the leading platform that provides the ability to provide reliable scheduling of fault-tolerant application workloads. Azure Kubernetes Service (AKS) is a managed Kubernetes offering that further simplifies container-based application deployment and management.</p> <p>Kubernetes is ...</p> <p>Kubernetes is a rapidly evolving platform that manages container-based applications and their associated networking and storage components. The focus is on the application workloads, not the underlying infrastructure components. Kubernetes provides a declarative approach to deployments, backed by a robust set of APIs for management operations.</p> <p>You can build and run modern, portable, microservices-based applications that benefit from Kubernetes orchestrating and managing the availability of those application components. Kubernetes supports both stateless and stateful applications as teams progress through the adoption of microservices-based applications. Deployment of containers As an open platform, Kubernetes allows you to build your applications with your preferred programming language, OS, libraries, or messaging bus. Existing continuous integration and continuous delivery (CI/CD) tools can integrate with Kubernetes to schedule and deploy releases.</p> <p>Azure Kubernetes Service (AKS) provides a managed Kubernetes service that reduces the complexity for deployment and core management tasks, including coordinating upgrades. The AKS control plane is managed by the Azure platform, and you only pay for the AKS nodes that run your applications. AKS is built on top of the open-source Azure Kubernetes Service Engine (aks-engine).</p> <p>Kubernetes cluster architecture</p> <p>A Kubernetes cluster is divided into two components:</p> <ul> <li>Control plane nodes provide the core Kubernetes services and orchestration of application workloads.</li> <li>Nodes run your application workloads.</li> </ul> <p></p> <p>Features of Azure Kubernetes Service</p> <ul> <li>Fully managed</li> <li>Public IP and FQDN (Private IP option)</li> <li>Accessed with RBAC or Azure AD</li> <li>Deployment of containers</li> <li>Dynamic scale containers</li> <li>Automation of rolling updates and rollbacks of containers</li> <li>Management of storage, network traffic, and sensitive information</li> </ul> <p>Implement an Azure Kubernetes Service architecture</p> <p>Kubernetes cluster architecture is a set of design recommendations for deploying your containers in a secure and managed configuration.</p> <p>Cluster master</p> <p>When you create an AKS cluster, a cluster master is automatically created and configured. This cluster master is provided as a managed Azure resource abstracted from the user. There is no cost for the cluster master, only the nodes that are part of the AKS cluster.</p> <p>The cluster master includes the following core Kubernetes components:</p> <ul> <li>kube-apiserver - The API server is how the underlying Kubernetes APIs are exposed. This component provides the interaction for management tools, such as kubectl or the Kubernetes dashboard.</li> <li>etcd - To maintain the state of your Kubernetes cluster and configuration, the highly available etcd is a key value store within Kubernetes.</li> <li>kube-scheduler - When you create or scale applications, the Scheduler determines what nodes can run the workload and starts them.</li> <li>kube-controller-manager - The Controller Manager oversees a number of smaller Controllers that perform actions such as replicating pods and handling node operations.</li> </ul> <p>AKS provides a single-tenant cluster master, with a dedicated API server, Scheduler, etc. You define the number and size of the nodes, and the Azure platform configures the secure communication between the cluster master and nodes. Interaction with the cluster master occurs through Kubernetes APIs, such as kubectl or the Kubernetes dashboard.</p> <p>This managed cluster master means that you do not need to configure components like a highly available store, but it also means that you cannot access the cluster master directly. Upgrades to Kubernetes are orchestrated through the Azure CLI or Azure portal, which upgrades the cluster master and then the nodes. To troubleshoot possible issues, you can review the cluster master logs through Azure Log Analytics.</p> <p>If you need to configure the cluster master in a particular way or need direct access to them, you can deploy your own Kubernetes cluster using aks-engine.</p> <p>Nodes and node pools</p> <p>To run your applications and supporting services, you need a Kubernetes node. An AKS cluster has one or more nodes, which is an Azure virtual machine (VM) that runs the Kubernetes node components and container runtime:</p> <ul> <li>The kubelet is the Kubernetes agent that processes the orchestration requests from the control plane and scheduling of running the requested containers.</li> <li>Virtual networking is handled by the kube-proxy on each node. The proxy routes network traffic and manages IP addressing for services and pods.</li> <li>The container runtime is the component that allows containerized applications to run and interact with additional resources such as the virtual network and storage. In AKS, Moby is used as the container runtime.</li> </ul> <p>The Azure VM size for your nodes defines how many CPUs, how much memory, and the size and type of storage available (such as high-performance SSD or regular HDD). If you anticipate a need for applications that require large amounts of CPU and memory or high-performance storage, plan the node size accordingly. You can also scale out the number of nodes in your AKS cluster to meet demand.</p> <p>In AKS, the VM image for the nodes in your cluster is currently based on Ubuntu Linux or Windows Server 2019. When you create an AKS cluster or scale out the number of nodes, the Azure platform creates the requested number of VMs and configures them. There's no manual configuration for you to perform. Agent nodes are billed as standard virtual machines, so any discounts you have on the VM size you're using (including Azure reservations) are automatically applied.</p> <p>If you need to use a different host OS, container runtime, or include custom packages, you can deploy your own Kubernetes cluster using aks-engine. The upstream aks-engine releases features and provides configuration options before they are officially supported in AKS clusters. For example, if you wish to use a container runtime other than Moby, you can use aks-engine to configure and deploy a Kubernetes cluster that meets your current needs.</p> <p>Cluster master nodes provide the core Kubernetes services and orchestration of application workloads. Nodes (virtual machines) run your application workloads.</p> <p>AKS Terminology</p> Term Description Pools Group   of nodes with identical configuration Node Individual   VM running containerized applications Pods Single   instance of an application. A pod can contain multiple containers Deployment One   or more identical pods managed by Kubernetes Manifest YAML   file describing a deployment <p>Master security</p> <p>In AKS, the Kubernetes master components are part of the managed service provided by Microsoft. Each AKS cluster has its own single-tenanted, dedicated Kubernetes master to provide the API Server, Scheduler, etc. This master is managed and maintained by Microsoft.</p> <p>By default, the Kubernetes API server uses a public IP address and a fully qualified domain name (FQDN). You can control access to the API server using Kubernetes role-based access controls and Azure Active Directory.</p> <p>Node security</p> <p>AKS nodes are Azure virtual machines that you manage and maintain. Linux nodes run an optimized Ubuntu distribution using the Moby container runtime. Windows Server nodes run an optimized Windows Server 2019 release and also use the Moby container runtime. When an AKS cluster is created or scaled up, the nodes are automatically deployed with the latest OS security updates and configurations.</p> <p>The Azure platform automatically applies OS security patches to Linux nodes on a nightly basis. If a Linux OS security update requires a host reboot, that reboot is not automatically performed. You can manually reboot the Linux nodes, or a common approach is to use Kured, an open-source reboot daemon for Kubernetes. Kured runs as a DaemonSet and monitors each node for the presence of a file indicating that a reboot is required. Reboots are managed across the cluster using the same cordon and drain process as a cluster upgrade.</p> <p>For Windows Server nodes, Windows Update does not automatically run and apply the latest updates. On a regular schedule around the Windows Update release cycle and your own validation process, you should perform an upgrade on the Windows Server node pool(s) in your AKS cluster. This upgrade process creates nodes that run the latest Windows Server image and patches, then removes the older nodes. Nodes are deployed into a private virtual network subnet, with no public IP addresses assigned. For troubleshooting and management purposes, SSH is enabled by default. This SSH access is only available using the internal IP address.</p> <p>To provide storage, the nodes use Azure Managed Disks. For most VM node sizes, these are Premium disks backed by high-performance SSDs. The data stored on managed disks is automatically encrypted at rest within the Azure platform. To improve redundancy, these disks are also securely replicated within the Azure datacenter.</p> <p>Kubernetes environments, in AKS or elsewhere, currently aren't completely safe for hostile multi-tenant usage. Additional security features such as Pod Security Policies or more fine-grained role-based access controls (RBAC) for nodes make exploits more difficult. However, for true security when running hostile multi-tenant workloads, a hypervisor is the only level of security that you should trust. The security domain for Kubernetes becomes the entire cluster, not an individual node. For these types of hostile multi-tenant workloads, you should use physically isolated clusters.</p> <p>To protect your customer data as you run application workloads in Azure Kubernetes Service (AKS), the security of your cluster is a key consideration.</p> <p>Configure Azure Kubernetes Service networking</p> <p>To allow access to your applications, or for application components to communicate with each other, Kubernetes provides an abstraction layer to virtual networking. Kubernetes nodes are connected to a virtual network, and can provide inbound and outbound connectivity for pods. The kube-proxy component runs on each node to provide these network features.</p> <p>In Kubernetes, Services logically group pods to allow for direct access via an IP address or DNS name and on a specific port. You can also distribute traffic using a load balancer. More complex routing of application traffic can also be achieved with Ingress Controllers. Security and filtering of the network traffic for pods is possible with Kubernetes network policies.</p> <p>The Azure platform also helps to simplify virtual networking for AKS clusters. When you create a Kubernetes load balancer, the underlying Azure load balancer resource is created and configured. As you open network ports to pods, the corresponding Azure network security group rules are configured. For HTTP application routing, Azure can also configure external DNS as new ingress routes are configured.</p> <p>Services</p> <p>To simplify the network configuration for application workloads, Kubernetes uses Services to logically group a set of pods together and provide network connectivity. The following Service types are available:</p> <ul> <li>Cluster IP - Creates an internal IP address for use within the AKS cluster. Good for internal-only applications that support other workloads within the cluster.</li> <li>NodePort - Creates a port mapping on the underlying node that allows the application to be accessed directly with the node IP address and port.</li> <li>LoadBalancer - Creates an Azure load balancer resource, configures an external IP address, and connects the requested pods to the load balancer backend pool. To allow customers' traffic to reach the application, load balancing rules are created on the desired ports.</li> <li>ExternalName - Creates a specific DNS entry for easier application access.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html","title":"AZ-500: Microsoft Certified: Azure Security Engineer Associate","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#manage-identity-and-access","title":"Manage Identity and Access","text":"<ol> <li>Secure Azure solutions with Azure Active Directory<ul> <li>Introduction</li> <li>Explore Azure Active Directory features</li> <li>Self-managed Active Directory Domain Services, Azure Active Directory, and managed Azure Active Directory Domain Services</li> <li>Azure AD DS and self-managed AD DS</li> <li>Azure AD DS and Azure AD</li> <li>Investigate roles in Azure AD</li> <li>Azure AD built-in roles</li> <li>Deploy Azure AD Domain Services</li> <li>Create and manage Azure AD users</li> <li>Manage users with Azure AD groups</li> <li>Configure Azure AD administrative units</li> <li>Implement passwordless authentication</li> <li>Exercises</li> </ul> </li> <li>Implement Hybrid identity<ul> <li>Introduction</li> <li>Deploy Azure AD connect</li> <li>Explore authentication options</li> <li>Configure Password Hash Synchronization (PHS)</li> <li>Implement Pass-through Authentication (PTA)</li> <li>Deploy Federation with Azure AD</li> <li>Explore the authentication decision tree</li> <li>Configure password writeback</li> </ul> </li> <li>Deploy Azure AD identity protection<ul> <li>Introduction</li> <li>Explore Azure AD identity protection</li> <li>Configure risk event detections</li> <li>Implement user risk policy</li> <li>Implement sign-in risk policy</li> <li>Deploy multifactor authentication in Azure</li> <li>Explore multifactor authentication settings</li> <li>Enable multifactor authentication</li> <li>Implement Azure AD conditional access</li> <li>Configure conditional access conditions</li> <li>Implement access reviews</li> <li>Exercises</li> </ul> </li> <li>Configure Azure AD privileged identity management<ul> <li>Introduction</li> <li>Explore the zero trust model</li> <li>Review the evolution of identity management</li> <li>Deploy Azure AD privileged identity management</li> <li>Configure privileged identity management scope</li> <li>Implement privileged identity management onboarding</li> <li>Explore privileged identity management configuration settings</li> <li>Implement a privileged identity management workflow</li> <li>Exercises</li> </ul> </li> <li>Design an enterprise governance strategy<ul> <li>Introduction</li> <li>Review the shared responsibility model</li> <li>Review Azure hierarchy of systems</li> <li>Configure Azure policies</li> <li>Enable Azure role-based access control (RBAC)</li> <li>Compare and contrast Azure RBAC vs Azure policies</li> <li>Configure built-in roles</li> <li>Enable resource locks</li> <li>Deploy Azure blueprints</li> <li>Design an Azure subscription management plan</li> <li>Exercises</li> </ul> </li> </ol> <p>The Azure security engineer implements, manages, and monitors security for resources in Azure, multi-cloud, and hybrid environments as part of an end-to-end infrastructure. They recommend security components and configurations to protect identity &amp; access, data, applications, and networks.</p> <p>Responsibilities for an Azure security engineer include managing the security posture, identifying and remediating vulnerabilities, performing threat modelling, and implementing threat protection. They may also participate in responding to security incidents.</p> <p>Azure security engineers work with architects, administrators, and developers to plan and implement solutions that meet security and compliance requirements.</p> <p>The Azure security engineer should have practical experience in administration of Microsoft Azure and hybrid environments. The Azure security engineer should have a strong familiarity with compute, network, and storage in Azure, as well as Azure Active Directory, part of Microsoft Entra.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#az-500-manage-identity-and-access","title":"AZ-500: Manage Identity and Access","text":"<p>Explore how identity is the starting point for all security within your company. Learn to authenticate and authorize users and apps with Azure Active Directory.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#introduction","title":"Introduction","text":"<p>Azure Active Directory (Azure AD) is Microsoft\u2019s cloud-based identity and access management service, which helps your employee's sign in and access resources in:</p> <ul> <li>External resources, such as Microsoft 365, the Azure portal, and thousands of other SaaS applications.</li> <li>Internal resources, such as apps on your corporate network and intranet, along with any cloud apps developed by your own organization.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#scenario","title":"Scenario","text":"<p>A security engineer uses Azure Active Directory's identity and access management services to execute and facilitate the following tasks:</p> <ul> <li>Create users, groups, and administrative units to securely access resources and services.</li> <li>Configure access to systems to be passwordless.</li> <li>Define a strategy for using Azure AD and Azure AD Domain Services to lock down access to your solutions.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#skills-measured","title":"Skills measured","text":"<p>Azure Active Directory is a part of Exam AZ-500: Microsoft Azure Security Engineer. Manage identity and access (30-35%)</p> <ul> <li>Manage Azure AD identities<ul> <li>Manage Azure AD directory groups</li> <li>Manage Azure AD users</li> <li>Manage administrative unit</li> </ul> </li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#learning-objectives","title":"Learning objectives","text":"<ul> <li>Compare and contrast Azure AD versus on-premises directory services with Azure AD Domain Services.</li> <li>Configure and deploy users, groups, and administrative units to securely access resources in your tenant.</li> <li>Deploy a passwordless login solution for your Azure users and resources.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-azure-active-directory-features","title":"Explore Azure Active Directory features","text":"<p>Azure Active Directory (Azure AD) is a cloud-based identity and access management service. This service helps employees access external resources, such as Microsoft 365, the Azure portal, and thousands of other software-as-a-service (SaaS) applications. Azure Active Directory also helps them access internal resources like apps on your corporate intranet network, along with any cloud apps developed for your organization.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#who-uses-azure-ad","title":"Who uses Azure AD?","text":"<p>Azure AD is intended for:</p> <ul> <li> <p>IT admins: As an IT admin, use Azure AD to control access to your apps and your app resources based on your business requirements. For example, you can use Azure AD to require multi-factor authentication when accessing important organizational resources. You can also use Azure AD to automate user provisioning between your existing Windows Server AD and your cloud apps, including Microsoft 365. Finally, Azure AD gives you powerful tools to automatically help protect user identities and credentials and to meet your access governance requirements.</p> <ul> <li> <p>App developers: As an app developer, you can use Azure AD as a standards-based approach for adding single sign-on (SSO) to your app, allowing it to work with a user's pre-existing credentials. Azure AD also provides APIs that can help you build personalized app experiences using existing organizational data.</p> </li> <li> <p>Microsoft 365, Office 365, Azure, or Dynamics Customer relationship management (CRM) Online subscribers: As a subscriber, you're already using Azure AD. Each Microsoft 365, Office 365, Azure, and Dynamics CRM Online tenant is automatically an Azure AD tenant. You can immediately start to manage access to your integrated cloud apps.</p> </li> </ul> </li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#what-are-the-azure-ad-licenses","title":"What are the Azure AD licenses?","text":"<p>Microsoft Online business services, such as Microsoft 365 or Microsoft Azure, require Azure AD for sign-in activities and to help with identity protection. If you subscribe to any Microsoft Online business service, you automatically get Azure AD with access to all the free features.</p> <p>To enhance your Azure AD implementation, you can also add paid capabilities by upgrading to Azure Active Directory Premium P1 or Premium P2 licenses. </p> <p>Azure AD paid licenses are built on top of your existing free directory. The licenses provide self-service, enhanced monitoring, security reporting, and secure access for your mobile users.</p> <ul> <li> <p>Azure Active Directory Free: Provides user and group management, on-premises directory synchronization, basic reports, self-service password change for cloud users, and single sign-on across Azure, Microsoft 365, and many popular SaaS apps.</p> <ul> <li> <p>Azure Active Directory Premium P1: In addition to the Free features, P1 lets your hybrid users access both on-premises and cloud resources. It also supports advanced administration, such as dynamic groups, self-service group management, Microsoft Identity Manager, and cloud write-back capabilities, which allow self-service password reset for your on-premises users.</p> </li> <li> <p>Azure Active Directory Premium P2: In addition to the Free and P1 features, P2 also offers Azure Active Directory Identity Protection to help provide risk-based Conditional Access to your apps and critical company data and Privileged Identity Management to help discover, restrict, and monitor administrators and their access to resources and to provide just-in-time access when needed.</p> </li> <li> <p>\"Pay as you go\" feature licenses: You also get additional feature licenses, such as Azure Active Directory Business-to-Customer (B2C). B2C can help you provide identity and access management solutions for your customer-facing apps.</p> </li> </ul> </li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#which-features-work-in-azure-ad","title":"Which features work in Azure AD?","text":"<p>After you choose your Azure AD license, you'll get access to some or all of the following features:</p> Category Description Application management Manage your cloud and on-premises apps using Application Proxy, single sign-on, the My Apps portal, and Software as a Service (SaaS) apps. Authentication Manage Azure Active Directory self-service password reset, Multi-Factor Authentication, custom banned password list, and smart lockout. Azure Active Directory for developers Build apps that sign in all Microsoft identities, and get tokens to call Microsoft Graph, other Microsoft APIs, or custom APIs. Business-to-Business (B2B) Manages your guest users and external partners while maintaining control over your own corporate data. Business-to-Customer (B2C) Manages your guest users and external partners while maintaining control over your own corporate data. Conditional Access Manage access to your cloud apps. Device Management Manage how your cloud or on-premises devices access your corporate data. Domain services Join Azure virtual machines to a domain without using domain controllers. Enterprise users Manage license assignments, access to apps, and set up delegates using groups and administrator roles. Hybrid identity Use Azure Active Directory Connect and Connect Health to provide a single user identity for authentication and authorization to all resources, regardless of location (cloud or on-premises). Identity governance Manage your organization's identity through employee, business partner, vendor, service, and app access controls. You can also perform access reviews. Identity protection Detect potential vulnerabilities affecting your organization's identities, configure policies to respond to suspicious actions, and then take appropriate action to resolve them. Managed identities for Azure resources Provide your Azure services with an automatically managed identity in Azure AD that can authenticate any Azure AD-supported authentication service, including Key Vault. Privileged identity management (PIM) Manages, controls, and monitors access within your organization. This feature includes access to resources in Azure AD and Azure, and other Microsoft Online Services, like Microsoft 365 or Intune. Reports and monitoring Gain insights into the security and usage patterns in your environment."},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#self-managed-active-directory-domain-services-azure-active-directory-and-managed-azure-active-directory-domain-services","title":"Self-managed Active Directory Domain Services, Azure Active Directory, and managed Azure Active Directory Domain Services","text":"<p>To provide applications, services, or devices access to a central identity, there are three common ways to use Active Directory-based services in Azure. This choice in identity solutions gives you the flexibility to use the most appropriate directory for your organization's needs.</p> <p>For example, if you mostly manage cloud-only users that run mobile devices, it may not make sense to build and run your own Active Directory Domain Services (AD DS) identity solution. Instead, you could use Azure Active Directory.</p> <p></p> <p>Although the three Active Directory-based identity solutions share a common name and technology, they're designed to provide services that meet different customer demands. At a high level, these identity solutions and feature sets are:</p> <ol> <li> <p>Azure Active Directory (Azure AD) - Cloud-based identity and mobile device management that provides user account and authentication services for resources such as Microsoft 365, the Azure portal, or SaaS applications.</p> <ul> <li>Azure AD can be synchronized with an on-premises AD DS environment to provide a single identity to users that works natively in the cloud.</li> </ul> </li> <li> <p>Active Directory Domain Services (AD DS) - Enterprise-ready lightweight directory access protocol (LDAP) server that provides key features such as identity and authentication, computer object management, group policy, and trusts.</p> <ul> <li>AD DS is a central component in many organizations with an on-premises IT environment and provides core user account authentication and computer management features.</li> </ul> </li> <li> <p>Azure Active Directory Domain Services (Azure AD DS) - Provides managed domain services with a subset of fully compatible traditional AD DS features such as domain join, group policy, LDAP, and Kerberos / New Technology LAN Manager (NTLM) authentication.</p> <ul> <li>Azure AD DS integrates with Azure AD, which can synchronize with an on-premises AD DS environment. This ability extends central identity use cases to traditional web applications that run in Azure as part of a lift-and-shift strategy.</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-ad-ds-and-self-managed-ad-ds","title":"Azure AD DS and self-managed AD DS","text":"<p>If you have applications and services that need access to traditional authentication mechanisms such as Kerberos or NTLM, there are two ways to provide Active Directory Domain Services in the cloud:</p> <ul> <li>A managed domain that you create using Azure Active Directory Domain Services (Azure AD DS). Microsoft creates and manages the required resources.</li> <li>A self-managed domain that you create and configure using traditional resources such as virtual machines (VMs), Windows Server guest OS, and Active Directory Domain Services (AD DS). You then continue to administer these resources.</li> </ul> <p>With Azure AD DS, the core service components are deployed and maintained for you by Microsoft as a managed domain experience. You don't deploy, manage, patch, and secure the AD DS infrastructure for components like the VMs, Windows Server OS, or domain controllers (DCs).</p> <p>Azure AD DS provides a smaller subset of features to traditional self-managed AD DS environment, which reduces some of the design and management complexity. For example, there are no AD forests, domains, sites, and replication links to design and maintain.</p> <p>For applications and services that run in the cloud and need access to traditional authentication mechanisms such as Kerberos or NTLM, Azure AD DS provides a managed domain experience with a minimal amount of administrative overhead.</p> <p>When you deploy and run a self-managed AD DS environment, you must maintain all of the associated infrastructure and directory components. There's additional maintenance overhead with a self-managed AD DS environment, but you're then able to do additional tasks, such as extending the schema or create forest trusts.</p> <p>Common deployment models for a self-managed AD DS environment that provides identity to applications and services in the cloud include the following:</p> <ul> <li>Standalone cloud-only AD DS - Azure VMs are configured as domain controllers, and a separate, cloud-only AD DS environment is created. This AD DS environment doesn't integrate with an on-premises AD DS environment. A different set of credentials is used to sign in and administer VMs in the cloud.</li> <li>Resource forest deployment - Azure VMs are configured as domain controllers, and an AD DS domain that's part of an existing forest is created. A trust relationship is then configured to an on-premises AD DS environment. Other Azure VMs can domain-join this resource forest in the cloud. User authentication runs over a VPN / ExpressRoute connection to the on-premises AD DS environment.</li> <li>Extend on-premises domain to Azure - An Azure virtual network connects to an on-premises network using a VPN / ExpressRoute connection. Azure VMs connect to this Azure virtual network, which lets them domain-join to the on-premises AD DS environment.</li> </ul> <p>An alternative is to create Azure VMs and promote them as replica domain controllers from the on-premises AD DS domain. These domain controllers replicate over a VPN / ExpressRoute connection to the on-premises AD DS environment. The on-premises AD DS domain is effectively extended into Azure.</p> <p>The following table outlines some of the features you may need for your organization and the differences between a managed Azure AD DS domain or a self-managed AD DS domain:</p> Feature Azure Active Directory Services (Azure AD DS) Self-managed AD DS Managed service \u2713 \u2715 Secure deployments \u2713 The administrator secures the deployment Domain Name System (DNS) server \u2713 (managed service) \u2713 Domain or Enterprise administrator privileges \u2715 \u2713 Domain join \u2713 \u2713 Domain authentication using New Technology LAN Manager (NTLM) and Kerberos \u2713 \u2713 Kerberos constrained delegation Resource-based Resource-based &amp; account-based Custom organizational unit (OU) structure \u2713 \u2713 Group Policy \u2713 \u2713 Schema extensions \u2715 \u2713 Active Directory domain/forest trusts \u2713 (one-way outbound forest trusts only) \u2713 Secure Lightweight Directory Access Protocols (LDAPs) \u2713 \u2713 Lightweight Directory Access Protocol (LDAP) read \u2713 \u2713 Lightweight Directory Access Protocol (LDAP) write \u2713 (within the managed domain) \u2713 Geographical-distributed (Geo-distributed) deployments \u2713 \u2713"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-ad-ds-and-azure-ad","title":"Azure AD DS and Azure AD","text":"<p>Azure AD lets you manage the identity of devices used by the organization and control access to corporate resources from those devices. Users can also register their personal device (a bring-your-own (BYO) model) with Azure AD, which provides the device with an identity. Azure AD then authenticates the device when a user signs in to Azure AD and uses the device to access secured resources. The device can be managed using Mobile Device Management (MDM) software like Microsoft Intune. This management ability lets you restrict access to sensitive resources to managed and policy-compliant devices.</p> <p>Traditional computers and laptops can also join Azure AD. This mechanism offers the same benefits of registering a personal device with Azure AD, such as allowing users to sign in to the device using their corporate credentials.</p> <p>Azure AD joined devices give you the following benefits:</p> <ul> <li>Single sign-on (SSO) to applications secured by Azure AD.</li> <li>Enterprise policy-compliant roaming of user settings across devices.</li> <li>Access to the Windows Store for Business using corporate credentials.</li> <li>Windows Hello for Business.</li> <li>Restricted access to apps and resources from devices compliant with corporate policy.</li> </ul> <p>Devices can be joined to Azure AD with or without a hybrid deployment that includes an on-premises AD DS environment. The following table outlines common device ownership models and how they would typically be joined to a domain:</p> Type of device Device platforms Mechanism Personal devices Windows 10, iOS, Android, macOS Azure AD registered Organization-owned device not joined to on-premises AD DS Windows 10 Azure AD joined Organization-owned device joined to an on-premises AD DS Windows 10 Hybrid Azure AD joined <p>On an Azure AD-joined or registered device, user authentication happens using modern OAuth / OpenID Connect-based protocols. These protocols are designed to work over the internet, so are great for mobile scenarios where users access corporate resources from anywhere.</p> <p>With Azure AD DS-joined devices, applications can use the Kerberos and New Technology LAN Manager (NTLM) protocols for authentication, so can support legacy applications migrated to run on Azure VMs as part of a lift-and-shift strategy. The following table outlines differences in how the devices are represented and can authenticate themselves against the directory:</p> Aspect Azure AD-joined Azure AD DS-joined Device controlled by Azure AD Azure AD Domain Services managed domain Representation in the directory Device objects in the Azure AD directory Computer objects in the Azure AD DS managed domain Authentication Open Authorization OAuth / OpenID Connect-based protocols Kerberos and NTLM protocols Management Mobile Device Management (MDM) software like Intune Group Policy Networking Works over the internet Must be connected to, or peered with, the virtual network where the managed domain is deployed Great for... End-user mobile or desktop devices Server VMs deployed in Azure <p>If on-premises AD DS and Azure AD are configured for federated authentication using Active Directory Federation Services (ADFS), then there's no (current/valid) password hash available in Azure DS. Azure AD user accounts created before fed auth was implemented might have an old password hash that doesn't match a hash of their on-premises password. Hence Azure AD DS won't validate the user's credentials.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#investigate-roles-in-azure-ad","title":"Investigate roles in Azure AD","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#categories-of-azure-ad-roles","title":"Categories of Azure AD roles","text":"<p>Azure AD built-in roles differ in where they can be used, which fall into the following three broad categories.</p> <ul> <li> <p>Azure AD-specific roles: These roles grant permissions to manage resources within Azure AD only. For example, User Administrator, Application Administrator, and Groups Administrator all grant permissions to manage resources that live in Azure AD.</p> </li> <li> <p>Service-specific roles: For major Microsoft 365 services (non-Azure AD), we have built service-specific roles that grant permissions to manage all features within the service. For example, Exchange Administrator, Intune Administrator, SharePoint Administrator, and Teams Administrator roles can manage features with their respective services. Exchange Administrator can manage mailboxes, Intune Administrator can manage device policies, SharePoint Administrator can manage site collections, Teams Administrator can manage call qualities, and so on.</p> </li> <li> <p>Cross-service roles: There are some roles that span services. We have two global roles - Global Administrator and Global Reader. All Microsoft 365 services honor these two roles. Also, there are some security-related roles like Security Administrator and Security Reader that grant access across multiple security services within Microsoft 365. For example, using Security Administrator roles in Azure AD, you can manage Microsoft 365 Defender portal, Microsoft Defender Advanced Threat Protection, and Microsoft Defender for Cloud Apps. Similarly, in the Compliance Administrator role, you can manage Compliance-related settings in the Compliance portal, Exchange, and so on.</p> </li> </ul> <p></p> <p>The following table is offered as an aid to understanding these role categories. The categories are named arbitrarily and aren't intended to imply any other capabilities beyond the documented Azure AD role permissions.</p> Category Role Azure AD-specific roles Application AdministratorApplication DeveloperAuthentication AdministratorBusiness to consumer (B2C) Identity Experience Framework (IEF) Keyset AdministratorBusiness to consumer (B2C) Identity Experience Framework (IEF) Policy AdministratorCloud Application AdministratorCloud Device AdministratorConditional Access AdministratorDevice AdministratorsDirectory ReadersDirectory Synchronization AccountsDirectory WritersExternal ID User Flow AdministratorExternal ID User Flow Attribute AdministratorExternal Identity Provider AdministratorGroups AdministratorGuest InviterHelpdesk AdministratorHybrid Identity AdministratorLicense AdministratorPartner Tier1 SupportPartner Tier2 SupportPassword AdministratorPrivileged Authentication AdministratorPrivileged Role AdministratorReports ReaderUser Administrator Cross-service roles Global AdministratorCompliance AdministratorCompliance Data AdministratorGlobal ReaderSecurity AdministratorSecurity OperatorSecurity ReaderService Support Administrator Service-specific roles Azure DevOps AdministratorAzure Information Protection AdministratorBilling AdministratorCustomer relationship management (CRM) Service AdministratorCustomer Lockbox Access ApproverDesktop Analytics AdministratorExchange Service AdministratorInsights AdministratorInsights Business LeaderIntune Service AdministratorKaizala AdministratorLync Service AdministratorMessage Center Privacy ReaderMessage Center ReaderModern Commerce UserNetwork AdministratorOffice Apps AdministratorPower BI Service AdministratorPower Platform AdministratorPrinter AdministratorPrinter TechnicianSearch AdministratorSearch EditorSharePoint Service AdministratorTeams Communications AdministratorTeams Communications Support EngineerTeams Communications Support SpecialistTeams Devices AdministratorTeams Administrator"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-ad-built-in-roles","title":"Azure AD built-in roles","text":"<p>In Azure Active Directory (Azure AD), if another administrator or nonadministrator needs to manage Azure AD resources, you assign them an Azure AD role that provides the permissions they need. For example, you can assign roles to allow adding or changing users, resetting user passwords, managing user licenses, or managing domain names.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#all-roles","title":"All Roles","text":"Role Description Application Administrator Users in this role can create and manage all aspects of enterprise applications, application registrations, and application proxy settings.Users assigned to this role aren't added as owners when creating new application registrations or enterprise applications.This role also grants the ability to consent for delegated permissions and application permissions, except for application permissions for Microsoft Graph. Application Developer Can create application registrations independent of the Users can register applications setting. Attack Payload Author Users in this role can create attack payloads but not actually launch or schedule them. Attack payloads are then available to all administrators in the tenant, who can use them to create a simulation. Attack Simulation Administrator Users in this role can create and manage all aspects of attack simulation creation, launch/scheduling of a simulation, and the review of simulation results. Members of this role have this access for all simulations in the tenant. Attribute Assignment Administrator Users with this role can assign and remove custom security attribute keys and values for supported Azure AD objects such as users, service principals, and devices. By default, Global Administrator and other administrator roles don't have permissions to read, define, or assign custom security attributes. To work with custom security attributes, you must be assigned one of the custom security attribute roles. Attribute Assignment Reader Users with this role can read custom security attribute keys and values for supported Azure AD objects. By default, Global Administrator and other administrator roles don't have permissions to read, define, or assign custom security attributes. You must be assigned one of the custom security attribute roles to work with custom security attributes. Attribute Definition Administrator Users with this role can define a valid set of custom security attributes that can be assigned to supported Azure AD objects. This role can also activate and deactivate custom security attributes. By default, Global Administrator and other administrator roles don't have permissions to read, define, or assign custom security attributes. To work with custom security attributes, you must be assigned one of the custom security attribute roles. Authentication Administrator Assign the Authentication Administrator role to users who need to do the following:-Set or reset any authentication method (including passwords) for nonadministrators and some roles.-Require users who are nonadministrators or assigned to some roles to re-register against existing nonpassword credentials (for example, Multifactor authentication (MFA) or Fast ID Online (FIDO), and can also revoke remember MFA on the device, which prompts for MFA on the next sign-in.-Perform sensitive actions for some users.-Create and manage support tickets in Azure and the Microsoft 365 admin center.Users with this role can't do the following tasks:-Can't change the credentials or reset MFA for members and owners of a role-assignable group.-Can't manage MFA settings in the legacy MFA management portal or Hardware OATH tokens. The same functions can be accomplished using the Set-MsolUser commandlet Azure AD PowerShell module. Authentication Policy Administrator Assign the Authentication Policy Administrator role to users who need to do the following:-Configure the authentication methods policy, tenant-wide MFA settings, and password protection policy that determine which methods each user can register and use.-Manage Password Protection settings: smart lockout configurations and updating the custom banned passwords list.-Create and manage verifiable credentials.-Create and manage Azure support tickets.Users with this role can't do the following tasks:-Can't update sensitive properties.-Can't delete or restore users.-Can't manage MFA settings in the legacy MFA management portal or Hardware OATH tokens. Azure AD Joined Device Local Administrator This role is available for assignment only as another local administrator in Device settings. Users with this role become local machine administrators on all Windows 10 devices that are joined to Azure Active Directory. They don't have the ability to manage device objects in Azure Active Directory. Azure DevOps Administrator Users with this role can manage all enterprise Azure DevOps policies applicable to all Azure DevOps organizations backed by the Azure AD.Users in this role can manage these policies by navigating to any Azure DevOps organization that is backed by the company's Azure AD.Users in this role can claim ownership of orphaned Azure DevOps organizations. This role grants no other Azure DevOps-specific permissions (for example, Project Collection Administrators) inside any of the Azure DevOps organizations backed by the company's Azure AD organization. Azure Information Protection Administrator Users with this role have all permissions in the Azure Information Protection service. This role allows configuring labels for the Azure Information Protection policy, managing protection templates, and activating protection. This role doesn't grant any permissions in Identity Protection Center, Privileged Identity Management, Monitor Microsoft 365 Service Health, or Office 365 Security and compliance center. Business-to-Consumer (B2C) Identity Experience Framework (IEF) Keyset Administrator Users can create and manage policy keys and secrets for token encryption, token signatures, and claim encryption/decryption.By adding new keys to existing key containers, this limited administrator can roll over secrets as needed without impacting existing applications.This user can see the full content of these secrets and their expiration dates even after their creation. Business-to-Consumer (B2C) Identity Experience Framework (IEF) Policy Administrator Users in this role have the ability to create, read, update, and delete all custom policies in Azure AD B2C and therefore have full control over the Identity Experience Framework in the relevant Azure AD B2C organization. By editing policies, this user can establish direct federation with external identity providers, change the directory schema, change all user-facing content HyperText Markup Language (HTML), Cascading Style Sheets (CSS), JavaScript), change the requirements to complete authentication, create new users, send user data to external systems including full migrations, and edit all user information including sensitive fields like passwords and phone numbers. Conversely, this role can't change the encryption keys or edit the secrets used for federation in the organization. Billing Administrator Makes purchases, manages subscriptions, manages support tickets, and monitors service health. Cloud App Security Administrator Users with this role have full permissions in Defender for Cloud Apps. They can add administrators, add Microsoft Defender for Cloud Apps policies and settings, upload logs, and perform governance actions. Cloud Application Administrator Users in this role have the same permissions as the Application Administrator role, excluding the ability to manage application proxy. This role grants the ability to create and manage all aspects of enterprise applications and application registrations. Users assigned to this role aren't added as owners when creating new application registrations or enterprise applications. This role also grants the ability to consent for delegated permissions and application permissions, except for application permissions for Microsoft Graph. Cloud Device Administrator Users in this role can enable, disable, and delete devices in Azure AD and read Windows 10 BitLocker keys (if present) in the Azure portal. The role doesn't grant permissions to manage any other properties on the device. Compliance Administrator Users with this role have permissions to manage compliance-related features in the Microsoft Purview compliance portal, Microsoft 365 admin center, Azure, and Office 365 Security and compliance center. Assignees can also manage all features within the Exchange admin center and create support tickets for Azure and Microsoft 365. Compliance Data Administrator Users with this role have permissions to track data in the Microsoft Purview compliance portal, Microsoft 365 admin center, and Azure. Users can also track compliance data within the Exchange admin center, Compliance Manager, and Teams and Skype for Business admin center and create support tickets for Azure and Microsoft 365. Conditional Access Administrator Users with this role have the ability to manage Azure Active Directory Conditional Access settings. Customer Lockbox Access Approver Manages Microsoft Purview Customer Lockbox requests in your organization. They receive email notifications for Customer Lockbox requests and can approve and deny requests from the Microsoft 365 admin center. They can also turn the Customer Lockbox feature on or off. Only Global Administrators can reset the passwords of people assigned to this role. Desktop Analytics Administrator Users in this role can manage the Desktop Analytics service, including viewing asset inventory, creating deployment plans, and viewing deployment and health status. Directory Readers Users in this role can read basic directory information. This role should be used for:-Granting a specific set of guest users read access instead of granting it to all guest users.-Granting a specific set of nonadmin users access to the Azure portal when \"Restrict access to Azure AD portal to admins only\" is set to \"Yes\".-Granting service principals access to the directory where Directory.Read.All isn't an option. Directory Synchronization Accounts Don't use. This role is automatically assigned to the Azure AD Connect service and isn't intended or supported for any other use. Directory Writers Users in this role can read and update basic information of users, groups, and service principals. Domain Name Administrator Users with this role can manage (read, add, verify, update, and delete) domain names. They can also read directory information about users, groups, and applications, as these objects possess domain dependencies. For on-premises environments, users with this role can configure domain names for federation so that associated users are always authenticated on-premises. These users can then sign into Azure AD-based services with their on-premises passwords via single sign-on. Federation settings need to be synced via Azure AD Connect so users also have permissions to manage Azure AD Connect. Dynamics 365 Administrator Users with this role have global permissions within Microsoft Dynamics 365 Online when the service is present, and the ability to manage support tickets and monitor service health. Edge Administrator Users in this role can create and manage the enterprise site list required for Internet Explorer mode on Microsoft Edge. This role grants permissions to create, edit, and publish the site list and additionally allows access to manage support tickets. Exchange Administrator Users with this role have global permissions within Microsoft Exchange Online, when the service is present. Also has the ability to create and manage all Microsoft 365 groups, manage support tickets, and monitor service health. Exchange Recipient Administrator Users with this role have read access to recipients and write access to the attributes of those recipients in Exchange Online. External ID User Flow Administrator Users with this role can create and manage user flows (also called \"built-in\" policies) in the Azure portal. These users can customize HTML/CSS/JavaScript content, change MFA requirements, select claims in the token, manage API connectors and their credentials, and configure session settings for all user flows in the Azure AD organization. On the other hand, this role doesn't include the ability to review user data or make changes to the attributes that are included in the organization schema. Changes to Identity Experience Framework policies (also known as custom policies) are also outside the scope of this role. External ID User Flow Attribute Administrator Users with this role add or delete custom attributes available to all user flows in the Azure AD organization.Users with this role can change or add new elements to the end-user schema and impact the behavior of all user flows, and indirectly result in changes to what data may be asked of end users and ultimately sent as claims to applications. This role can't edit user flows. External Identity Provider Administrator This administrator manages federation between Azure AD organizations and external identity providers. With this role, users can add new identity providers and configure all available settings (for example, authentication path, service ID, assigned key containers). This user can enable the Azure AD organization to trust authentications from external identity providers. The resulting impact on end-user experiences depends on the type of organization:-Azure AD organizations for employees and partners: The addition of a federation (for example, with Gmail) immediately impacts all guest invitations not yet redeemed. See Adding Google as an identity provider for B2B guest users.-Azure Active Directory B2C organizations: The addition of a federation (for example, with Facebook, or with another Azure AD organization) doesn't immediately impact end-user flows until the identity provider is added as an option in a user flow (also called a built-in policy). Global Administrator Users with this role have access to all administrative features in Azure Active Directory, and services that use Azure Active Directory identities like the Microsoft 365 Defender portal, the Microsoft Purview compliance portal, Exchange Online, SharePoint Online, and Skype for Business Online. Furthermore, Global Administrators can elevate their access to manage all Azure subscriptions and management groups. This allows Global Administrators to get full access to all Azure resources using the respective Azure AD Tenant. The person who signs up for the Azure AD organization becomes a Global Administrator. There can be more than one Global Administrator at your company. Global Administrators can reset the password for any user and all other administrators. Global Administrator As a best practice, Microsoft recommends that you assign the Global Administrator role to fewer than five people in your organization. Global Reader Users in this role can read settings and administrative information across Microsoft 365 services but can't take management actions. Global Reader is the read-only counterpart to Global Administrator. Assign Global Reader instead of Global Administrator for planning, audits, or investigations. Use Global Reader in combination with other limited admin roles like Exchange Administrator to make it easier to get work done without the assigning the Global Administrator role. Global Reader works with Microsoft 365 admin center, Exchange admin center, SharePoint admin center, Teams admin center, Security center, compliance center, Azure AD admin center, and Device Management admin center.Users with this role can't do the following tasks:-Can't access the Purchase Services area in the Microsoft 365 admin center. Groups Administrator Users in this role can create/manage groups and its settings like naming and expiration policies. It's important to understand that assigning a user to this role gives them the ability to manage all groups in the organization across various workloads like Teams, SharePoint, Yammer in addition to Outlook. Also the user is able to manage the various groups settings across various admin portals like Microsoft admin center, Azure portal, and workload specific ones like Teams and SharePoint admin centers. Guest Inviter Users in this role can manage Azure Active Directory B2B guest user invitations when the Members can invite user setting is set to No. Helpdesk Administrator Users with this role can change passwords, invalidate refresh tokens, create and manage support requests with Microsoft for Azure and Microsoft 365 services, and monitor service health. Invalidating a refresh token forces the user to sign in again. Whether a Helpdesk Administrator can reset a user's password and invalidate refresh tokens depends on the role the user is assigned.Users with this role can't do the following:-Can't change the credentials or reset MFA for members and owners of a role-assignable group. Hybrid Identity Administrator Users in this role can create, manage and deploy provisioning configuration setup from AD to Azure AD using Cloud Provisioning and manage Azure AD Connect, Pass-through Authentication (PTA), Password hash synchronization (PHS), Seamless single sign-on (Seamless SSO), and federation settings. Users can also troubleshoot and monitor logs using this role. Identity Governance Administrator Users with this role can manage Azure AD identity governance configuration, including access packages, access reviews, catalogs and policies, ensuring access is approved and reviewed and guest users who no longer need access are removed. Insights Administrator Users in this role can access the full set of administrative capabilities in the Microsoft Viva Insights app. This role has the ability to read directory information, monitor service health, file support tickets, and access the Insights Administrator settings aspects. Insights Analyst Assign the Insights Analyst role to users who need to do the following tasks:-Analyze data in the Microsoft Viva Insights app, but can't manage any configuration settings-Create, manage, and run queries-View basic settings and reports in the Microsoft 365 admin center-Create and manage service requests in the Microsoft 365 admin center Insights Business Leader Users in this role can access a set of dashboards and insights via the Microsoft Viva Insights app. This includes full access to all dashboards and presented insights and data exploration functionality. Users in this role don't have access to product configuration settings, which is the responsibility of the Insights Administrator role. Intune Administrator Users with this role have global permissions within Microsoft Intune Online, when the service is present. Additionally, this role contains the ability to manage users and devices to associate policy and create and manage groups. This role can create and manage all security groups. However, Intune Administrator doesn't have admin rights over Office groups. That means the admin can't update owners or memberships of all Office groups in the organization. However, you can manage the Office group that's created, which comes as a part of end-user privileges. So, any Office group (not security group) that you create should be counted against your quota of 250. Kaizala Administrator Users with this role have global permissions to manage settings within Microsoft Kaizala, when the service is present and the ability to manage support tickets and monitor service health. Additionally, the user can access reports related to adoption and usage of Kaizala by Organization members and business reports generated using the Kaizala actions. Knowledge Administrator Users in this role have full access to all knowledge, learning and intelligent features settings in the Microsoft 365 admin center. They have a general understanding of the suite of products, licensing details and have responsibility to control access. Knowledge Administrator can create and manage content, like topics, acronyms and learning resources. Additionally, these users can create content centers, monitor service health, and create service requests. Knowledge Manager Users in this role can create and manage content, like topics, acronyms and learning content. These users are primarily responsible for the quality and structure of knowledge. This user has full rights to topic management actions to confirm a topic, approve edits, or delete a topic. This role can also manage taxonomies as part of the term store management tool and create content centers. License Administrator Users in this role can add, remove, and update license assignments on users, groups (using group-based licensing), and manage the usage location on users. The role doesn't grant the ability to purchase or manage subscriptions, create or manage groups, or create or manage users beyond the usage location. This role has no access to view, create, or manage support tickets. Lifecycle Workflows Administrator Assign the Lifecycle Workflows Administrator role to users who need to do the following tasks:-Create and manage all aspects of workflows and tasks associated with Lifecycle Workflows in Azure AD-Check the execution of scheduled workflows-Launch on-demand workflow runs-Inspect workflow execution logs Message Center Privacy Reader Users in this role can monitor all notifications in the Message Center, including data privacy messages. Message Center Privacy Readers get email notifications including those related to data privacy and they can unsubscribe using Message Center Preferences. Only the Global Administrator and the Message Center Privacy Reader can read data privacy messages. Additionally, this role contains the ability to view groups, domains, and subscriptions. This role has no permission to view, create, or manage service requests. Message Center Reader Users in this role can monitor notifications and advisory health updates in Message center for their organization on configured services such as Exchange, Intune, and Microsoft Teams. Message Center Readers receive weekly email digests of posts, updates, and can share message center posts in Microsoft 365. In Azure AD, users assigned to this role will only have read-only access on Azure AD services such as users and groups. This role has no access to view, create, or manage support tickets. Microsoft Hardware Warranty Administrator Assign the Microsoft Hardware Warranty Administrator role to users who need to do the following tasks:-Create new warranty claims for Microsoft manufactured hardware, like Surface and HoloLens-Search and read opened or closed warranty claims-Search and read warranty claims by serial number-Create, read, update, and delete shipping addresses-Read shipping status for open warranty claims-Create and manage service requests in the Microsoft 365 admin center-Read Message center announcements in the Microsoft 365 admin center Microsoft Hardware Warranty Specialist Assign the Microsoft Hardware Warranty Specialist role to users who need to do the following tasks:-Create new warranty claims for Microsoft manufactured hardware, like Surface and HoloLens-Read warranty claims that they created-Read and update existing shipping addresses-Read shipping status for open warranty claims they created-Create and manage service requests in the Microsoft 365 admin center Modern Commerce User Don't use. This role is automatically assigned from Commerce, and isn't intended or supported for any other use.The Modern Commerce User role gives certain users permission to access Microsoft 365 admin center and see the left navigation entries for Home, Billing, and Support. The content available in these areas is controlled by commerce-specific roles assigned to users to manage products that they bought for themselves or your organization. This might include tasks like paying bills, or for access to billing accounts and billing profiles. Users with the Modern Commerce User role typically have administrative permissions in other Microsoft purchasing systems, but don't have Global Administrator or Billing Administrator roles used to access the admin center. Network Administrator Users in this role can review network perimeter architecture recommendations from Microsoft that are based on network telemetry from their user locations. Network performance for Microsoft 365 relies on careful enterprise customer network perimeter architecture, which is generally user location specific. This role allows for editing of discovered user locations and configuration of network parameters for those locations to facilitate improved telemetry measurements and design recommendations Office Apps Administrator Users in this role can manage Microsoft 365 apps' cloud settings. This includes managing cloud policies, self-service download management and the ability to view Office apps related report. This role additionally grants the ability to manage support tickets, and monitor service health within the main admin center. Users assigned to this role can also manage communication of new features in Office apps. Organizational Messages Writer Assign the Organizational Messages Writer role to users who need to do the following tasks:-Write, publish, and delete organizational messages using Microsoft 365 admin center or Microsoft Endpoint Manager-Manage organizational message delivery options using Microsoft 365 admin center or Microsoft Endpoint Manager-Read organizational message delivery results using Microsoft 365 admin center or Microsoft Endpoint Manager-View usage reports and most settings in the Microsoft 365 admin center, but can't make changes Partner Tier1 Support Don't use. This role has been deprecated and will be removed from Azure AD in the future. This role is intended for use by a few Microsoft resale partners, and isn't intended for general use. Partner Tier2 Support Don't use. This role has been deprecated and will be removed from Azure AD in the future. This role is intended for use by a few Microsoft resale partners, and isn't intended for general use. Password Administrator Users with this role have limited ability to manage passwords. This role doesn't grant the ability to manage service requests or monitor service health. Whether a Password Administrator can reset a user's password depends on the role the user is assigned.Users with this role can't do the following tasks:-Can't change the credentials or reset MFA for members and owners of a role-assignable group. Permissions Management Administrator Assign the Permissions Management Administrator role to users who need to do the following tasks:-Manage all aspects of Entra Permissions Management, when the service is present Power Business Intelligence (BI) Administrator Users with this role have global permissions within Microsoft Power BI, when the service is present and the ability to manage support tickets and monitor service health. Power Platform Administrator Users in this role can create and manage all aspects of environments, Power Apps, Flows, Data Loss Prevention policies. Additionally, users with this role have the ability to manage support tickets and monitor service health. Printer Administrator Users in this role can register printers and manage all aspects of all printer configurations in the Microsoft Universal Print solution, including the Universal Print Connector settings. They can consent to all delegated print permission requests. Printer Administrators also have access to print reports. Printer Technician Users with this role can register printers and manage printer status in the Microsoft Universal Print solution. They can also read all connector information. Key task a Printer Technician can't do is set user permissions on printers and sharing printers. Privileged Authentication Administrator Assign the Privileged Authentication Administrator role to users who need to do the following tasks:-Set or reset any authentication method (including passwords) for any user, including Global Administrators.-Delete or restore any users, including Global Administrators. For more information, see Who can perform sensitive actions.-Force users to re-register against existing nonpassword credential (such as MFA or FIDO) and revoke remember MFA on the device, prompting for MFA on the next sign-in of all users.-Update sensitive properties for all users. For more information, see Who can perform sensitive actions.-Create and manage support tickets in Azure and the Microsoft 365 admin center.Users with this role can't do the following tasks:-Can't manage per-user MFA in the legacy MFA management portal. The same functions can be accomplished using the Set-MsolUser commandlet Azure AD PowerShell module. Privileged Role Administrator Users with this role can manage role assignments in Azure Active Directory and within Azure AD Privileged Identity Management. They can create and manage groups that can be assigned to Azure AD roles. In addition, this role allows management of all aspects of Privileged Identity Management and administrative units. Privileged Role Administrator This role grants the ability to manage assignments for all Azure AD roles including the Global Administrator role. This role doesn't include any other privileged abilities in Azure AD like creating or updating users. However, users assigned to this role can grant themselves or others another privilege by assigning extra roles. Reports Reader Users with this role can view usage reporting data and the reports dashboard in Microsoft 365 admin center and the adoption context pack in Power Business Intelligence (Power BI). Additionally, the role provides access to all sign-in logs, audit logs, and activity reports in Azure AD and data returned by the Microsoft Graph reporting API. A user assigned to the Reports Reader role can access only relevant usage and adoption metrics. They don't have any admin permissions to configure settings or access the product-specific admin centers like Exchange. This role has no access to view, create, or manage support tickets. Search Administrator Users in this role have full access to all Microsoft Search management features in the Microsoft 365 admin center. Additionally, these users can view the message center, monitor service health, and create service requests. Search Editor Users in this role can create, manage, and delete content for Microsoft Search in the Microsoft 365 admin center, including bookmarks, questions and answers, and locations. Security Administrator Users with this role have permissions to manage security-related features in the Microsoft 365 Defender portal, Azure Active Directory Identity Protection, Azure Active Directory Authentication, Azure Information Protection, and Office 365 Security and compliance center. Security Operator Users with this role can manage alerts and have global read-only access on security-related features, including all information in Microsoft 365 security center, Azure Active Directory, Identity Protection, Privileged Identity Management and Office 365 Security &amp; compliance center. Security Reader Users with this role have global read-only access on security-related feature, including all information in Microsoft 365 security center, Azure Active Directory, Identity Protection, Privileged Identity Management, and the ability to read Azure Active Directory sign-in reports and audit logs, and in Office 365 Security and compliance center. Service Support Administrator Users with this role can create and manage support requests with Microsoft for Azure and Microsoft 365 services, and view the service dashboard and message center in the Azure portal and Microsoft 365 admin center. SharePoint Administrator Users with this role have global permissions within Microsoft SharePoint Online, when the service is present, and the ability to create and manage all Microsoft 365 groups, manage support tickets, and monitor service health. Skype for Business Administrator Users with this role have global permissions within Microsoft Skype for Business, when the service is present, and manage Skype-specific user attributes in Azure Active Directory. Additionally, this role grants the ability to manage support tickets and monitor service health, and to access the Teams and Skype for Business admin center. The account must also be licensed for Teams or it can't run Teams PowerShell cmdlets. Teams Administrator Users in this role can manage all aspects of the Microsoft Teams workload via the Microsoft Teams and Skype for Business admin center and the respective PowerShell modules. This includes, among other areas, all management tools related to telephony, messaging, meetings, and the teams themselves. This role additionally grants the ability to create and manage all Microsoft 365 groups, manage support tickets, and monitor service health. Teams Communications Administrator Users in this role can manage aspects of the Microsoft Teams workload related to voice and telephony. This includes the management tools for telephone number assignment, voice and meeting policies, and full access to the call analytics toolset. Teams Communications Support Engineer Users in this role can troubleshoot communication issues within Microsoft Teams and Skype for Business using the user call troubleshooting tools in the Microsoft Teams and Skype for Business admin center. Users in this role can view full call record information for all participants involved. This role has no access to view, create, or manage support tickets. Teams Communications Support Specialist Users in this role can troubleshoot communication issues within Microsoft Teams and Skype for Business using the user call troubleshooting tools in the Microsoft Teams and Skype for Business admin center. Users in this role can only view user details in the call for the specific user they've looked up. This role has no access to view, create, or manage support tickets. Teams Devices Administrator Users with this role can manage Teams-certified devices from the Teams admin center. This role allows viewing all devices at single glance, with ability to search and filter devices. The user can check details of each device including logged-in account, make and model of the device. The user can change the settings on the device and update the software versions. This role doesn't grant permissions to check Teams activity and call quality of the device. Tenant Creator Assign the Tenant Creator role to users who need to do the following tasks:-Create both Azure Active Directory and Azure Active Directory B2C tenants even if the tenant creation toggle is turned off in the user settings Usage Summary Reports Reader Users with this role can access tenant level aggregated data and associated insights in Microsoft 365 admin center for Usage and Productivity Score but can't access any user level details or insights. In Microsoft 365 admin center for the two reports, we differentiate between tenant level aggregated data and user level details. This role gives an extra layer of protection on individual user identifiable data, which was requested by both customers and legal teams. User Administrator Assign the User Administrator role to users who need to do the following tasks:-Create users-Update most user properties for all users, including all administrators-Update sensitive properties (including user principal name) for some users-Disable or enable some users-Delete or restore some users-Create and manage user views-Create and manage all groups-Assign licenses for all users, including all administrators-Reset passwords-Invalidate refresh tokens-Update (FIDO) device keys-Update password expiration policies-Create and manage support tickets in Azure and the Microsoft 365 admin center-Monitor service healthUsers with this role can't do the following tasks:-Can't manage MFA.-Can't change the credentials or reset MFA for members and owners of a role-assignable group.-Can't manage shared mailboxes User Administrator Users with this role can change passwords for people who may have access to sensitive or private information or critical configuration inside and outside of Azure Active Directory. Changing the password of a user may mean the ability to assume that user's identity and permissions.For example:-Application Registration and Enterprise Application owners, who can manage credentials of apps they own. Those apps may have privileged permissions in Azure AD and elsewhere not granted to User Administrators. Through this path, a User Administrator may be able to assume the identity of an application owner and then further assume the identity of a privileged application by updating the credentials for the application.-Azure subscription owners, who may have access to sensitive or private information or critical configuration in Azure.-Security Group and Microsoft 365 group owners, who can manage group membership. Those groups may grant access to sensitive or private information or critical configuration in Azure AD and elsewhere.-Administrators in other services outside of Azure AD like Exchange Online, Office Security and compliance center, and human resources systems.-Nonadministrators like executives, legal counsel, and human resources employees who may have access to sensitive or private information. Virtual Visits Administrator Users with this role can do the following tasks:-Manage and configure all aspects of Virtual Visits in Bookings in the Microsoft 365 admin center, and in the Teams Electronic Health Record (EHR) connector-View usage reports for Virtual Visits in the Teams admin center, Microsoft 365 admin center, and Power BI-View features and settings in the Microsoft 365 admin center, but can't edit any settings Windows 365 Administrator Users with this role have global permissions on Windows 365 resources, when the service is present. Additionally, this role contains the ability to manage users and devices in order to associate policy and create and manage groups.This role can create and manage security groups, but doesn't have administrator rights over Microsoft 365 groups. That means administrators can't update owners or memberships of Microsoft 365 groups in the organization. However, they can manage the Microsoft 365 group they create, which is a part of their end-user privileges. So, any Microsoft 365 group (not security group) they create is counted against their quota of 250.Assign the Windows 365 Administrator role to users who need to do the following tasks:-Manage Windows 365 Cloud PCs in Microsoft Endpoint Manager-Enroll and manage devices in Azure AD, including assigning users and policies-Create and manage security groups, but not role-assignable groups-View basic properties in the Microsoft 365 admin center-Read usage reports in the Microsoft 365 admin center-Create and manage support tickets in Azure and the Microsoft 365 admin center Windows Update Deployment Administrator Users in this role can create and manage all aspects of Windows Update deployments through the Windows Update for Business deployment service. The deployment service enables users to define settings for when and how updates are deployed, and specify which updates are offered to groups of devices in their tenant. It also allows users to monitor the update progress. Yammer Administrator Assign the Yammer Administrator role to users who need to do the following tasks:-Manage all aspects of Yammer-Create, manage, and restore Microsoft 365 Groups, but not role-assignable groups-View the hidden members of Security groups and Microsoft 365 groups, including role assignable groups-Read usage reports in the Microsoft 365 admin center-Create and manage service requests in the Microsoft 365 admin center-View announcements in the Message center, but not security announcements-View service health                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              # Deploy Azure AD Domain Services Azure Active Directory Domain Services (Azure AD DS) provides managed domain services such as domain join, group policy, lightweight directory access protocol (LDAP), and Kerberos/New Technology LAN Manager (NTLM) authentication. You use these domain services without the need to deploy, manage, and patch domain controllers (DCs) in the cloud. <p>An Azure AD DS managed domain lets you run legacy applications in the cloud that can't use modern authentication methods or where you don't want directory lookups to always go back to an on-premises AD DS environment. You can lift and shift those legacy applications from your on-premises environment into a managed domain without needing to manage the AD DS environment in the cloud.</p> <p>Azure AD DS integrates with your existing Azure AD tenant. This integration lets users sign in to services and applications connected to the managed domain using their existing credentials. You can also use existing groups and user accounts to secure access to resources. These features provide a smoother lift-and-shift of on-premises resources to Azure.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#how-does-azure-ad-ds-work","title":"How does Azure AD DS work?","text":"<p>When you create an Azure AD DS managed domain, you define a unique namespace. This namespace is the domain name, such as aaddscontoso.com. Two Windows Server domain controllers (DCs) are then deployed into your selected Azure region. This deployment of DCs is known as a replica set.</p> <p>You don't need to manage, configure, or update these DCs. The Azure platform handles the DCs as part of the managed domain, including backups and encryption at rest using Azure Disk Encryption.</p> <p>A managed domain is configured to perform a one-way synchronization from Azure AD to provide access to a central set of users, groups, and credentials. You can create resources directly in the managed domain, but they aren't synchronized back to Azure AD. Applications, services, and VMs in Azure that connect to the managed domain can then use common AD DS features such as domain join, group policy, LDAP, and Kerberos/NTLM authentication.</p> <p>In a hybrid environment with an on-premises AD DS environment, Azure AD Connect synchronizes identity information with Azure AD, which is then synchronized to the managed domain.</p> <p></p> <p>Azure AD DS replicates identity information from Azure AD, so it works with Azure AD tenants that are cloud-only or synchronized with an on-premises AD DS environment. The same set of Azure AD DS features exists for both environments.</p> <ul> <li>If you have an existing on-premises AD DS environment, you can synchronize user account information to provide a consistent identity for users.</li> <li>For cloud-only environments, you don't need a traditional on-premises AD DS environment to use the centralized identity services of Azure AD DS.</li> </ul> <p>You can expand a managed domain to have more than one replica set per Azure AD tenant. Replica sets can be added to any peered virtual network in any Azure region that supports Azure AD DS. Additional replica sets in different Azure regions provide geographical disaster recovery for legacy applications if an Azure region goes offline.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-ad-ds-features-and-benefits","title":"Azure AD DS features and benefits","text":"<p>To provide identity services to applications and VMs in the cloud, Azure AD DS is fully compatible with a traditional AD DS environment for operations such as domain-join, secure LDAP (LDAPS), Group Policy, DNS management, and LDAP bind and read support. LDAP write support is available for objects created in the managed domain but not resources synchronized from Azure AD.</p> <p>The following features of Azure AD DS simplify deployment and management operations:</p> <ul> <li>Simplified deployment experience: Azure AD DS is enabled for your Azure AD tenant using a single wizard in the Azure portal. </li> <li>Integrated with Azure AD: User accounts, group memberships, and credentials are automatically available from your Azure AD tenant. New users, groups, or changes to attributes from your Azure AD tenant or your on-premises AD DS environment are automatically synchronized to Azure AD DS.<ul> <li>Accounts in external directories linked to your Azure AD aren't available in Azure AD DS. Credentials aren't available for those external directories, so they can't be synchronized into a managed domain.</li> </ul> </li> <li>Use your corporate credentials/passwords: Passwords for users in Azure AD DS are the same as in your Azure AD tenant. Users can use their corporate credentials to domain-join machines, sign in interactively or over a remote desktop, and authenticate against the managed domain.</li> <li>NTLM and Kerberos authentication: With support for NTLM and Kerberos authentication, you can deploy applications that rely on Windows-integrated authentication.</li> <li>High availability: Azure AD DS includes multiple domain controllers, which provide high availability for your managed domain. This high availability guarantees service uptime and resilience to failures.<ul> <li>In regions that support Azure Availability Zones, these domain controllers are distributed across zones for additional resiliency.</li> <li>Replica sets can also be used to provide geographical disaster recovery for legacy applications if an Azure region goes offline.</li> </ul> </li> </ul> <p>Some key aspects of a managed domain include the following:    - The managed domain is a stand-alone domain. It isn't an extension of an on-premises domain.        - If needed, you can create one-way outbound forest trusts from Azure AD DS to an on-premises AD DS environment.    - Your IT team doesn't need to manage, patch, or monitor domain controllers for this managed domain.</p> <p>For hybrid environments that run AD DS on-premises, you don't need to manage AD replication to the managed domain. User accounts, group memberships, and credentials from your on-premises directory are synchronized to Azure AD via Azure AD Connect. These user accounts, group memberships, and credentials are automatically available within the managed domain.</p> <pre><code>Important\n\nAzure AD DS integrates with Azure AD, which can synchronize with an on-premises AD DS environment. \nThis ability extends central identity use cases to traditional web applications that run in Azure as part of a lift-and-shift strategy.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#create-and-manage-azure-ad-users","title":"Create and manage Azure AD users","text":"<p>Add new users or delete existing users from your Azure Active Directory (Azure AD) tenant. To add or delete users, you must be a User Administrator or Global Administrator.</p> <pre><code> Note\n\nFor information about viewing or deleting personal data, please review Microsoft's guidance on the Windows data subject requests for the General Data Protection Regulation (GDPR) site. For general information about GDPR, see the GDPR section of the Microsoft Trust Center and the GDPR section of the Service Trust portal.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#add-a-new-user","title":"Add a new user","text":"<p>You can create a new user for your organization or invite an external user from the same starting point.</p> <ol> <li>Sign in to the Azure portal in the User Administrator role.</li> <li>Navigate to Azure Active Directory &gt; Users.</li> <li> <p>Select either Create new user or Invite external user from the menu.    </p> </li> <li> <p>On the New User page, provide the new user's information:</p> <ul> <li>Identity: Add a user name and display name for the user. User name and Name are required and can't contain accent characters. You can also add a first and last name.     The domain part of the user name must use either the initial default domain name,    .onmicrosoft.com, or a custom domain name, such as contoso.com. <li>Groups and roles: Optional. Add the user to one or more existing groups. Group membership can be set at any time.</li> <li>Settings: Optional. Toggle the option to block sign-in for the user or set the user's default location.</li> <li>Job info: Optional. Add the user's job title, department, company name, and manager. These details can be updated at any time.</li> <li>Copy the autogenerated password provided in the Password box. You'll need to give this password to the user to sign in for the first time.</li> <li>Select Create. </li> <p>The user is created and added to your Azure AD organization.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#add-a-new-guest-user","title":"Add a new guest user","text":"<p>You can also invite the new guest user to collaborate with your organization by selecting Invite user from the New user page. If your organization's external collaboration settings are configured to allow guests, the user will be emailed an invitation they must accept in order to begin collaborating.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#add-other-users","title":"Add other users","text":"<p>There might be scenarios where you want to manually create consumer accounts in your Azure Active Directory B2C (Azure AD B2C) directory. If you have an environment with Azure Active Directory (cloud) and Windows Server Active Directory (on-premises), you can add new users by syncing the existing user account data.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#delete-a-user","title":"Delete a user","text":"<p>You can delete an existing user using the Azure Active Directory portal.</p> <ul> <li>You must have a Global Administrator, Privileged Authentication Administrator, or User Administrator role assignment to delete users in your organization.</li> <li>Global Admins and Privileged Authentication Admins can delete any users, including other admins.</li> <li> <p>User Administrators can delete any non-admin users, Helpdesk Administrators, and other User Administrators.</p> </li> <li> <p>Sign in to the Azure portal using one of the appropriate roles listed above.</p> </li> <li>Go to Azure Active Directory &gt; Users.</li> <li>Search for and select the user you want to delete from your Azure AD tenant.</li> <li>Select Delete user.</li> </ul> <p>The user is deleted and no longer appears on the Users - All users page. The user can be seen on the Deleted users page for the next 30 days and can be restored during that time.</p> <p>When a user is deleted, any licenses consumed by the user are made available for other users.</p> <pre><code> Note\n\nTo update the identity, contact information, or job information for users whose source of authority is Windows Server Active Directory, you must use Windows Server Active Directory. After you complete the update, you must wait for the next synchronization cycle to complete before you see the changes.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#manage-users-with-azure-ad-groups","title":"Manage users with Azure AD groups","text":"<p>Azure Active Directory (Azure AD) provides several ways to manage access to resources, applications, and tasks. With Azure AD groups, you can grant access and permissions to a group of users instead of each individual user. Limiting access to Azure AD resources to only those users who need access is one of the core security principles of Zero Trust.</p> <p>Azure AD lets you use groups to manage access to applications, data, and resources. Resources can be:</p> <ul> <li>Part of the Azure AD organization, such as permissions to manage objects through roles in Azure AD</li> <li>External to the organization, such as for Software as a Service (SaaS) apps</li> <li>Azure services</li> <li>SharePoint sites</li> <li>On-premises resources</li> </ul> <p>Some groups can't be managed in the Azure AD portal:</p> <ul> <li>Groups synced from on-premises Active Directory can be managed only in on-premises Active Directory.</li> <li>Distribution lists and mail-enabled security groups are managed only in Exchange admin center or Microsoft 365 admin center. You must sign in to the Exchange admin center or Microsoft 365 admin center to manage these groups.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#what-to-know-before-creating-a-group","title":"What to know before creating a group","text":"<p>There are two group types and three group membership types.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#group-types","title":"Group types:","text":"<p>Security: Used to manage user and computer access to shared resources. For example, you can create a security group so that all group members have the same set of security permissions. Members of a security group can include users, devices, other groups, and service principals, which define access policy and permissions. Owners of a security group can include users and service principals.</p> <p>Microsoft 365: Provides collaboration opportunities by giving group members access to a shared mailbox, calendar, files, SharePoint sites, and more.</p> <p>This option also lets you give people outside of your organization access to the group. Members of a Microsoft 365 group can only include users. Owners of a Microsoft 365 group can include users and service principals.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#membership-types","title":"Membership types:","text":"<ul> <li>Assigned: Lets you add specific users as members of a group and have unique permissions.</li> <li>Dynamic user: Lets you use dynamic membership rules to automatically add and remove members. If a member's attributes change, the system looks at your dynamic group rules for the directory to see if the member meets the rule requirements (is added), or no longer meets the rules requirements (is removed). Dynamic device: Lets you use dynamic group rules to automatically add and remove devices. If a device's attributes change, the system looks at your dynamic group rules for the directory to see if the device meets the rule requirements (is added), or no longer meets the rules requirements (is removed).</li> </ul> <p>Important</p> <p>You can create a dynamic group for either devices or users but not for both. You can't create a device group based on the device owners' attributes. Device membership rules can only reference device attributions.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-azure-ad-administrative-units","title":"Configure Azure AD administrative units","text":"<p>An administrative unit is an Azure AD resource that can be a container for other Azure AD resources. An administrative unit can contain only users and groups. Administrative units restrict permissions in a role to any portion of your organization that you define. You could, for example, use administrative units to delegate the Helpdesk Administrator role to regional support specialists, so they can manage users only in the region that they support.</p> <pre><code>Note\n\nTo use administrative units, you need an Azure Active Directory Premium license for each administrative unit admin, \nand Azure Active Directory Free licenses for administrative unit members.\n</code></pre> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#available-roles","title":"Available roles","text":"Role Description Authentication Administrator Has access to view, set, and reset authentication method information for any non-admin user in the assigned administrative unit only. Groups Administrator Can manage all aspects of groups and groups settings, such as naming and expiration policies, in the assigned administrative unit only. Helpdesk Administrator Can reset passwords for non-administrators and Helpdesk administrators in the assigned administrative unit only. License Administrator Can assign, remove, and update license assignments within the administrative unit only. Password Administrator Can reset passwords for non-administrators and Password Administrators within the assigned administrative unit only. User Administrator Can manage all aspects of users and groups, including resetting passwords for limited admins within the assigned administrative unit only."},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-passwordless-authentication","title":"Implement passwordless authentication","text":"<p>Features like multifactor authentication (MFA) are a great way to secure your organization. Still, users often get frustrated with the additional security layer on top of having to remember their passwords. Passwordless authentication methods are more convenient because the password is removed and replaced with something you have, plus something you are or something you know.</p> Authentication Something you have Something you are or know Passwordless Windows 10 Device, phone, or security key Biometric or PIN <p>Each organization has different needs when it comes to authentication. Microsoft global Azure and Azure Government offer the following three passwordless authentication options that integrate with Azure Active Directory (Azure AD):    1. Windows Hello for Business    2. Microsoft Authenticator    3. Fast Identity Online2 (FIDO2) security keys</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#windows-hello-for-business","title":"Windows Hello for Business","text":"<p>Windows Hello for Business is ideal for information workers that have their own designated Windows PC. The biometric and PIN credentials are directly tied to the user's PC, which prevents access from anyone other than the owner. With public key infrastructure (PKI) integration and built-in support for single sign-on (SSO), Windows Hello for Business provides a convenient method for seamlessly accessing corporate resources on-premises and in the cloud.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#microsoft-authenticator","title":"Microsoft Authenticator","text":"<p>You can also allow your employee's phone to become a passwordless authentication method. You may already be using the Authenticator app as a convenient multi-factor authentication option in addition to a password. You can also use the Authenticator App as a passwordless option.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#fast-identity-online2-fido2-security-keys","title":"Fast Identity Online2 (FIDO2) security keys:","text":"<p>The FIDO (Fast IDentity Online) Alliance helps to promote open authentication standards and reduce the use of passwords as a form of authentication. FIDO2 is the latest standard that incorporates the web authentication (WebAuthn) standard.</p> <p>FIDO2 security keys are an unphishable standards-based passwordless authentication method that can come in any form factor. Fast Identity Online (FIDO) is an open standard for passwordless authentication. FIDO allows users and organizations to leverage the standard to sign in to their resources without a username or password using an external security key or a platform key built into a device.</p> <p>Users can register and then select a FIDO2 security key at the sign-in interface as their main means of authentication. These FIDO2 security keys are typically USB devices but could also use Bluetooth or Near-Field Communication (NFC). With a hardware device that handles the authentication, the security of an account is increased as there's no password that could be exposed or guessed.</p> <p>FIDO2 security keys can be used to sign into their Azure AD or hybrid Azure AD joined Windows 10 devices and get single-sign-on to their cloud and on-premises resources. Users can also sign in to supported browsers. FIDO2 security keys are a great option for enterprises that are very security sensitive or have scenarios or employees who aren't willing or able to use their phone as a second factor.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-try-this-exercises","title":"Explore Try-This exercises","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-1-review-azure-ad","title":"Task 1: Review Azure AD","text":"<p>In this task, we'll review Azure Active Directory licensing and tenants.</p> <ol> <li>In the Portal, search for and select Azure Active Directory.</li> <li>On the Overview page, locate the license information.</li> <li>Go to the Azure AD pricing page and review the features and pricing for each edition.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-2-manage-users-and-groups","title":"Task 2: Manage users and groups","text":"<pre><code>Note: \nThis task requires some users and groups to be populated. Dynamic groups requires a Premium P1 license.\n</code></pre> <p>In this task, we'll create users and groups.</p> <ol> <li>Under the Manage blade, click Users.</li> <li>Review the different Sources such as Windows Server AD, Invited User, Microsoft Account, and External Azure Active Directory.</li> <li>Notice the choice for New guest user.</li> <li>Click New user.</li> <li>Review the two ways to create a user: Create user and Invite user.</li> <li>Create a new user. Review Identity, Groups and roles, Settings, and Job Info.</li> <li>Navigate to Azure AD, under Manage click Groups.</li> <li>Review the Group types: Security and Microsoft 365.</li> <li>Create a new group by clicking \"New Group\" with the Membership type as Assigned.</li> <li>Add a user to the same group.</li> <li>Create another new group with Membership type as Dynamic user.</li> <li>Review the details to construct dynamic group membership rules.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-3-multifactor-authentication-in-azure","title":"Task 3: multifactor authentication in Azure","text":"<pre><code>Note\n\nThis task requires a user account, AZ500User1.\n</code></pre> <p>In this demonstration, we will configure and test MFA.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-mfa","title":"Configure MFA","text":"<p>In this task, we'll enable MFA for a user.</p> <ol> <li>In the Portal, search for and select Azure Active Directory.</li> <li>Under Manage select Security.</li> <li>Under Manage select MFA.</li> <li>In the center pane, under Configure select Additional cloud-based MFA settings.</li> <li>Select the Users tab.</li> <li>Select AZ500User1. Make a note of their user name in the form user@domain.com.</li> <li>On the far right click Enable.</li> <li>Read the information about enabling multifactor authentication in Azure.</li> <li>Click enable multi-factor auth.</li> <li>Wait for update. AZ500User1 will now be required to provide two factor authentication.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#question","title":"Question","text":"<ol> <li> <p>Your organization is considering multifactor authentication in Azure. Your manager asks about secondary verification methods. Which of the following options could serve as secondary verification method?</p> <ul> <li>Automated phone call (Ans).</li> <li>Emailed link to verification website.</li> <li>Microsoft account verification code.</li> </ul> </li> <li> <p>Your organization has implemented multifactor authentication in Azure. Your goal is to provide a status report by user account. Which of the following values could be used to provide a valid MFA status?</p> <ul> <li>Enrolled</li> <li>Enforced (Ans)</li> <li>Required</li> </ul> </li> <li> <p>Which of the following options can be used when configuring multifactor authentication in Azure?</p> <ul> <li>Block a user if stolen password is suspected.</li> <li>Configure IP addresses outside the company intranet that should be blocked.</li> <li>Configure a one-time bypass to allow a user to authenticate a single time without performing multi-factor authentication. The bypass is temporary and expires after a specified number of seconds. In situations where the mobile app or phone isn't receiving a notification or phone call, you can allow a one-time bypass so the user can access the desired resource (Ans).</li> </ul> </li> <li> <p>Which of the following roles would allow the user to manage all the groups in a tenant and would be able to assign other admin roles?</p> <ul> <li>Global administrator (Ans)</li> <li>Password administrator</li> <li>Security administrator</li> </ul> </li> <li> <p>Which of the following methods enable you to automatically add or remove users to security groups or Microsoft 365 groups, so you don't always have to do it manually?</p> <ul> <li>Automatic add</li> <li>Dynamic user (Ans)</li> <li>Microsoft 365 user</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-hybrid-identity","title":"Implement Hybrid identity","text":"<p>Explore how to deploy and configure Azure AD Connect to create a hybrid identity solution for your company.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#introduction_1","title":"Introduction","text":"<p>Hybrid Identity is the process of connecting your on-premises Active Directory with your Azure Active Directory. You do this to enable a single account to have access to resources on-premises and in the cloud. There are many other security benefits as well.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#scenario_1","title":"Scenario","text":"<p>A security engineer uses Hybrid Identity to share identity, authentication, and access across on-premises and cloud resources; you will work on such tasks as:</p> <ul> <li>Connect your on-premises AD with your Azure AD.</li> <li>Select the best authentication option based on your user's needs and your security goals.</li> <li>Configure authentication options to create your most secure environment.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#skills-measured_1","title":"Skills measured","text":"<p>Azure Active Directory is a part of Exam AZ-500: Microsoft Azure Security Engineer.</p> <p>Manage identity and access (30-35%)</p> <ul> <li>Manage Azure AD identities<ul> <li>configure authentication methods including password hash and Pass-Through Authentication (PTA), OAuth, and passwordless</li> </ul> </li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#learning-objectives_1","title":"Learning objectives","text":"<ul> <li>Configure and deploy Azure AD Connect.</li> <li>Configure password hash synchronization.</li> <li>Implement pass-through authentication.</li> <li>Select and configure the optimal authentication method based on your security posture.</li> <li>Deploy password writeback.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#deploy-azure-ad-connect","title":"Deploy Azure AD connect","text":"<p>Azure AD Connect will integrate your on-premises directories with Azure Active Directory. This allows you to provide a common identity for your users for Microsoft 365, Azure, and SaaS applications integrated with Azure AD.</p> <p></p> <p>Azure AD Connect provides the following features:</p> <ul> <li>Password hash synchronization. A sign-in method that synchronizes a hash of a users on-premises AD password with Azure AD.</li> <li>Pass-through authentication. A sign-in method that allows users to use the same password on-premises and in the cloud, but doesn't require the additional infrastructure of a federated environment.</li> <li>Federation integration. Federation is an optional part of Azure AD Connect and can be used to configure a hybrid environment using an on-premises AD FS infrastructure. It also provides AD FS management capabilities such as certificate renewal and additional AD FS server deployments.</li> <li>Synchronization. Responsible for creating users, groups, and other objects. As well as, making sure identity information for your on-premises users and groups is matching the cloud. This synchronization also includes password hashes.</li> <li>Health Monitoring. Azure AD Connect Health can provide robust monitoring and provide a central location in the Azure portal to view this activity.</li> </ul> <p>When you integrate your on-premises directories with Azure AD, your users are more productive because there's a common identity to access both cloud and on-premises resources. However, this integration creates the challenge of ensuring that this environment is healthy so that users can reliably access resources both on premises and in the cloud from any device.</p> <p></p> <p>Azure Active Directory (Azure AD) Connect Health provides robust monitoring of your on-premises identity infrastructure. It enables you to maintain a reliable connection to Microsoft 365 and Microsoft Online Services. This reliability is achieved by providing monitoring capabilities for your key identity components. Also, it makes the key data points about these components easily accessible. Azure AD Connect Health helps you:</p> <ul> <li>Monitor and gain insights into AD FS servers, Azure AD Connect, and AD domain controllers.</li> <li>Monitor and gain insights into the synchronizations that occur between your on-premises AD DS and Azure AD.</li> <li>Monitor and gain insights into your on-premises identity infrastructure that is used to access Microsoft 365 or other Azure AD applications</li> </ul> <p>With Azure AD Connect the key data you need is easily accessible. You can view and act on alerts, setup email notifications for critical alerts, and view performance data.</p> <pre><code>Important\n\nUsing AD Connect Health works by installing an agent on each of your on-premises sync servers.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-authentication-options","title":"Explore authentication options","text":"<p>Choosing the correct authentication method is the first concern for organizations wanting to move their apps to the cloud. Don't take this decision lightly, for the following reasons:</p> <ul> <li>It's the first decision for an organization that wants to move to the cloud.</li> <li>The authentication method is a critical component of an organization\u2019s presence in the cloud. It controls access to all cloud data and resources.</li> <li>It's the foundation of all the other advanced security and user experience features in Azure AD.</li> </ul> <p>Identity is the new control plane of IT security, so authentication is an organization\u2019s access guard to the new cloud world. Organizations need an identity control plane that strengthens their security and keeps their cloud apps safe from intruders.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#authentication-methods","title":"Authentication methods","text":"<p>When the Azure AD hybrid identity solution is your new control plane, authentication is the foundation of cloud access. Choosing the correct authentication method is a crucial first decision in setting up an Azure AD hybrid identity solution. Implement the authentication method that is configured by using Azure AD Connect, which also provisions users in the cloud.</p> <p>Azure AD supports the following authentication methods for hybrid identity solutions.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#cloud-authentication","title":"Cloud authentication","text":"<p>When you choose this authentication method, Azure AD handles users' sign-in process. Coupled with seamless single sign-on (SSO), users can sign in to cloud apps without having to reenter their credentials. With cloud authentication, you can choose from two options:</p> <p>Option 1: Azure AD password hash synchronization. The simplest way to enable authentication for on-premises directory objects in Azure AD. Users can use the same username and password that they use on-premises without having to deploy any additional infrastructure. Some premium features of Azure AD, like Identity Protection and Azure AD Domain Services, require password hash synchronization, no matter which authentication method you choose.</p> <p>Option 2: Azure AD Pass-through Authentication. Provides a simple password validation for Azure AD authentication services by using a software agent that runs on one or more on-premises servers. The servers validate the users directly with your on-premises Active Directory, which ensures that the password validation doesn't happen in the cloud.</p> <p>Companies with a security requirement to immediately enforce on-premises user account states, password policies, and sign-in hours might use this authentication method.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#federated-authentication","title":"Federated authentication","text":"<p>When you choose the Federated authentication method, Azure AD hands off the authentication process to a separate trusted authentication system, such as on-premises Active Directory Federation Services (AD FS), to validate the user\u2019s password.</p> <p>The authentication system can provide additional advanced authentication requirements. Examples are smartcard-based authentication or third-party multifactor authentication.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#summary","title":"Summary","text":"<ul> <li>This lesson outlines various authentication options that organizations can configure and deploy to support access to cloud apps.</li> <li>To meet various business, security, and technical requirements, organizations can choose between password hash synchronization, Pass-through Authentication, and federation.</li> <li>Consider each authentication method. Does the effort to deploy the solution, and the user's experience of the sign-in process address your business requirements?</li> <li>Evaluate whether your organization needs the advanced scenarios and business continuity features of each authentication method.</li> <li>Finally, evaluate the considerations of each authentication method. Do any of them prevent you from implementing your choice?</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-password-hash-synchronization-phs","title":"Configure Password Hash Synchronization (PHS)","text":"<p>The probability that you're blocked from getting your work done due to a forgotten password is related to the number of different passwords you need to remember. The more passwords you need to remember, the higher the probability to forget one. Questions and calls about password resets and other password-related issues demand the most helpdesk resources.</p> <p></p> <p>Password hash synchronization (PHS) is a feature used to synchronize user passwords from an on-premises Active Directory instance to a cloud-based Azure AD instance. Use this feature to sign in to Azure AD services like Microsoft 365, Microsoft Intune, CRM Online, and Azure Active Directory Domain Services (Azure AD DS). You sign in to the service by using the same password you use to sign in to your on-premises Active Directory instance. Password hash synchronization helps you to:</p> <ul> <li>Improve the productivity of your users.</li> <li>Reduce your helpdesk costs.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#how-does-this-work","title":"How does this work?","text":"<p>In the background, the password synchronization component takes the user\u2019s password hash from on-premises Active Directory, encrypts it, and passes it as a string to Azure. Azure decrypts the encrypted hash and stores the password hash as a user attribute in Azure AD.</p> <p>When the user signs in to an Azure service, the sign-in challenge dialog box generates a hash of the user\u2019s password and passes that hash back to Azure. Azure then compares the hash with the one in that user\u2019s account. If the two hashes match, then the two passwords must also match and the user receives access to the resource. The dialog box provides the facility to save the credentials so that the next time the user accesses the Azure resource, the user will not be prompted.</p> <pre><code>Important\n\nIt is important to understand that this is same sign-in, not single sign-on. The user still authenticates against two separate directory services, albeit with the same user name and password. This solution provides a simple alternative to an AD FS implementation.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-pass-through-authentication-pta","title":"Implement Pass-through Authentication (PTA)","text":"<p>Azure AD Pass-through Authentication (PTA) is an alternative to Azure AD Password Hash Synchronization, and provides the same benefit of cloud authentication to organizations. PTA allows users to sign in to both on-premises and cloud-based applications using the same user account and passwords. When users sign-in using Azure AD, Pass-through authentication validates the users\u2019 passwords directly against an organization's on-premise Active Directory.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#feature-benefits","title":"Feature benefits","text":"<ul> <li>Supports user sign-in into all web browser-based applications and into Microsoft Office client applications that use modern authentication.</li> <li>Sign-in usernames can be either the on-premises default username (userPrincipalName) or another attribute configured in Azure AD Connect (known as Alternate ID).</li> <li>Works seamlessly with conditional access features such as Azure Active Directory Multi-Factor Authentication to help secure your users.</li> <li>Integrated with cloud-based self-service password management, including password writeback to on-premises Active Directory and password protection by banning commonly used passwords.</li> <li>Multi-forest environments are supported if there are forest trusts between your AD forests and if name suffix routing is correctly configured.</li> <li>PTA is a free feature, and you don't need any paid editions of Azure AD to use it.</li> <li>PTA can be enabled via Azure AD Connect.</li> <li>PTA uses a lightweight on-premises agent that listens for and responds to password validation requests.</li> <li>Installing multiple agents provides high availability of sign-in requests.</li> <li>PTA protects your on-premises accounts against brute force password attacks in the cloud.</li> </ul> <pre><code>Important\n\nThis feature can be configured without using a federation service so that any organization, regardless of size, can implement a hybrid identity solution. Pass-through authentication is not only for user sign-in but allows an organization to use other Azure AD features, such as password management, role-based access control, published applications, and conditional access policies.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#deploy-federation-with-azure-ad","title":"Deploy Federation with Azure AD","text":"<p>Federation is a collection of domains that have established trust. The level of trust may vary, but typically includes authentication and almost always includes authorization. A typical federation might include a number of organizations that have established trust for shared access to a set of resources.</p> <p></p> <p>You can federate your on-premises environment with Azure AD and use this federation for authentication and authorization. This sign-in method ensures that all user authentication occurs on-premises. This method allows administrators to implement more rigorous levels of access control.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-the-authentication-decision-tree","title":"Explore the authentication decision tree","text":"<p>Choosing the correct authentication method is the first concern for organizations wanting to move their apps to the cloud. Don't take this decision lightly, for the following reasons:    - It's the first decision for an organization that wants to move to the cloud.    - The authentication method is a critical component of an organization\u2019s presence in the cloud. It controls access to all cloud data and resources.    - It's the foundation of all the other advanced security and user experience features in Azure AD.</p> <p>Identity is the new control plane of IT security, so authentication is an organization\u2019s access guard to the new cloud world. Organizations need an identity control plane that strengthens their security and keeps their cloud apps safe from intruders.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#authentication-methods_1","title":"Authentication methods","text":"<p>Cloud Authentication - When you choose this authentication method, Azure AD handles users' sign-in process. Coupled with seamless single sign-on (SSO), users can sign in to cloud apps without having to reenter their credentials. With cloud authentication, you can choose from two options:</p> <pre><code>- Azure AD password hash Synchronization\n- Azure AD Pass-through Authentication\n</code></pre> <p>Federated Authentication - When you choose this authentication method, Azure AD hands off the authentication process to a separate trusted authentication system, such as on-premises Active Directory Federation Services (AD FS), to validate the user\u2019s password. The authentication system can provide additional advanced authentication requirements. Examples are smartcard-based authentication or third-party multifactor authentication.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#decision-tree","title":"Decision tree","text":"<p>Details on decision questions:</p> <ol> <li>Azure AD can handle sign-in for users without relying on on-premises components to verify passwords.</li> <li>Azure AD can hand off user sign-in to a trusted authentication provider such as Microsoft\u2019s AD FS.</li> <li>If you need to apply user-level Active Directory security policies such as account expired, disabled account, password expired, account locked out, and sign-in hours on each user sign-in, Azure AD requires some on-premises components.</li> <li>Sign-in features not natively supported by Azure AD:<ul> <li>Sign-in using on-premises MFA Server.</li> <li>Sign-in using third-party authentication solution.</li> <li>Multi-site on-premises authentication solution.</li> <li>Azure AD Identity Protection requires Password Hash Sync, regardless of which sign-in method you choose, to provide the Users with leaked credentials report. Organizations can fail over to Password Hash Sync if their primary sign-in method fails and it was configured before the failure event.</li> </ul> </li> </ol> <pre><code>Important\n\nThis decision tree is intended as a starting point to understand your options, but there can be others or even combinations of different options. For example, you can use Azure AD B2C and configure it to allow user sign-in for multi-tenant Azure AD tenants - with or without the traditional support for self-service sign-up and social identity providers.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-password-writeback","title":"Configure password writeback","text":"<p>Having a cloud-based password reset utility is great but most companies still have an on-premises directory where their users exist. How does Microsoft support keeping traditional on-premises Active Directory Domain Services (AD DS) in sync with password changes in the cloud?</p> <p>Password writeback is a feature enabled with Azure AD Connect that allows password changes in the cloud to be written back to an existing on-premises directory in real time.</p> <p></p> <p>Password writeback provides:</p> <ul> <li>Enforcement of on-premises Active Directory Domain Services password policies. When a user resets their password, it is checked to ensure it meets your on-premises Active Directory Domain Services policy before committing it to that directory. This review includes checking the history, complexity, age, password filters, and any other password restrictions that you have defined in local Active Directory Domain Services.</li> <li>Zero-delay feedback. Password writeback is a synchronous operation. Your users are notified immediately if their password did not meet the policy or could not be reset or changed for any reason.</li> <li>Supports password changes from the access panel and Microsoft 365. When federated or password hash synchronized users come to change their expired or non-expired passwords, those passwords are written back to your local Active Directory Domain Services environment.</li> <li>Supports password writeback when an admin resets them from the Azure portal. Whenever an admin resets a user\u2019s password in the Azure portal, if that user is federated or password hash synchronized, the password is written back to on-premises. This functionality is currently not supported in the Office admin portal.</li> <li>Doesn\u2019t require any inbound firewall rules. Password writeback uses an Azure Service Bus relay as an underlying communication channel. All communication is outbound over port 443.</li> </ul> <pre><code>Important\n\nTo use self-service password reset (SSPR) you must have already configured Azure AD Connect in your environment.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#knowledge-check","title":"Knowledge check","text":"<p>Choose the best response for each of the questions below. Then select Check your answers.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#check-your-knowledge","title":"Check your knowledge","text":"<ol> <li>The IT helpdesk wants to reduce password reset support tickets. You suggest having users sign-in to both on-premises and cloud-based applications using the same password. Your organization does not plan on using Azure AD Identity Protection, so which feature would be easiest to implement given the requirements?<ul> <li>Federation </li> <li>Pass-through authentication</li> <li>Password hash synchronization (Ans)</li> </ul> </li> <li>Which tool can you use to synchronize Azure AD passwords with on-premises Active Directory?<ul> <li>Azure AD Connect (Ans)</li> <li>Active Directory Federation Services</li> <li>Password writeback</li> </ul> </li> <li>Azure AD supports which of the following security protocols?<ul> <li>Kerberos</li> <li>OAuth (Ans)</li> <li>OpenID Connect</li> </ul> </li> <li>Which of the following is an authentication option that integrates with Azure Active Directory, requiring you to use several differing methods, like your phone, to confirm your identity?<ul> <li>FIDO2 security keys</li> <li>Microsoft Authenticator app</li> <li>Azure Active Directory Multi-Factor Authentication (Ans)</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#deploy-azure-ad-identity-protection","title":"Deploy Azure AD identity protection","text":"<p>Protect identities in Azure AD using Conditional Access, MFA, access reviews, and other capabilities.</p> <ul> <li>Deploy and configure Identity Protection</li> <li>Configure MFA for users, groups, and applications</li> <li>Create Conditional Access policies to ensure your security</li> <li>Create and follow an access review process</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#introduction_2","title":"Introduction","text":"<p>Identity Protection is a tool that allows organizations to automate the detection and remediation of identity-based risks, investigate risks using data in the portal, and export risk detection data to third-party utilities for further analysis.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#scenario_2","title":"Scenario","text":"<p>A security engineer uses Azure AD Identity Protection to configure Azure features that monitor and protect identities in the tenant; you will work on such tasks as:</p> <ul> <li>Creating access reviews to check on how each identity is being used and that the correct rights are assigned.</li> <li>Configure policies to identify risky user behaviors and odd sign-in patterns.</li> <li>Control and manage access to resources with conditional access policies.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#skills-measured_2","title":"Skills measured","text":"<p>Exam AZ-500: Microsoft Azure Security Engineer</p> <p>Manage identity and access (30-35%) - Configure secure access by using Azure and    - Configure Access Reviews    - Implement Conditional Access policies, including multi-factor authentication    - Configure Azure AD identity protection</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#learning-objectives_2","title":"Learning objectives","text":"<ul> <li>Deploy and configure Identity Protection</li> <li>Configure multi-factor authentication for users, groups, and applications</li> <li>Create Conditional Access policies to ensure your security</li> <li>Create and follow an access review process</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-azure-ad-identity-protection","title":"Explore Azure AD identity protection","text":"<p>Identity Protection is a tool that allows organizations to accomplish three key tasks:</p> <ul> <li>Automate the detection and remediation of identity-based risks.</li> <li>Investigate risks using data in the portal.</li> <li>Export risk detection data to third-party utilities for further analysis.</li> </ul> <p>Identity Protection uses the learnings Microsoft has acquired from their position in organizations with Azure AD, the consumer space with Microsoft Accounts, and in gaming with Xbox to protect your users. Microsoft analyzes 6.5 trillion signals per day to identify and protect customers from threats.</p> <p>Risk detections in Azure AD Identity Protection include any identified suspicious actions related to user accounts in the directory. The signals generated that are fed to Identity Protection, can be further fed into tools like Conditional Access to make access decisions, or fed back to a security information and event management (SIEM) tool for further investigation based on your organization's enforced policies.</p> <p>Identity Protection provides organizations access to powerful resources so they can quickly respond to suspicious activities.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#identity-protection-policies","title":"Identity Protection policies","text":"<p>Azure Active Directory Identity Protection includes three default policies that administrators can choose to enable. These policies include limited customization but are applicable to most organizations. All the policies allow for excluding users such as your emergency access or break-glass administrator accounts.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-multi-factor-authentication-registration-policy","title":"Azure Multi-Factor Authentication registration policy","text":"<p>Identity Protection can help organizations roll out Azure Multi-Factor Authentication using a Conditional Access policy requiring registration at sign-in. Enabling this policy is a great way to ensure new users in your organization have registered for MFA on their first day. Multi-factor authentication is one of the self-remediation methods for risk events within Identity Protection. Self-remediation allows your users to act on their own to reduce helpdesk call volume.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#sign-in-risk-policy","title":"Sign-in risk policy","text":"<p>Identity Protection analyzes signals from each sign-in, both real-time and offline, and calculates a risk score based on the probability that the sign-in wasn't performed by the user. Administrators can decide based on this risk score signal to enforce organizational requirements. Administrators can choose to block access, allow access, or allow access but require multi-factor authentication.</p> <p>If risk is detected, users can perform multi-factor authentication to self-remediate and close the risky sign-in event to prevent unnecessary noise for administrators.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#custom-conditional-access-policy","title":"Custom Conditional Access policy","text":"<p>Administrators can also choose to create a custom Conditional Access policy, including sign-in risk as an assignment condition.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-risk-event-detections","title":"Configure risk event detections","text":"<p>To protect your users, you can configure risk-based policies in Azure Active Directory (Azure AD) that automatically respond to risky behaviors. Azure AD Identity Protection policies can automatically block a sign-in attempt or require additional action, such as requiring a password change or prompt for Azure AD Multi-Factor Authentication. These policies work with existing Azure AD Conditional Access policies as an extra layer of protection for your organization. Users may never trigger a risky behavior in one of these policies, but your organization is protected if an attempt to compromise your security is made.</p> <p>Each day, Microsoft collects and analyses trillions of anonymized signals as part of user sign-in attempts. These signals help build patterns of good user sign-in behavior and identify potential risky sign-in attempts. Azure AD Identity Protection can review user sign-in attempts and take additional action if there's suspicious behavior:</p> <p>Some of the following actions may trigger Azure AD Identity Protection risk detection:    - Users with leaked credentials.    - Sign-ins from anonymous IP addresses.    - Impossible travel to atypical locations.    - Sign-ins from infected devices.    - Sign-ins from IP addresses with suspicious activity.</p> <p>The following three policies are available in Azure AD Identity Protection to protect users and respond to suspicious activity. You can choose to turn the policy enforcement on or off, select users or groups for the policy to apply to, and decide if you want to block access at sign-in or prompt for additional action.</p> <p>The insight you get for a detected risk detection is tied to your Azure AD subscription.</p> <ul> <li>User risk policy - Identifies and responds to user accounts that may have compromised credentials. Can prompt the user to create a new password.</li> <li>Sign-in risk policy - Identifies and responds to suspicious sign-in attempts. Can prompt the user to provide additional forms of verification using Azure AD Multi-Factor Authentication.</li> <li>MFA registration policy - Makes sure users are registered for Azure AD Multi-Factor Authentication. If a sign-in risk policy prompts for MFA, the user must already be registered for Azure AD Multi-Factor Authentication.</li> </ul> <p>When you enable a policy user or sign-in risk policy, you can also choose the threshold for risk level - low and above, medium and above, or high. This flexibility lets you decide how aggressive you want to be in enforcing any controls for suspicious sign-in events.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-user-risk-policy","title":"Implement user risk policy","text":"<p>Identity Protection can calculate what it believes is normal for a user's behavior and use that to base decisions for their risk. User risk is a calculation of probability that an identity has been compromised. Administrators can decide based on this risk score signal to enforce organizational requirements. Administrators can choose to block access, allow access, or allow access but require a password change using Azure AD self-service password reset.</p> <p></p> <p>The above image shows the configuration of User Risk Policy applied</p> <ul> <li>To user sign-ins</li> <li>Automatically respond based on a specific user\u2019s risk level</li> <li>Provide the condition (risk level) and action (block or allow)</li> <li>Use a high threshold during policy roll out</li> <li>Use a low threshold for greater security</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#risky-users","title":"Risky users","text":"<p>With the information provided by the risky users report, administrators can find:</p> <ul> <li>Which users are at risk, have had risk remediated, or have had risk dismissed?</li> <li>Details about detections</li> <li>History of all risky sign-ins</li> <li>Risk history</li> </ul> <p>Administrators can then choose to act on these events. Administrators can choose to:</p> <ul> <li>Reset the user password</li> <li>Confirm user compromise</li> <li>Dismiss user risk</li> <li>Block user from signing in</li> <li>Investigate further using Azure ATP</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-sign-in-risk-policy","title":"Implement sign-in risk policy","text":"<p>Sign-in risk represents the probability that a given authentication request isn't authorized by the identity owner. For users of Azure Identity Protection, sign-in risk can be evaluated as part of a Conditional Access policy. Sign-in Risk Policy supports the following conditions:</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#location","title":"Location","text":"<p>When configuring location as a condition, organizations can choose to include or exclude locations. These named locations may include the public IPv4 network information, country or region, or even unknown areas that don't map to specific countries or regions. Only IP ranges can be marked as a trusted location. When including any location, this option includes any IP address on the internet not just configured named locations. When selecting any location, administrators can choose to exclude all trusted or selected locations.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#client-apps","title":"Client apps","text":"<p>Conditional Access policies by default apply to browser-based applications and applications that utilize modern authentication protocols. In addition to these applications, administrators can choose to include Exchange ActiveSync clients and other clients that utilize legacy protocols.</p> <ul> <li>Browser - These include web-based applications that use protocols like SAML, WS-Federation, OpenID Connect, or services registered as an OAuth confidential client.</li> <li>Mobile apps and desktop clients - These access policies are commonly used when requiring a managed device, blocking legacy authentication, and blocking web applications but allowing mobile or desktop app.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#risky-sign-ins","title":"Risky sign-ins","text":"<p>The risky sign-ins report contains filterable data for up to the past 30 days (1 month).</p> <p>With the information provided by the risky sign-ins report, administrators can find:</p> <ul> <li>Which sign-ins are classified as at risk, confirmed compromised, confirmed safe, dismissed, or remediated.</li> <li>Real-time and aggregate risk levels associated with sign-in attempts.</li> <li>Detection types triggered</li> <li>Conditional Access policies applied</li> <li>MFA details</li> <li>Device information</li> <li>Application information</li> <li>Location information</li> </ul> <p>Administrators can then choose to take action on these events. Administrators can choose to:</p> <ul> <li>Confirm sign-in compromise</li> <li>Confirm sign-in safe</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#deploy-multifactor-authentication-in-azure","title":"Deploy multifactor authentication in Azure","text":"<p>Azure Active Directory Multi-Factor Authentication helps safeguard access to data and applications while maintaining simplicity for users. It provides additional security by requiring a second form of authentication and delivers strong authentication through a range of easy to use authentication methods.</p> <p>For organizations that need to be compliant with industry standards, such as the Payment Card Industry (PCI) Data Security Standard (DSS) version 3.2, MFA is a must have capability to authenticate users. Beyond being compliant with industry standards, enforcing MFA to authenticate users can also help organizations to mitigate credential theft attacks.</p> <p></p> <p>The security of MFA two-step verification lies in its layered approach. Compromising multiple authentication factors presents a significant challenge for attackers. Even if an attacker manages to learn the user's password, it is useless without also having possession of the additional authentication method. Authentication methods include:</p> <ul> <li>Something you know (typically a password)</li> <li>Something you have (a trusted device that is not easily duplicated, like a phone)</li> <li>Something you are (biometrics)</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#multi-factor-authentication-features","title":"Multi-Factor Authentication Features","text":"<ul> <li>Get more security with less complexity. Azure MFA helps safeguard access to data and applications and helps to meet customer demand for a simple sign-in process. Get strong authentication with a range of easy verification options\u2014phone call, text message, or mobile app notification\u2014and allow customers to choose the method they prefer.</li> <li>Mitigate threats with real-time monitoring and alerts. MFA helps protect your business with security monitoring and machine-learning-based reports that identify inconsistent sign-in patterns. To help mitigate potential threats, real-time alerts notify your IT department of suspicious account credentials.</li> <li>Use with Microsoft 365, Salesforce, and more. MFA for Microsoft 365 helps secure access to Microsoft 365 applications at no additional cost. Multifactor authentication is also available with Azure Active Directory Premium and thousands of software-as-a-service (SaaS) applications, including Salesforce, Dropbox, and other popular services.</li> <li>Add protection for Azure administrator accounts. MFA adds a layer of security to your Azure administrator account at no additional cost. When it's turned on, you need to confirm your identity to create a virtual machine, manage storage, or use other Azure services.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#multi-factor-authentication-options","title":"Multi-Factor Authentication Options","text":"Method Description Call to phone Places an automated voice call. The user answers the call and presses # in the phone keypad to authenticate. The phone number is not synchronized to on-premises Active Directory. A voice call to phone is important because it persists through a phone handset upgrade, allowing the user to register the mobile app on the new device. Text message to phone Sends a text message that contains a verification code. The user is prompted to enter the verification code into the sign-in interface. This process is called one-way SMS. Two-way SMS means that the user must text back a particular code. Two-way SMS is deprecated and not supported after November 14, 2018. Users who are configured for two-way SMS are automatically switched to call to phone verification at that time. Notification through mobile app Sends a push notification to your phone or registered device. The user views the notification and selects Approve to complete verification. The Microsoft Authenticator app is available for Windows Phone, Android, and iOS. Push notifications through the mobile app provide the best user experience. Verification code from mobile app The Microsoft Authenticator app generates a new OATH verification code every 30 seconds. The user enters the verification code into the sign-in interface. The Microsoft Authenticator app is available for Windows Phone, Android, and iOS. Verification code from mobile app can be used when the phone has no data connection or cellular signal."},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-multifactor-authentication-settings","title":"Explore multifactor authentication settings","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#account-lockout","title":"Account lockout","text":"<p>To prevent repeated MFA attempts as part of an attack, the account lockout settings let you specify how many failed attempts to allow before the account becomes locked out for a period of time. The account lockout settings are only applied when a pin code is entered for the MFA prompt. The following settings are available:</p> <ul> <li>Number of MFA denials to trigger account lockout</li> <li>Minutes until account lockout counter is reset</li> <li>Minutes until account is automatically unblocked</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#block-and-unblock-users","title":"Block and unblock users","text":"<p>If a user's device has been lost or stolen, you can block authentication attempts for the associated account.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#notifications","title":"Notifications","text":"<p>Email notifications can be configured when users report fraud alerts. These notifications are typically sent to identity administrators, as the user's account credentials are likely compromised.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#oath-tokens","title":"OATH tokens","text":"<p>Azure AD supports the use of OATH-TOTP SHA-1 tokens that refresh codes every 30 or 60 seconds. Customers can purchase these tokens from the vendor of their choice.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#trusted-ips","title":"Trusted IPs","text":"<p>Trusted IPs is a feature to allow federated users or IP address ranges to bypass two-step authentication. Notice there are two selections in this screenshot.</p> <p>Which selections you can make depends on whether you have managed or federated tenants.</p> <ul> <li>Managed tenants. For managed tenants, you can specify IP ranges that can skip MFA.</li> <li>Federated tenants. For federated tenants, you can specify IP ranges and you can also exempt AD FS claims users.</li> </ul> <pre><code>Important\n\nThe Trusted IPs bypass works only from inside of the company intranet. If you select the All Federated Users option and a user signs in from outside the company intranet, the user must authenticate by using two-step verification. The process is the same even if the user presents an AD FS claim.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#enable-multifactor-authentication","title":"Enable multifactor authentication","text":"<p>To enable MFA, go to the User Properties in Azure Active Directory, and then the Multi-Factor Authentication option. From there, you can select the users that you want to modify and enable for MFA. You can also bulk enable groups of users with PowerShell. User's states can be Enabled, Enforced, or Disabled.</p> <p></p> <pre><code>Note\n\nOn first-time sign-in, after MFA has been enabled, users are prompted to configure their MFA settings. For example, if you enable MFA so that users must use a mobile device, users will be prompted to configure their mobile device for MFA. Users must complete those steps, or they will not be permitted to sign in, which they cannot do until they have validated that their mobile device is MFA-compliant.\n</code></pre> <p>All users start out Disabled. When you enroll users in per-user Azure AD Multi-Factor Authentication, their state changes to Enabled. When enabled users sign in and complete the registration process, their state changes to Enforced. Administrators may move users between states, including from Enforced to Enabled or Disabled.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#enable-mfa-for-global-admins","title":"Enable MFA for Global Admins","text":"<p>Azure AD Multi-Factor Authentication is included free of charge for global administrator security. Enabling MFA for global administrators provides an added level of security when managing and creating Azure resources like virtual machines, managing storage, or using other Azure services. Secondary authentication includes phone call, text message, and the authenticator app.</p> <pre><code>Important\n\nRemember, you can only enable MFA for organizational accounts stored in Azure Active Directory. These are also called work or school accounts.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-azure-ad-conditional-access","title":"Implement Azure AD conditional access","text":"<p>The old world of security behind a corporate firewall, having your secure network perimeter just doesn\u2019t work anymore, not with people wanting to work from anywhere, being able to connect to all sorts of cloud applications.</p> <p>Conditional Access is the tool used by Azure Active Directory to bring signals together, to make decisions, and enforce organizational policies.</p> <p>Conditional Access is at the heart of the new identity driven control plane.</p> <p>Conditional access policy is really a next generation policy that\u2019s built for the cloud. It\u2019s able to consider massive amounts of data, as well as contextual data from a user sign-in flow and make sure that the right controls are enforced.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#identity-as-a-servicethe-new-control-plane","title":"Identity as a Service\u2014the new control plane","text":"<p>What is the basis for saying that identity management is the new control plane? First, what is the control plane? In a switch or router, the control plane is the part that controls where the traffic is to go, but it\u2019s not responsible for the movement of the traffic. The control plane learns the routes, either static or dynamic. The part responsible for moving the traffic is the forwarding plane. The following figure depicts a simple switch diagram.</p> <p></p> <p>A user\u2019s identity is like a control plane, because it controls which protocols the user will interact with, which organizational programs the user can access, and which devices the user can employ to access those programs. Identity is what helps protect user and corporate data. For example, should that data be encrypted, deleted, or ignored when an issue occurs?</p> <p>Now, everything pivots around that user identity. You know what their activities are, and where they are located. You know what devices they\u2019re using. Then we leverage that information in conditional access policy to be able to enforce things like multifactor authentication or require a compliant device.</p> <p>There are the conditions, which indicate when the policy is going to apply. This can be, again, the location, type of application that you\u2019re on, any detected risk. How is the risk determined? It is determined from all the analysis and intel that we have across organizations using Azure Active Directory, as well as Microsoft consumer identity offerings. Conditional Access is the tool used by Azure Active Directory to bring signals together, to make decisions, and enforce organizational policies. Conditional Access policies at their simplest are if-then statements, if a user wants to access a resource, then they must complete an action. Example: A payroll manager wants to access the payroll application and is required to perform multifactor authentication to access it.</p> <p>Administrators are faced with two primary goals:</p> <ul> <li>Empower users to be productive wherever and whenever</li> <li>Protect the organization's assets</li> </ul> <p>By using Conditional Access policies, you can apply the right access controls when needed to keep your organization secure and stay out of your user\u2019s way when not needed.</p> <p></p> <p>Conditional Access policies are enforced after the first-factor authentication has been completed. Conditional Access is not intended as an organization's first line of defense for scenarios like denial-of-service (DoS) attacks but can use signals from these events to determine access.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-conditional-access-conditions","title":"Configure conditional access conditions","text":"<p>Conditional access is a capability of Azure AD (with an Azure AD Premium license) that enables you to enforce controls on the access to apps in your environment based on specific conditions from a central location. With Azure AD conditional access, you can factor how a resource is being accessed into an access control decision. By using conditional access policies, you can apply the correct access controls under the required conditions.</p> <p>Conditional access comes with six conditions: user/group, cloud application, device state, location (IP range), client application, and sign-in risk. You can use combinations of these conditions to get the exact conditional access policy you need. Notice on this image the conditions determine the access control from the previous topic.</p> <p></p> <p>With access controls, you can either Block Access altogether or Grant Access with more requirements by selecting the desired controls. You can have several options:</p> <ul> <li>Require MFA from Azure AD or an on-premises MFA (combined with AD FS).</li> <li>Grant access to only trusted devices.</li> <li>Require a domain-joined device.</li> <li>Require mobile devices to use Intune app protection policies.</li> </ul> <p>Requiring more account verification through MFA is a common conditional access scenario. While users may be able to sign in to most of your organization\u2019s cloud apps, you may want more verification for things like your email system, or apps that contain personnel records or sensitive information. In Azure AD, you can accomplish this with a conditional access policy</p> <pre><code>Important\n\nThe Users and Groups condition is mandatory in a conditional access policy. In your policy, you can either select All users or select specific users and groups.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-access-reviews","title":"Implement access reviews","text":"<p>Azure Active Directory (Azure AD) access reviews enable organizations to efficiently manage group memberships, access to enterprise applications, and role assignments. User's access can be reviewed on a regular basis to make sure only the right people have continued access.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#why-are-access-reviews-important","title":"Why are access reviews important?","text":"<p>Azure AD enables you to collaborate internally within your organization and with users from external organizations, such as partners. Users can join groups, invite guests, connect to cloud apps, and work remotely from their work or personal devices. The convenience of leveraging the power of self-service has led to a need for better access management capabilities.</p> <ul> <li>As new employees join, how do you ensure they have the right access to be productive?</li> <li>As people move teams or leave the company, how do you ensure their old access is removed, especially when it involves guests?</li> <li>Excessive access rights can lead to audit findings and compromises as they indicate a lack of control over access.</li> <li>You must proactively engage with resource owners to ensure they regularly review who has access to their resources.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#use-access-reviews-in-the-following-cases","title":"Use access reviews in the following cases","text":"<ul> <li>Too many users in privileged roles: It's a good idea to check how many users have administrative access, how many of them are Global Administrators, and if there are any invited guests or partners that have not been removed after being assigned to do an administrative task. You can recertify the role assignment users in Azure AD roles such as Global Administrators, or Azure resources roles such as User Access Administrator in the Azure AD Privileged Identity Management (PIM) experience.</li> <li>When automation is infeasible: You can create rules for dynamic membership on security groups or Microsoft 365 Groups, but what if the HR data is not in Azure AD or if users still need access after leaving the group to train their replacement? You can then create a review on that group to ensure those who still need access should have continued access.</li> <li>When a group is used for a new purpose: If you have a group that is going to be synced to Azure AD, or if you plan to enable a sales management application for everyone in the Sales team group, it would be useful to ask the group owner to review the group membership prior to the group being used in a different risk content.</li> <li>Business critical data access: for certain resources, it might be required to ask people outside of IT to regularly sign out and give a justification on why they need access for auditing purposes.</li> <li>To maintain a policy's exception list: In an ideal world, all users would follow the access policies to secure access to your organization's resources. However, sometimes there are business cases that require you to make exceptions. As the IT admin, you can manage this task, avoid oversight of policy exceptions, and provide auditors with proof that these exceptions are reviewed regularly.</li> <li>Ask group owners to confirm they still need guests in their groups: Employee access might be automated with some on premises IAM, but not invited guests. If a group gives guests access to business sensitive content, then it's the group owner's responsibility to confirm the guests still have a legitimate business need for access.</li> <li>Have reviews recur periodically: You can set up recurring access reviews of users at set frequencies such as weekly, monthly, quarterly or annually, and the reviewers will be notified at the start of each review. Reviewers can approve or deny access with a friendly interface and with the help of smart recommendations.</li> </ul> <p>Depending on what you want to review, you will create your access review in Azure AD access reviews, Azure AD enterprise apps (in preview), or Azure AD PIM. Using this feature requires an Azure AD Premium P2 license.</p> <pre><code>Important\n\nAzure AD Premium P2 licenses are not required for users with the Global Administrator or User Administrator roles that set up access reviews, configure settings, or apply the decisions from the reviews.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-try-this-exercises_1","title":"Explore try-this exercises","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-1-configure-conditional-access-require-mfa","title":"Task 1 - Configure conditional access (require MFA)","text":"<pre><code>Note\n\nThis task requires a user account, AZ500User1. If you want to show the MFA verification, the user account must have a phone number.\n</code></pre> <p>This task will review conditional access policy settings and create a policy that requires MFA when signing in to the Portal.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-the-policy","title":"Configure the policy","text":"<ol> <li>In the Portal, search for and select Azure Active Directory.</li> <li>Under Manage, select Security.</li> <li>Under Protect, select Conditional access.</li> <li> <p>Click New Policy.</p> <ul> <li>Name: AZ500Policy1</li> <li>Users and groups &gt; Select users and groups &gt; Users and Groups &gt; Select: AZ500User1</li> <li>Cloud apps or actions &gt; Select apps &gt; Select: Microsoft Azure Management</li> <li>Review the warning that this policy impacts Portal access.</li> <li>Conditions &gt; Sign-in risk &gt; Review the risk levels</li> <li>Device platforms &gt; Review the devices that can be included, such as Android and iOS.</li> <li>Locations &gt; Review the physical location selections.</li> <li>Under Access controls click Grant.</li> <li>Review the Grant options such as MFA. You may require one or more of the controls.</li> <li>Select Require multi-factor authentication.</li> <li> <p>For Enable policy, select On.</p> </li> <li> <p>Click Create.</p> </li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#test-the-policy","title":"Test the policy","text":"<ol> <li>Sign in to the Portal as the AZ500User1.</li> <li>Before you can sign in, a second authentication is required.</li> <li>If you have a phone number associated with the user, provide and verify the text code. You should be able to sign in to the Portal successfully.</li> <li>If you do not have a phone number associated with the user, this demonstrates that MFA is in effect.</li> <li>You may want to return to the AZ500Policy1 and turn the policy Off.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-2-access-review","title":"Task 2 - Access review","text":"<p>In this task, we will configure an access review.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-an-access-review","title":"Configure an access review","text":"<ol> <li>In the Portal, search for and select Identity Governance.</li> <li>Under Access Reviews, select Access Reviews.</li> <li>Click New Access Review.</li> <li>We will create an access review to ensure we validate the AZ500Admin group membership.</li> <li> <p>Complete the required information and discuss each setting. Configuration settings are added as you make your selections. For example, if you select a weekly access review, you will be prompted for the duration.</p> <ul> <li>Review name: AZ500Review</li> <li>Start date: current date</li> <li>Frequency: One-time</li> <li>Users to review: Members of a group</li> <li>Scope: Everyone</li> <li>Select a group: AZ500Admins</li> <li>Reviewers: Selected user</li> <li>Select reviewers: add yourself as a reviewer</li> <li>Review the Upon completion settings, specifically the action if a reviewer doesn't respond.</li> <li> <p>Review Advanced settings.</p> </li> <li> <p>Start the access review.</p> </li> <li>On the Access review page, ensure the new access review is listed.</li> <li>The Status will change from Not started to Initializing.</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#conduct-an-access-review","title":"Conduct an access review","text":"<p>In this task, we will conduct an access review.</p> <ol> <li>When the access review is complete, you will receive an email. This is the email associated with your reviewer account.</li> <li>View the email and discuss the review instructions. Note when the review period will end.</li> <li>In the email, click Start review.</li> <li>On the Access reviews page, click the AZ500Review.</li> <li>Notice you are reviewing the AZ500Admin group members. There are two members.</li> <li>Use the Details link to view information about the user.</li> <li>Select Approve for one user and Deny for the other. Be sure to provide a Reason.</li> <li>Submit your reviews.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#review-the-access-review-results","title":"Review the access review results","text":"<p>In this task, we will review the access review results.</p> <ol> <li>Return to the Portal.</li> <li>Click the AZ500Review.</li> <li>From the Overview blade, review the results.</li> <li>There should be one member approved and one member denied.</li> <li>Click Results for more detailed information about the reviewer and their reasons.</li> <li>From the Overview blade, click Stop and confirm you want to stop the review.</li> <li>The Review status should now be Complete.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#apply-the-access-review","title":"Apply the access review","text":"<p>In this task, we will apply the review results.</p> <ol> <li>In the Portal, search for and select Azure Active Directory.</li> <li>Under Manage, select Groups.</li> <li>Locate the AZ500Admins group.</li> <li>Review the members of the group.-</li> <li>Confirm there are two members.</li> <li>Return to the AZ500Review.</li> <li>Click Apply.</li> <li>Confirm that you want to remove the denied member.</li> <li>The Review status will change from Applying to Result applied.</li> <li>Verify the AZ500Admins group now only has one member.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#knowledge-check_1","title":"Knowledge check","text":"<p>Choose the best response for each of the questions below. Then select Check your answers.</p> <ol> <li> <p>The compliance auditors want to ensure as employees change jobs or leave the company that their privileges are also changed or revoked. They are especially concerned about the Administrator group. To address their concerns. you implement which of the following?</p> </li> <li> <p>Access reviews (Ans)</p> </li> <li>Azure time-based policies</li> <li> <p>JIT virtual machine access</p> </li> <li> <p>Identity Protection has reported that a user\u2019s credentials have been leaked. According to policy, the user\u2019s password must be reset. Which Azure AD role can reset the password?</p> <ul> <li>Global Administrator (Ans)</li> <li>Security Administrator</li> <li>Security Operator</li> </ul> </li> <li> <p>Identity Protection identifies risks in which of the following classifications?</p> <ul> <li>Specific IP address</li> <li>Atypical travel (Ans)</li> <li>Unregistered device</li> </ul> </li> <li> <p>You have implemented Identity Protection and are reviewing the Risky users report. For each reported event you can choose any of the following actions?</p> <ul> <li>Confirm user compromise (Ans)</li> <li>Delete the risk event</li> <li>Dismiss user account</li> </ul> </li> <li> <p>Conditional Access can be used to enable which of the actions listed below?</p> <ul> <li>Block or grant access from specific time of day.</li> <li>Designate privileged user accounts.</li> <li>Require multifactor authentication. (Ans)</li> </ul> </li> <li> <p>Which licensing plan supports Identity Protection?</p> <ul> <li>Azure Active Directory Free</li> <li>Azure Active Directory Premium P1</li> <li>Azure Active Directory Premium P2 (Ans)</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-azure-ad-privileged-identity-management","title":"Configure Azure AD privileged identity management","text":"<p>Ensure that your privileged identities have extra protection and are accessed only with the least amount of access needed to do the job.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#introduction_3","title":"Introduction","text":"<p>Azure AD Privileged Identity Management (PIM) allows you to manage, control, and monitor access to the most important resources in your organization. You can give just-in-time access and just-enough-access to users to allow them to do their tasks.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#scenario_3","title":"Scenario","text":"<p>A security engineer uses Privileged Identity Management to protect administrator privileges and mitigate the risk of excessive or misused access rights; some common tasks are:</p> <ul> <li>Configuring the scope of users and roles based on zero trust.</li> <li>Setting up a PIM workflow to enforce approval for role usage, and monitor the access.</li> <li>Implement just-in-time access.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-the-zero-trust-model","title":"Explore the zero trust model","text":"<p>Cloud-based services and mobile computing have changed the technology landscape for the modern enterprise. Today\u2019s workforce often requires access to applications and resources outside traditional corporate network boundaries, rendering security architectures that rely on firewalls and virtual private networks (VPNs) insufficient. Changes brought about by cloud migration and a more mobile workforce has led to the development of an access architecture called Zero Trust.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#the-zero-trust-model","title":"The Zero Trust model","text":"<p>Based on the principle of \u201cnever trust, always verify,\u201d Zero Trust helps secure corporate resources by eliminating unknown and unmanaged devices and limiting lateral movement. Implementing a true Zero Trust model requires that all components\u2014user identity, device, network, and applications\u2014be validated and proven trustworthy. Zero Trust verifies identity and device health prior to granting access to corporate resources. When access is granted, applying the principle of least privilege limits user access to only those resources that are explicitly authorized for each user, thus reducing the risk of lateral movement within the environment. In an ideal Zero Trust environment, the following four elements are necessary:</p> <ul> <li>Strong identity authentication everywhere (user verification via authentication)</li> <li>Devices are enrolled in device management, and their health is validated</li> <li>Least-privilege user rights (access is limited to only what is needed)</li> <li>The health of services is verified (future goal)</li> </ul> <p>For Microsoft, Zero Trust establishes a strict boundary around corporate and customer data. For end users, Zero Trust delivers a simplified user experience that allows them to easily manage and find their content. And for customers, Zero Trust creates a unified access platform that they can use to enhance the overall security of their entire ecosystem.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#zero-trust-architecture","title":"Zero Trust architecture","text":"<p>A Zero Trust approach extends throughout the entire digital estate and serves as an integrated security philosophy and end-to-end strategy.</p> <p>The illustration below provides a representation of the primary elements that contribute to Zero Trust.</p> <p></p> <p>In the illustration above:</p> <p>Security policy enforcement is at the center of a Zero Trust architecture. This includes Multi-Factor authentication with conditional access that takes into account user account risk, device status, and other criteria and policies that you set.</p> <p>Identities, devices (also called endpoints), data, applications, network, and other infrastructure components are all configured with appropriate security. Policies that are configured for each of these components are coordinated with your overall Zero Trust strategy. For example, device policies determine the criteria for healthy devices and conditional access policies require healthy devices for access to specific apps and data.</p> <p>Threat protection and intelligence monitors the environment, surfaces current risks, and takes automated action to remediate attacks.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#guiding-principles-of-zero-trust","title":"Guiding principles of Zero Trust","text":"<p>Today, organizations need a new security model that effectively adapts to the complexity of the modern environment, embraces the mobile workforce, and protects people, devices, applications, and data wherever they are located.</p> <p>To address this new world of computing, Microsoft highly recommends the Zero Trust security model, which is based on these guiding principles:</p> <ul> <li>Verify explicitly - Always authenticate and authorize based on all available data points.</li> <li>Use least privilege access - Limit user access with Just-In-Time and Just-Enough-Access (JIT/JEA), risk-based adaptive policies, and data protection.</li> <li>Assume breach - Minimize blast radius and segment access. Verify end-to-end encryption and use analytics to get visibility, drive threat detection, and improve defenses.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#microsofts-zero-trust-architecture","title":"Microsoft's Zero Trust architecture","text":"<p>Below is a simplified reference architecture for our approach to implementing Zero Trust. The primary components of this process are Intune for device management and device security policy configuration, Azure AD conditional access for device health validation, and Azure AD for user and device inventory.</p> <p>The system works with Intune, pushing device configuration requirements to the managed devices. The device then generates a statement of health, which is stored in Azure AD. When the device user requests access to a resource, the device health state is verified as part of the authentication exchange with Azure AD.</p> <p></p> <pre><code>Important\n\nThe National Institute of Standards and Technology has a Zero Trust Architecture, NIST 800-207, publication.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#review-the-evolution-of-identity-management","title":"Review the evolution of identity management","text":"<p>Microsoft Identity Manager or MIM helps organizations manage the users, credentials, policies, and access within their organizations and hybrid environments. With MIM, organizations can simplify identity lifecycle management with automated workflows, business rules, and easy integration with heterogenous platforms across the datacenter. MIM enables Active Directory Domain Services to have the right users and access rights for on-premises apps. Azure AD Connect can then make those users and permissions available in Azure AD for Microsoft 365 and cloud-hosted apps.</p> <p>On-premises Active Directory Domain Services, Azure Active Directory (Azure AD), or a hybrid combination of the two all offer services for user and device authentication, identity and role management, and provisioning.</p> <p></p> <p>Identity has become the common factor among many services, like Microsoft 365 and Xbox Live, where the person is the center of the services. Identity is now the security boundary, the new firewall, the control plane\u2014whichever comparison you prefer. Your digital identity is the combination of who you are and what you\u2019re allowed to do. That is:</p> <p>Credentials + privileges = digital identity</p> <p>First step, you need to help protect your privileged accounts.</p> <p>These identities have more than the normal user rights and, if compromised, allow a malicious hacker to access sensitive corporate assets. Helping secure these privileged identities is a critical step to establishing security assurances for business assets in a modern organization. Cybercriminals target these accounts and other privileged services in their kill chain to carry out their objectives.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#evolution-of-identities","title":"Evolution of identities","text":"<p>Identity management approaches have evolved from traditional, to advanced, to optimal.</p> <p>Traditional identity approaches</p> <ul> <li>On-premises identity providers.</li> <li>No single sign-on is present between on-premises and cloud apps.</li> <li>Visibility into identity risk is very limited.</li> </ul> <p>Advanced identity approaches</p> <ul> <li>Conditional access policies gate access and provide remediation actions.</li> <li>Analytics improve visibility into identity risk.</li> </ul> <p>Optimal identity approaches</p> <ul> <li>Passwordless authentication is enabled.</li> <li>User, location, devices, and behavior are analyzed in real time.</li> <li>Continuous protection to identity risk.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#steps-for-a-passwordless-world","title":"Steps for a passwordless world","text":"<ul> <li>Enforce MFA \u2014 Conform to the fast identity online (FIDO) 2.0 standard, so you can require a PIN and a biometric for authentication rather than a password. Windows Hello is one good example, but choose the MFA method that works for your organization.</li> <li>Reduce legacy authentication workflows \u2014 Place apps that require passwords into a separate user access portal and migrate users to modern authentication flows most of the time. At Microsoft only 10 percent of our users enter a password on a given day.</li> <li>Remove passwords \u2014 Create consistency across Active Directory Domain Services and Azure Active Directory (Azure AD) to enable administrators to remove passwords from identity directory.</li> </ul> <pre><code>Important\n\nWe recommend Azure AD Privileged Identity Management as the service to help protect your privileged accounts.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#deploy-azure-ad-privileged-identity-management","title":"Deploy Azure AD privileged identity management","text":"<p>With the Azure AD Privileged Identity Management (PIM) service, you can manage, control, and monitor access to important resources in your organization. This includes access to resources in Azure AD; Azure; and other Microsoft Online Services, like Microsoft 365 and Microsoft Intune. This control does not eliminate the need for users to carry out privileged operations in Azure AD, Azure, Microsoft 365, and Software as a Service (SaaS) apps.</p> <p>Organizations can give users just-in-time (JIT) privileged access to Azure resources and Azure AD. Oversight is needed for what those users do with their administrator privileges. PIM helps mitigate the risk of excessive, unnecessary, or misused access rights.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#key-pim-features","title":"Key PIM features","text":"<ul> <li>Providing just-in-time privileged access to Azure AD and Azure resources. IT administrators can pick an activation period between 0.5 and a role's maximum duration (max is 24 hours). They will only receive the privilege for that period of time. After the activation period admins will have to go through the activation process again.</li> <li>Assigning time-bound access to resources by using start and end dates. PIM allows you to set an end time for the role. This is particularly useful in a guest scenario. If your organization has guests that are working for a specific time the role privilege will expire automatically.</li> <li>Requiring approval to activate privileged roles. You can designate one or more approvers. These approvers will receive an email once a request is made. Approval is required to activate the privilege.</li> <li>Enforcing Azure Multi-Factor Authentication (MFA) to activate any role. If your organization already has MFA enabled, PIM will not ask the user to sign in again.</li> <li>Using justification to understand why users activate. This benefits both internal and external auditors understanding why the role was activated. You can also require a service ticket number from whatever service product you are using.</li> <li>Getting notifications when a user is assigned a privilege and when that privilege is activated.</li> <li>Conducting access reviews to know which users have privileged roles in the organization and if they still need them.</li> <li>Downloading an audit history for an internal or external audit. This keeps tracks of all PIM events.</li> </ul> <p>Ways to use PIM</p> <p>We use Azure AD PIM in the following ways:</p> <ul> <li>View which users are assigned privileged roles to manage Azure resources, as well as which users are assigned administrative roles in Azure AD.</li> <li>Enable on-demand, \u201cjust in time\u201d administrative access to Microsoft Online Services like Microsoft 365 and Intune, and to Azure resources of subscriptions, resource groups, and individual resources such as Virtual Machines.</li> <li>Review a history of administrator activation, including what changes administrators made to Azure resources.</li> <li>Get alerts about changes in administrator assignments.</li> <li>Require approval to activate Azure AD privileged admin roles.</li> <li>Review membership of administrative roles and require users to provide a justification for continued membership.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-privileged-identity-management-scope","title":"Configure privileged identity management scope","text":"<ul> <li>Azure AD roles. These roles are all in Azure Active Directory (such as Global Administrator, Exchange Administrator, and Security Administrator). You can read more about the roles and their functionality in Administrator role permissions in Azure Active Directory.</li> <li>Azure resource roles. These roles are linked to an Azure resource, resource group, subscription, or management group. Privileged Identity Management provides just-in-time access to both built-in roles like Owner, User Access Administrator, and Contributor, as well as custom roles.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-ad-roles","title":"Azure AD roles","text":"<p>Users can be assigned to different administrative roles in Azure AD. These role assignments control which tasks, such as adding or removing users or changing service settings, the users are able to perform on Azure AD, Microsoft 365 and other Microsoft Online Services and connected applications.</p> <p>A global administrator can update which users are permanently assigned to roles in Azure AD, using PowerShell cmdlets such as Add-MsolRoleMember and Remove-MsolRoleMember, or through the Azure portal.</p> <p>Azure AD Privileged Identity Management (PIM) manages policies for privileged access for users in Azure AD. PIM assigns users to one or more roles in Azure AD, and you can assign someone to be permanently in the role, or eligible for the role. When a user is permanently assigned to a role, or activates an eligible role assignment, then they can manage Azure Active Directory, Microsoft 365, and other applications with the permissions assigned to their roles.</p> <p>There's no difference in the access given to someone with a permanent versus an eligible role assignment. The only difference is that some people don't need that access all the time. They are made eligible for the role, and can turn it on and off whenever they need to.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#roles-managed-in-pim","title":"Roles managed in PIM","text":"<p>Privileged Identity Management lets you assign users to common administrator roles, including:</p> <ul> <li>Global administrator (also known as a Company administrator) has access to all administrative features. You can have more than one global admin in your organization. The person who signs up to purchase Microsoft 365 automatically becomes a global admin.</li> <li>Privileged role administrator manages Azure AD PIM and updates role assignments for other users.</li> <li>Billing administrator makes purchases, manages subscriptions, manages support tickets, and monitors service health.</li> <li>Password administrator users with this role have limited ability to manage passwords. This role does not grant the ability to manage service requests or monitor service health. Whether a Password Administrator can reset a user's password depends on the user's role.</li> <li>Service administrator manages service requests and monitors service health.</li> <li>User management administrator resets passwords, monitors service health, and manages user accounts, user groups, and service requests. The user management admin can\u2019t delete a global admin, create other admin roles, or reset passwords for billing, global, and service admins.</li> <li>Exchange administrator has administrative access to Exchange Online through the Exchange admin center (EAC), and can perform almost any task in Exchange Online.</li> <li>SharePoint administrator has administrative access to SharePoint Online through the SharePoint Online admin center, and can perform almost any task in SharePoint Online.</li> <li>Skype for Business administrator has administrative access to Skype for Business through the Skype for Business admin center, and can perform almost any task in Skype for Business Online.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#roles-not-managed-in-pim","title":"Roles not managed in PIM","text":"<p>Roles within Exchange Online or SharePoint Online, except for those mentioned above, are not represented in Azure AD and so are not visible in PIM. Azure subscriptions and resource groups are also not represented in Azure AD.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#azure-resources","title":"Azure resources","text":"<p>When you first set up Privileged Identity Management for Azure resources, you need to discover and select the resources to protect with Privileged Identity Management. There's no limit to the number of resources that you can manage with Privileged Identity Management. However, we recommend starting with your most critical (production) resources.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-privileged-identity-management-onboarding","title":"Implement privileged identity management onboarding","text":"<p>To use PIM, you need one of the following paid or trial licenses: Azure AD Premium P2, Enterprise Mobility + Security (EMS) E5, or Microsoft 365 M5.</p> <p>PIM Access</p> <p></p> <p>The first Global Administrator to use PIM in your instance of Azure AD is automatically assigned the Security Administrator and Privileged Role Administrator roles in the directory. This person must be an eligible Azure AD user. Only privileged role administrators can manage the Azure AD directory role assignments of users. In addition, you can choose to run the security wizard that walks you through the initial discovery and assignment experience.</p> <p>Users or members of a group assigned to the Owner or User Access Administrator roles, and Global Administrators that enable subscription management in Azure AD, are Resource Administrators. These administrators can assign roles, configure role settings, and review access by using PIM for Azure resources.</p> <p>No one else in your Azure Active Directory (Azure AD) organization gets write access by default, though, including other Global administrators. Other Global administrators, Security administrators, and Security readers have read-only access to Privileged Identity Management. To grant access to Privileged Identity Management, the first user can assign others to the Privileged Role Administrator role.</p> <pre><code>Important\n\nMake sure there are always at least two users in a Privileged Role Administrator role, in case one user is locked out or their account is deleted.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-privileged-identity-management-configuration-settings","title":"Explore privileged identity management configuration settings","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#activation-settings","title":"Activation settings","text":"<ul> <li>Activation duration. Set the maximum time, in hours, that a role stays active before it expires. This value can be from one to 24 hours.</li> <li>Require multifactor authentication on activation. You can require users who are eligible for a role to prove who they are using Azure Active Directory Multi-Factor Authentication (MFA) before they can activate. Multifactor authentication ensures that the user is who they say they are with reasonable certainty. Enforcing this option protects critical resources in situations when the user account might have been compromised.</li> <li>Require justification. You can require that users enter a business justification when they activate.</li> <li>Require approval to activate. If setting multiple approvers, approval completes as soon as one of them approves or denies. You can't require approval from at least two users.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#assignment-settings","title":"Assignment settings","text":"<ul> <li>Allow permanent eligible assignment. Global admins and Privileged role admins can assign permanent eligible assignment. They can also require that all eligible assignments have a specified start and end date.</li> <li>Allow permanent active assignment. Global admins and Privileged role admins can assign active eligible assignment. They can also require that all active assignments have a specified start and end date.</li> </ul> <pre><code>Note\n\nIn some cases, you might want to assign a user to a role for a short duration (one day, for example). In this case, the assigned users don't need to request activation. In this scenario, Privileged Identity Management can't enforce multifactor authentication when the user uses their role assignment because they are already active in the role from the time that it is assigned.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#notification-settings","title":"Notification settings","text":"<ul> <li>Notifications can be sent when members are assigned as eligible in a role, assigned as active in a role, and when the role is activated.</li> <li>Notifications can be sent to Admins, Requestors, and Approvers.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#implement-a-privileged-identity-management-workflow","title":"Implement a privileged identity management workflow","text":"<p>By configuring Azure AD PIM to manage our elevated access roles in Azure AD, we now have JIT access for more than 28 configurable privileged roles. We can also monitor access, audit account elevations, and receive additional alerts through a management dashboard in the Azure portal.</p> <p>Elevated access includes job roles that need greater access, including support, resource administrators, resource owners, service administrators, and global administrators. We manage role-based access at the resource level. Because elevated access accounts could be misused if they\u2019re compromised, we rationalize new requests for elevated access and perform regular re-attestation for elevated roles.</p> <p>The following diagram of the elevated access workflow.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#jit-administrator-access","title":"JIT administrator access","text":"<p>Historically, we could assign an employee to an administrative role through the Azure portal or through Windows PowerShell and that employee would be a permanent administrator; their elevated access would remain active in the assigned role.</p> <p>Azure AD PIM introduced the concept of permanent and eligible administrators in Azure AD and Azure. Permanent administrators have persistent elevated role connections; whereas eligible administrators have privileged access only when they need it. The eligible administrator role is inactive until the employee needs access, then they complete an activation process and become an active administrator for a set amount of time. We\u2019ve stopped using permanent administrators for named individual accounts, although we do have some automated service accounts that still use the role.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#role-activation-in-azure-active-directory","title":"Role activation in Azure Active Directory","text":"<p>Azure AD PIM uses administrative roles, such as tenant admin and global admin, to manage temporary access to various roles. With Azure AD PIM, you can manage the administrators by adding or removing permanent or eligible administrators to each role. Azure AD PIM includes several built-in Azure AD roles as well as Azure that we manage.</p> <p>To activate a role, an eligible admin will initialize Azure AD PIM in the Azure portal and request a time-limited role activation. The activation is requested using the Activate my role option in Azure AD PIM. Users requesting activation must satisfy conditional access policies to ensure that they are coming from authorized devices and locations, and their identities must be verified through multifactor authentication.</p> <p>To help secure transactions while enabling mobility, we use Azure AD PIM to customize role activation variables in Azure, including the number of sign-in attempts, the length of time the role is activated after sign-in, and the type of credentials required (such as single sign-in or multifactor authentication).</p> <p>At Microsoft, when an individual joins a team or changes teams, they might need administrative rights for their new business role. For example, someone might join a team in which their user account will require Exchange Online Administrator privileged access rights in the future. That user makes a request, then their manager validates that user\u2019s request, as does a service owner. With those approvals, Core Services Engineering and Operations (CSEO, formerly Microsoft IT) administrators in the Privileged Role Administrator role are notified. A CSEO administrator uses Azure AD PIM via the Azure portal to make that user eligible for that role. The user can then use Azure AD PIM to activate that role.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#tracking-the-use-of-privileged-roles-using-the-dashboard","title":"Tracking the use of privileged roles using the dashboard","text":"<p>A dashboard through the Azure portal gives a centralized view of:</p> <ul> <li>Alerts that point out opportunities to improve security.</li> <li>The number of users who are assigned to each privileged role.</li> <li>The number of eligible and permanent admins.</li> <li>Ongoing access reviews.</li> </ul> <p>We can track how employees and admins are using their privileged roles by viewing the audit history or by setting up a regular access review. Both options are available through the PIM dashboard in the Azure portal.</p> <p>The PIM audit log tracks changes in privileged role assignments and role activation history. We use the audit log to view all user assignments and activations within a specified period. The audit history helps us determine, in real time, which accounts haven\u2019t signed in recently, or if employees have changed roles.</p> <p>Access reviews can be performed by an assigned reviewer, or employees can review themselves. This is an effective way to monitor who still needs access, and who can be removed.</p> <p>We\u2019re looking at the data that\u2019s collected, and the monitoring team is assessing the best way to configure monitoring alerts to notify us about out-of-band changes\u2014for example, if too many administrator roles are being created for an Azure resource. The information also helps us determine whether our current elevation time settings are appropriate for the various privileged admin roles.</p> <p>Like all organizations, we want to minimize the number of people who have access to our secure information or resources, because that reduces the chance of a malicious user getting access or an authorized user inadvertently impacting a sensitive resource. However, our people still need to carry out privileged operations in Azure AD, Azure, Microsoft 365, and SaaS apps. We can give users privileged access to Azure resources like Subscriptions, and Azure AD. Oversight is needed for what our users are doing with their admin privileges. We use Azure AD PIM to mitigate the risk of excessive, unnecessary, and misused access rights.</p> <p>In Azure AD, we use Azure AD PIM to manage the users we assign to built-in Azure AD organizational roles, such as Global Administrator. In Azure, we use Azure AD PIM to manage our users and groups that we assign via Azure RBAC roles, including Owner and Contributor.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-try-this-exercises_2","title":"Explore Try-This exercises","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-1-azure-ad-pim-for-roles","title":"Task 1: Azure AD PIM for roles","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-pim-settings","title":"Configure PIM settings","text":"<pre><code>Note\n\nThis task requires a AZ500User1 account with no assigned roles.\n</code></pre> <p>In this task, we will review and configure the basic PIM settings.</p> <ol> <li>In the Portal, search for and select Azure AD Privileged Identity Management.</li> <li>Under Manage select Azure AD Roles.</li> <li>Under Manage select Settings.</li> <li>Select the Billing Administrator role.</li> <li>Click Edit.</li> <li>Notice the Activation, Assignment, and Notification tabs.</li> <li>By default, MFA is required on activation. For this demonstration, change the requirement to None.</li> <li>Check the box to Require approval to activate.</li> <li>Discuss the other possible settings including Activation maximum duration and Require approval to activate.</li> <li>Switch to the Assignment tab and require the settings. </li> <li>Notice the ability to expire eligible and active assignments.</li> <li>Switch to the Notifications tab and discuss the settings.</li> <li>Notice you can send notifications when members are assigned and activated.</li> <li>Click Update.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-pim-for-roles","title":"Configure PIM for Roles","text":"<p>In this task, we will add the Billing Administrator role to PIM.</p> <ol> <li>In the Portal, search for and select Azure AD Privileged Identity Management.</li> <li>Under Manage select Azure AD Roles.</li> <li>Under Manage select Roles.</li> <li>Review the list of roles.</li> <li>Select the Billing Administrator role.</li> <li>Review Eligible roles and Active roles.</li> <li>Click Add member.</li> <li>Click Select member and Select the AZ500User1 user. You are now a Billing Administrator.</li> <li> <p>Select Set membership settings. Notice the settings can be permanent or limited in time.         - Assignment type: Eligible         - Permanently eligible: check the box.</p> <ol> <li>Save your changes and Add the assignment.</li> <li>Verify the Billing Administrator is listed as an eligible role.</li> </ol> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#activate-a-role","title":"Activate a role","text":"<p>In this task, we will activate the Billing Administrator role.</p> <ol> <li>In the Portal, search for and select Azure Active Directory.</li> <li>Under Manage click Users.</li> <li>Select AZ500User1.</li> <li>Under Manage click Assigned roles.</li> <li>Verify the user is not assigned to any roles.</li> <li>Sign in the Portal as AZ500User1.</li> <li>Search for and select Azure AD Privileged Identity Management.</li> <li>Under Tasks select My roles.</li> <li>Under Activate select Azure AD Roles.</li> <li>Select the Active roles and verify there are no roles listed.</li> <li>On the Eligible roles tab notice the Billing Administrator role.</li> <li>Under the Action column, select Activate.</li> <li>Assignment details are shown in the Portal. This includes start and end times, and the ability to add a reason.</li> <li>Add a reason and then click Activate.</li> <li>The Activation status should show all the activation stages have been completed.</li> <li>Use the link to Sign out.</li> <li>You must sign out and log back in to start using your newly activated role.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#test-the-role-access","title":"Test the role access","text":"<p>In this task, test the Billing Administrator role.</p> <ol> <li>Sign in to the Portal as AZ500User1.</li> <li>Search for and select Azure AD Privileged Identity Management.</li> <li>Under Activate select Azure AD Roles.</li> <li>Select the Active roles tab and verify the Billing Administrator role has been activated.</li> <li>The role should show Activated.</li> <li>Notice the ability to Deactivate the role.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-2-azure-ad-pim-for-resources","title":"Task 2: Azure AD PIM for resources","text":"<p>In this task, we will configure PIM for Azure resources, activate the Virtual Machine Contributor role, and test the role access.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-pim-for-azure-resources","title":"Configure PIM for Azure resources","text":"<p>In this task, we will add the subscription to PIM, then add the Virtual Machine Contributor role as an Active role.</p> <ol> <li>In the Portal, search for and select Azure AD Privileged Identity Management.</li> <li>Under Manage select Azure Resources.</li> <li>Click Discover resources.</li> <li>Notice the Resource state is Unmanaged.</li> <li>Select the subscription you want to manage.</li> <li>Click Manage resource.</li> <li>Click Yes to confirm that PIM will manage all child objects for the selected resource.</li> <li>Return to the Azure resources blade.</li> <li>Select your subscription.</li> <li>Under Manage click Roles.</li> <li>Search for and select the Virtual machine contributor role.</li> <li>Click Add assignments, then click Select member(s) and add the AZ500User1 to the group.</li> <li>On the Membership settings page set the Assignment type is Active.</li> <li>Add the role and Save your changes.</li> <li>Sign out of the Portal.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#activate-the-role","title":"Activate the role","text":"<p>In this task, we will sign-in as a user and activate the role.</p> <ol> <li>Sign in to the Portal and AZ500User1.</li> <li>Search for and select Azure AD Privileged Identity Management.</li> <li>Under Tasks select My roles.</li> <li>Under Activate select Azure resources.</li> <li>On the Active roles tab notice you have no assigned roles.</li> <li>On the Eligible roles tab scroll to the right and Activate the role.</li> <li>Notice the Start time and Duration.</li> <li>Provide a reason for the activation. For example, 'Need to add a NIC'.</li> <li>Click Activate.</li> <li>The Activation status should show all the activation stages have been completed.</li> <li>Use the link to Sign out.</li> <li>You must sign out and log back in to start using your newly activated role.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#test-the-role-access_1","title":"Test the role access","text":"<p>In this task, we will check to ensure the role has been assigned.</p> <ol> <li>Sign in to the Portal as AZ500User1.</li> <li>Search for and select Azure AD Privileged Identity Management.</li> <li>Under Activate select Azure resources.</li> <li>Select the Active roles tab and verify the Virtual Machine Contributor role has been activated.</li> <li>Sign out of the Portal.</li> <li>Sign in to the Portal using a Global Admin account.</li> <li>Search for and select Azure Active Directory.</li> <li>Under Manage click Users.</li> <li>Select AZ500User1.</li> <li>Under Manage click Assigned roles.</li> <li>Verify there are no roles listed.</li> <li>Under Manage select Azure role assignments.</li> <li>Verify the Virtual machine contributor role is listed.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#knowledge-check_2","title":"Knowledge check","text":"<p>Check your knowledge 1. To enable Azure AD PIM for your directory, what Azure AD Role do you need to enable PIM?</p> <ul> <li>Office 365 Admin</li> <li>Co-Administrator</li> <li> <p>Global Admin (Ans)</p> </li> <li> <p>A company has implemented Azure AD PIM. There's a need to ensure a new hire's request elevation before they make any changes in Azure, what should you do?</p> </li> <li> <p>Activate the new hire.</p> </li> <li>Assign the new hire the Eligible role membership type. (Ans)</li> <li> <p>Include the new hire in an access review.</p> </li> <li> <p>Azure AD PIM is used to manage which of the following roles?</p> </li> <li> <p>Azure privileged users</p> </li> <li>Azure resource groups</li> <li> <p>Azure AD roles (Ans)</p> </li> <li> <p>An organization has enabled Azure AD PIM. The senior IT manager wants the role set up so no action is required, what should you do?</p> </li> <li> <p>Give the manager JIT access to the role.</p> </li> <li>Make the manager Permanent Active in the role. (Ans)</li> <li>Make the manager Assigned to a role.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#design-an-enterprise-governance-strategy","title":"Design an enterprise governance strategy","text":""},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#introduction_4","title":"Introduction","text":"<p>The first part of your organization's secure Azure tenant is set up, but you need to monitor and maintain it. Enterprise Governance is the process of setting strategic tools, systems, and process into motion to keep your systems secure and running well.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#scenario_4","title":"Scenario","text":"<p>A security engineer uses enterprise governance tools and policies to manage and maintain a secure Azure solution; some common tasks are:</p> <ul> <li>Designing an Azure secure access hierarchy.</li> <li>Using RBAC and Azure Policy to control and manage access.</li> <li>Creating blueprints of secure deployments that can be reused.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#review-the-shared-responsibility-model","title":"Review the shared responsibility model","text":"<p>Organizations face many challenges with securing their data centers, including recruiting and keeping security experts, using many security tools, and keeping pace with the volume and complexity of threats.</p> <p>As computing environments move from customer-controlled data centers to the cloud, the security responsibility also shifts. Security of the operational environment is now a concern shared by both cloud providers and customers. By shifting these responsibilities to a cloud service like Azure, organizations can reduce focus on activities that aren't core business competencies. Depending on the specific technology choices, some security protections will be built into the service, while others will remain the customer\u2019s responsibility. To ensure that the proper security controls are provided, a careful evaluation of the services and technology choices becomes necessary.</p> <p>The first thing to understand about cloud security is that different scopes of responsibility exist depending on the kinds of services you use.</p> <p>For example, if you use virtual machines (VMs) in Azure, which provide Infrastructure as a Service (IaaS), Microsoft will be responsible for helping secure the physical network, physical storage, and virtualization platform, which includes updating the virtualization hosts. But you\u2019ll need to take care of helping secure your virtual network and public endpoints and updating the guest operating system (OS) of your VMs.</p> <p>The following figure depicts the various responsibility zones.</p> <p></p> <p>For all cloud deployment types, you own your data and identities. You're responsible for helping secure your data and identities, your on-premises resources, and the cloud components you control (which vary by service type).</p> <p>Regardless of the deployment type, you always retain responsibility for the following:</p> <ul> <li>Data</li> <li>Endpoints</li> <li>Accounts</li> <li>Access management</li> </ul> <pre><code>Important\n\nIt\u2019s important to understand the division of responsibility between you and Microsoft in a Software as a Service (SaaS), Platform as a Service (PaaS), or Infrastructure as a Service (IaaS) deployment.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-the-azure-cloud-security-advantages","title":"Explore the Azure cloud security advantages","text":"<p>The cloud offers significant advantages for solving long standing information security challenges. In an on-premises environment, organizations likely have unmet responsibilities and limited resources available to invest in security, which creates an environment where attackers can exploit vulnerabilities at all layers.</p> <p>The following diagram shows a traditional approach where many security responsibilities are unmet due to limited resources. In the cloud-enabled approach, you can shift day-to-day security responsibilities to your cloud provider and reallocate your resources.</p> <p></p> <p>In the cloud-enabled approach, you are also able to leverage cloud-based security capabilities for more effectiveness and use cloud intelligence to improve your threat detection and response time. By shifting responsibilities to the cloud provider, organizations can get more security coverage, which enables them to reallocate security resources and budget to other business priorities.</p> <pre><code> Important\n\nWhat security advantages are you expecting from leveraging the cloud?\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#review-azure-hierarchy-of-systems","title":"Review Azure hierarchy of systems","text":"<p>Azure Resource Manager is the deployment and management service for Azure. It provides a consistent management layer that allows you to create, update, and delete resources in your Azure subscription. You can use its access control, auditing, and tagging features to help secure and organize your resources after deployment.</p> <p>When you take actions through the portal, Azure PowerShell, the Azure CLI, REST APIs, or client software development kits (SDKs), the Resource Manager API handles your request. Because the same API handles all requests, you get consistent results and capabilities from all the different tools. Functionality initially released through APIs should be represented in the portal within 180 days of the initial release.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#understand-scope","title":"Understand Scope","text":"<p>Azure provides four levels of scope: management groups, subscriptions, resource groups, and resources. The following image shows an example of these layers. Though not labeled as such, the blue cubes are resources.</p> <p></p> <p>You apply management settings at any of these levels of scope. The level you select determines how widely the setting is applied. Lower levels inherit settings from higher levels. For example, when you apply a policy to the subscription, the policy is applied to all resource groups and resources in your subscription. When you apply a policy on the resource group, that policy is applied to the resource group and all its resources. However, another resource group doesn't have that policy assignment.</p> <p>You can deploy templates to management groups, subscriptions, or resource groups.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#resource-groups","title":"Resource Groups","text":"<p>There are some important factors to consider when defining your resource group:</p> <ul> <li>All the resources in your group should share the same lifecycle. You deploy, update, and delete them together. If one resource, such as a database server, needs to exist on a different deployment cycle it should be in another resource group.</li> <li>Each resource can only exist in one resource group.</li> <li>You can add or remove a resource to a resource group at any time.</li> <li>You can move a resource from one resource group to another group.</li> <li>A resource group can contain resources that are located in different regions.</li> <li>A resource group can be used to scope access control for administrative actions.</li> <li>A resource can interact with resources in other resource groups. This interaction is common when the two resources are related but don't share the same lifecycle (for example, web apps connecting to a database).</li> </ul> <p>When creating a resource group, you need to provide a location for that resource group. You may be wondering, \"Why does a resource group need a location? And, if the resources can have different locations than the resource group, why does the resource group location matter at all?\" The resource group stores metadata about the resources. Therefore, when you specify a location for the resource group, you're specifying where that metadata is stored. For compliance reasons, you may need to ensure that your data is stored in a particular region.</p> <p>If the resource group's region is temporarily unavailable, you can't update resources in the resource group because the metadata is unavailable. The resources in other regions will still function as expected, but you can't update them.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#management-groups","title":"Management Groups","text":"<p>Management groups are an Azure resource to create flexible and very maintainable hierarchies within the structure of your environment. Management groups exist above the subscription level thus allowing subscriptions to be grouped together. This grouping facilitates applying policies and RBAC permissions to those management groups. Policies and RBAC permissions are inherited to all resources in the management group. Management groups give you enterprise-grade management at a large scale no matter what type of subscriptions you might have. All subscriptions within a single management group must trust the same Azure Active Directory tenant.</p> <p>Management group hierarchies can be up to six levels deep. This provides you with the flexibility to create a hierarchy that combines several of these strategies to meet your organizational needs. For example, the diagram below shows an organizational hierarchy that combines a business unit strategy with a geographic strategy.</p> <p></p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#the-value-of-management-groups","title":"The value of management groups","text":"<p>Group your subscriptions.</p> <ul> <li>Provide user access to multiple subscriptions</li> <li>Allows for new organizational models and logically grouping of resources.</li> <li>Allows for single assignment of controls that applies to all subscriptions.</li> <li>Provides aggregated views above the subscription level.</li> </ul> <p>Mirror your organization's structure.</p> <ul> <li>Create a flexible hierarchy that can be updated quickly.</li> <li>The hierarchy does not need to model the organization's billing hierarchy.</li> <li>The structure can easily scale up or down depending on your needs.</li> </ul> <p>Apply policies or access controls to any service.</p> <ul> <li>Create one RBAC assignment on the management group, which will inherit that access to all the subscriptions.</li> <li>Use Azure Resource Manager integrations that allow integrations with other Azure services: Azure Cost Management, Privileged Identity Management, and Microsoft Defender for Cloud.</li> </ul> <pre><code>Important\n\nBy using management groups, you can reduce your workload and reduce the risk of error by avoiding duplicate assignments. Instead of applying multiple assignments across numerous resources and subscriptions, you can apply the one assignment on the one management group that contains the target resources. This will save time in the application of assignments, creates one point for maintenance, and allows for better controls on who can control the assignment.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-azure-policies","title":"Configure Azure policies","text":"<p>Azure Policy is a service you use to create, assign, and manage policies. These policies enforce different rules and effects over your resources so that those resources stay compliant with your corporate standards and service level agreements. Azure Policy meets this need by evaluating your resources for noncompliance with assigned policies. For example, you might have a policy that allows virtual machines of only a certain size in your environment. After this policy is implemented, new and existing resources are evaluated for compliance. With the right type of policy, existing resources can be brought into compliance.</p> <p>There are three main pillars in the functionalities of Azure policy.</p> <p></p> <p>The first pillar is around real-time enforcement and compliance assessment. For example, a policy would block the creation of resources that are located outside of US regions. Each policy also provides compliance assessment on all your existing resources to bring a state of compliance for each resource. The data then powers the compliance view which aggregates results across all of the applied policies. Policies can be used to ensure that resource groups are getting tagged properly and automatically inheriting those tags from the resource group down to the resources.</p> <p>The second pillar of policy is applying policies at scale by leveraging Management Groups. By assigning policy to a management group one can impact hundreds of subscriptions and all its reach resources through a single policy assignment. There also is the concept called policy initiative that allows you to group policies together so that you can view the aggregated compliance result. At the initiative level there's also a concept called exclusion where one can exclude either the child management group subscription resource group or resources from the policy assignment.</p> <p>The third pillar of your policy is remediation by leveraging a remediation policy that will automatically remediate the non-compliant resource so that your environment always stays compliant. For existing resources, they will be flagged as non-compliant but they won't automatically be changed because there can be impact to the environment. For these cases you can create a remediation task to bring these resources to compliance. Azure policy is a free service to use.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#policy-permissions-and-custom-policies","title":"Policy permissions and custom policies","text":"<p>Azure Policy has several permissions, known as operations, in two resource providers:</p> <ul> <li>Microsoft.Authorization</li> <li>Microsoft.PolicyInsights</li> </ul> <p>Many built-in roles grant permissions to Azure Policy resources. The Resource Policy Contributor role includes most Azure Policy operations. The Owner role has full rights. Both Contributor and Reader can use all Azure Policy read operations, but Contributor can also trigger remediation.</p> <p>If none of the built-in roles have the required permissions, create a custom role. Azure has by default, security policies that work across subscriptions or on management groups. If these policies need to be augmented with your own organizational policies, new policies can be created.</p> <p>Whatever the business driver for creating a custom policy, the steps are the same for defining the new custom policy. Before creating a custom policy, check the policy samples to determine if a policy that matches your needs already exists.</p> <p>The approach to creating a custom policy follows these steps:</p> <ul> <li>Identify your business requirements</li> <li>Map each requirement to an Azure resource property</li> <li>Map the property to an alias</li> <li>Determine which effect to use</li> <li>Compose the policy definition</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#composing-an-azure-policy","title":"Composing an Azure Policy","text":"<p>The steps for composing and implementing a policy in Azure Policy begins with creating:</p> <ul> <li>Policy definition - Every policy definition has conditions under which it's enforced. And, it has a defined effect that takes place if the conditions are met.</li> <li>Policy assignment - A policy definition that has been assigned to take place within a specific scope. This scope could range from a management group to an individual resource. The term scope refers to all the resources, resource groups, subscriptions, or management groups that the policy definition is assigned to.</li> <li>Policy parameters - They help simplify your policy management by reducing the number of policy definitions you must create. You can define parameters when creating a policy definition to make it more generic.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#create-and-assign-an-initiative-definition","title":"Create and assign an Initiative definition","text":"<p>In order to easily track compliance for multiple resources, create and assign an Initiative definition. With an initiative definition, you can group several policy definitions to achieve one overarching goal. An initiative evaluates resources within scope of the assignment for compliance to the included policies.</p> <p>To implement these policy definitions (both built-in and custom definitions), you'll need to assign them. You can assign any of these policies through the Azure portal, PowerShell, or Azure CLI.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#enable-azure-role-based-access-control-rbac","title":"Enable Azure role-based access control (RBAC)","text":"<p>When it comes to identity and access, most organizations that are considering using the public cloud are concerned about two things:</p> <ul> <li>Ensuring that when people leave the organization, they lose access to resources in the cloud.</li> <li>Striking the right balance between autonomy and central governance\u2014for example, giving project teams the ability to create and manage virtual machines in the cloud while centrally controlling the networks to which those virtual machines connect.</li> </ul> <p>RBAC is an authorization system built on Azure Resource Manager that provides fine-grained access management of Azure resources. Azure AD and Role Based Access Control (RBAC) make it simple for you to carry out these goals. After you extend your on-premises Active Directory to the cloud by using Azure AD Connect, your employees can use and manage their Azure subscriptions by using their existing work identities. These Azure subscriptions automatically connect to Azure AD for SSO and access management. When you disable an on-premises Active Directory account, it automatically loses access to all Azure subscriptions connected with Azure AD.</p> <p>Additionally, synchronizing passwords to the cloud to support these checks also add resiliency during some attacks. Customers affected by (Not)Petya attacks were able to continue business operations when password hashes were synced to Azure AD (vs. near zero communications and IT services for customers affected organizations that had not synchronized passwords).</p> <p>RBAC enables fine-grained access management for Azure. Using RBAC, you can grant just the amount of access that users need to perform their jobs. For example, you can use RBAC to let one employee manage virtual machines in a subscription while another manages SQL databases within the same subscription.</p> <p>Each Azure subscription is associated with one Azure AD directory. Users, groups, and applications in that directory can manage resources in the Azure subscription. Grant access by assigning the appropriate RBAC role to users, groups, and applications at a certain scope. The scope of a role assignment can be a subscription, a resource group, or a single resource. A role assigned at a parent scope also grants access to the child scopes contained within it. For example, a user with access to a resource group can manage all the resources it contains, like websites, virtual machines, and subnets. The RBAC role that you assign dictates what resources the user, group, or application can manage within that scope.</p> <p>The following diagram depicts how the classic subscription administrator roles, RBAC roles, and Azure AD administrator roles are related at a high level. Roles assigned at a higher scope, like a subscription, are inherited by child scopes, like service instances.</p> <p></p> <pre><code>Important\n\nNote that a subscription is associated with only one Azure AD tenant. Also note that a resource group can have multiple resources but is associated with only one subscription. Lastly, a resource can be bound to only one resource group.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#compare-and-contrast-azure-rbac-vs-azure-policies","title":"Compare and contrast Azure RBAC vs Azure policies","text":"<p>There are a few key differences between Azure Policy and Azure role-based access control (Azure RBAC). Azure Policy evaluates the state by examining properties on resources that are represented in Resource Manager and properties of some Resource Providers. Azure Policy ensures that the resource state is compliant with your business rules without concern for who made the change or who has permission to make a change. Azure Policy, through the DenyAction effect, can also block specific actions on resources. Some Azure Policy resources, such as policy definitions, initiative definitions, and assignments, are visible to all users. This design enables transparency to all users and services regarding what policy rules are set in their environment.</p> <p>Azure RBAC focuses on managing user actions at different scopes. If control of an action is required based on user information, then Azure RBAC is the correct tool to use. Even if an individual has access to perform an action, if the result is a non-compliant resource, Azure Policy still blocks the create or update task.</p> <p>The combination of Azure role-based access control (Azure RBAC) and Azure Policy provides full-scope control in Azure.</p> <p>Azure Policy has several permissions, known as operations, in two Resource Providers:</p> <ol> <li>Microsoft.Authorization</li> <li>Microsoft.PolicyInsights</li> </ol> <p>Many built-in roles grant permission to Azure Policy resources. The Resource Policy Contributor role includes most Azure Policy operations. The owner has full rights. Both Contributor and Reader have access to all read Azure Policy operations.</p> <p>A contributor may trigger resource remediation but can't create or update definitions and assignments. User Access Administrator is necessary to grant the managed identity on deployIfNotExists or modify the assignment's necessary permissions.</p> <pre><code>Note\n\nAll Policy objects, including definitions, initiatives, and assignments, will be readable to all roles over its scope. For example, a Policy assignment scoped to an Azure subscription will be readable by all role holders at the subscription scope and below.\n</code></pre> <p>If none of the built-in roles have the permissions required, create a custom role.</p> <p>Azure Policy operations can have a significant impact on your Azure environment. Only the minimum set of permissions necessary to perform a task should be assigned and these permissions should not be granted to users who do not need them.</p> <pre><code> Note\n\nThe managed identity of a deployIfNotExists or modify policy assignment needs enough permissions to create or update targeted resources.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#example-role-based-access-control-rbac-vs-azure-policy","title":"Example: Role-Based Access Control (RBAC) vs. Azure Policy","text":"<pre><code>Important\n\nRBAC and Polices in Azure play a vital role in a governance strategy. While different, they both work together to ensure organizational business rules are followed by ensuring proper access and resource creation guidelines are met.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#configure-built-in-roles","title":"Configure built-in roles","text":"<p>Azure role-based access control (RBAC) has several Azure built-in roles that you can assign to users, groups, service principals, and managed identities. Role assignments are the way you control access to Azure resources. If the built-in roles don't meet the specific needs of your organization, you can create your own Azure custom roles.</p> <p>The four general built-in roles are:</p> Built-in Role Description Contributor Grants full access to manage all resources, but does not allow you to assign roles in Azure RBAC, manage assignments in Azure Blueprints, or share image galleries. Owner Grants full access to manage all resources, including the ability to assign roles in Azure RBAC. Reader View all resources, but does not allow you to make any changes. User Access Administrator Lets you manage user access to Azure resources."},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#custom-roles-for-azure-resources","title":"Custom roles for Azure resources","text":"<p>If the built-in roles for Azure resources don't meet the specific needs of your organization, you can create your own custom roles. Just like built-in roles, you can assign custom roles to users, groups, and service principals at management group, subscription, and resource group scopes.</p> <p>Custom roles can be shared between subscriptions that trust the same Azure AD directory. There is a limit of 5,000 custom roles per directory. (For Azure Germany and Azure China 21Vianet, the limit is 2,000 custom roles.) Custom roles can be created using the Azure portal, Azure PowerShell, Azure CLI, or the REST API.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#custom-role-limits","title":"Custom role limits","text":"<p>The following list describes the limits for custom roles.</p> <ul> <li>Each directory can have up to 5000 custom roles.</li> <li>Azure Germany and Azure China 21Vianet can have up to 2000 custom roles for each directory.</li> <li>You cannot set AssignableScopes to the root scope (\"/\").</li> <li>You can only define one management group in AssignableScopes of a custom role. Adding a management group to AssignableScopes is currently in preview.</li> <li>Custom roles with DataActions cannot be assigned at the management group scope.</li> <li>Azure Resource Manager doesn't validate the management group's existence in the role definition's assignable scope.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#enable-resource-locks","title":"Enable resource locks","text":"<p>As an administrator, you may need to lock a subscription, resource group, or resource to prevent other users in your organization from accidentally deleting or modifying critical resources. You can set the lock level to CanNotDelete or ReadOnly. In the portal, the locks are called Delete and Read-only respectively.</p> <p></p> <ul> <li>CanNotDelete means authorized users can still read and modify a resource, but they can't delete the resource.</li> <li>ReadOnly means authorized users can read a resource, but they can't delete or update the resource. Applying this lock is similar to restricting all authorized users to the permissions granted by the Reader role.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#who-can-create-or-delete-locks","title":"Who can create or delete locks","text":"<pre><code>To create or delete management locks, you must have access to **Microsoft.Authorization/***or Microsoft.Authorization/locks/* actions. Of the built-in roles, only Owner and User Access Administrator are granted those actions.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#deploy-azure-blueprints","title":"Deploy Azure blueprints","text":"<p>Just as a blueprint allows an engineer or an architect to sketch a project's design parameters, Azure Blueprints enables cloud architects and central information technology groups to define a repeatable set of Azure resources that implements and adheres to an organization's standards, patterns, and requirements. Azure Blueprints allows development teams to rapidly build and stand up new environments with the trust they're building within organizational compliance with a set of built-in components, such as networking, to speed up development and delivery.</p> <p>Blueprints are a declarative way to orchestrate the deployment of various resource templates and other artifacts, such as:</p> <ul> <li>Role Assignments</li> <li>Policy Assignments</li> <li>Azure Resource Manager templates</li> <li>Resource Groups</li> </ul> <p>The Azure Blueprints service is supported by the globally distributed Azure Cosmos Data Base. Blueprint objects are replicated in multiple Azure regions. This replication provides low latency, high availability, and consistent access to your blueprint objects, regardless of which region Blueprints deploys your resources to.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#how-is-it-different-from-azure-resource-manager-templates","title":"How is it different from Azure Resource Manager templates?","text":"<p>The service design helps with environment setup. This setup often includes resource groups, policies, role assignments, and Resource Manager template deployments assigned to a subscription in a single audited and tracked operation. A blueprint is a package to bring each artifact type together and allows you to compose and version that package into a continuous integration and pipeline.</p> <p>Nearly everything that you want to include for deployment in Blueprints is also with a Resource Manager template. However, a Resource Manager template is a document that doesn't exist natively in Azure \u2013 it's stored either locally or in source control. The template gets used for deployments of one or more Azure resources, but once those resources deploy, there's no active connection or relationship to the template.</p> <p>Blueprints save the relationship between the blueprint definition and the blueprint assignment. This connection supports improved tracking and auditing of deployments. Blueprints can upgrade several subscriptions governed by the exact blueprint.</p> <p>There's no need to choose between a Resource Manager template and a blueprint. Each blueprint can consist of zero or more Resource Manager template artifacts. This support means that previous efforts to develop and maintain a library of Resource Manager templates are reusable in Blueprints.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#how-its-different-from-azure-policy","title":"How it's different from Azure Policy","text":"<p>A blueprint is a package or container for composing focus-specific standards, patterns, and requirements for implementing Azure cloud services, security, and design reused to maintain consistency and compliance.</p> <p>An Azure policy is a default allow and explicit deny system focused on resource properties during deployment and for existing resources. It supports cloud governance by validating that help within a subscription adhere to requirements and standards.</p> <p>Including an Azure policy in a blueprint enables the creation of the correct pattern or design during the assignment of the blueprint. The policy inclusion ensures that only approved or expected changes can be made to the environment to protect ongoing compliance with the intent of the blueprint.</p> <p>An Azure policy is available as one of many artifacts in a blueprint definition. Blueprints also support using parameters with policies and initiatives.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#blueprint-definition","title":"Blueprint definition","text":"<p>A blueprint is composed of artifacts. Azure Blueprints currently supports the following resources as artifacts:</p> Resource Hierarchy options Description Resource Groups Subscription Create a new resource group for use by other artifacts within the blueprint. These placeholder resource groups enable you to organize resources exactly how you want them structured and provide a scope limiter for included policy and role assignment artifacts and ARM templates. ARM template Subscription, Resource Group Templates, including nested and linked templates, are used to compose complex environments. Example environments: a SharePoint farm, Azure Automation State Configuration, or a Log Analytics workspace. Policy Assignment Subscription, Resource Group Allows assignment of a policy or initiative to the subscription the blueprint is assigned to. The policy or initiative must be within the scope of the blueprint definition location. If the policy or initiative has parameters, these parameters are assigned at the creation of the blueprint or during blueprint assignment. Role Assignment Subscription, Resource Group Add an existing user or group to a built-in role to make sure the right people always have the right access to your resources. Role assignments can be defined for the entire subscription or nested to a specific resource group included in the blueprint."},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#blueprint-definition-locations","title":"Blueprint definition locations","text":"<p>When creating a blueprint definition, you'll define where the blueprint is saved. Blueprints can be saved to a management group or subscription that you have Contributor access to. If the location is a management group, the blueprint is available to assign to any child subscription of that management group.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#blueprint-parameters","title":"Blueprint parameters","text":"<p>Blueprints can pass parameters to either a policy/initiative or an ARM template. When adding either artifact to a blueprint, the author decides to provide a defined value for each blueprint assignment or to allow each blueprint assignment to provide a value at assignment time. This flexibility provides the option to define a pre-determined value for all uses of the blueprint or to enable that decision to be made at the time of assignment.</p> <pre><code>Note\n\nAssigning a blueprint definition to a management group means the assignment object exists in the management group. The deployment of artifacts still targets a subscription. To perform a management group assignment, the Create Or Update REST API must be used, and the request body must include a value for properties.scope to define the target subscription.\n</code></pre>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#design-an-azure-subscription-management-plan","title":"Design an Azure subscription management plan","text":"<p>An Azure Active Directory (AD) tenant is created for you when you sign up for Azure. The tenant represents your account. You use the tenant to manage access to your subscriptions and resources.</p> <p>When you create a new subscription, it's hosted in your account's Azure AD tenant. If you want to give others access to your subscription or its resources, you need to invite them to join your tenant. Doing so helps you control access to your subscriptions and resources. You can create additional subscriptions for your account in Azure. You might want an additional subscription to avoid reaching subscription limits, to create separate environments for billing and security, or to isolate data for compliance reasons.</p> <p>If you want to create Azure subscriptions under your organization's Enterprise Agreement (EA), you need to have the Account Owner role for your organization.</p> <p>If you need to transfer billing ownership of your Azure subscription if you're leaving your organization, or you want your subscription to be billed to another account. Transferring billing ownership to another account provides the administrators in the new account permission for billing tasks. They can change the payment method, view charges, and cancel the subscription.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#manage-api-access-to-azure-subscriptions-and-resources","title":"Manage API access to Azure subscriptions and resources","text":"<p>When you publish APIs through API Management, it's easy and common to gain access to those APIs by using subscription keys. Client applications that consume the published APIs need to include a valid subscription key in HTTP requests when they make calls to those APIs. To get a subscription key for accessing APIs, a subscription is required. A subscription is essentially a named container for a pair of subscription keys. Developers who need to consume the published APIs can get subscriptions, and they don't need approval from API publishers. API publishers can also directly create subscriptions for API consumers.</p> <p>API Management supports additional mechanisms for gaining access to APIs, including:</p> <ul> <li>OAuth 2.0</li> <li>Client certificates</li> <li>IP allowlists</li> </ul> <p>Azure policies encapsulate common API management functions, like those for access control, protection, transformation, and caching. You can chain these policies together into a pipeline that mutates a request\u2019s context or changes the API behavior. You can apply these policies to a variety of scopes, trigger them on an error, and set them in the inbound and outbound directions.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#who-can-transfer-a-subscription","title":"Who can transfer a subscription?","text":"<p>A billing administrator or the account administrator is a person who has permission to manage billing for an account. They're authorized to access billing on the Azure portal and do various billing tasks like create subscriptions, view and pay invoices, or update payment methods. If you're an Enterprise Agreement (EA) customer, your enterprise administrators can transfer billing ownership of your subscriptions between accounts.</p> <p>To identify accounts for which you're a billing administrator, use the following steps:</p> <ul> <li>Visit the Cost Management + Billing page in Azure portal.</li> <li>Select All billing scopes from the left-hand pane.</li> <li>The subscriptions page lists all subscriptions where you're a billing administrator.</li> </ul>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#explore-try-this-exercises_3","title":"Explore Try-This exercises","text":"<p>Use your own Azure subscription to perform these Try-This exercises - Enterprise Governance.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-1-navigating-azure","title":"Task 1 - Navigating Azure","text":"<p>In this task, you'll learn how to access and use the Azure portal.</p> <p>Locate the Azure portal</p> <p>In this task, you'll access the lab environment and the Azure portal.</p> <ol> <li>Ask your instructor how to access the lab environment.</li> <li>After accessing the lab environment, navigate to the Azure portal.</li> <li>Bookmark this page. You'll use the Portal throughout the course labs and demonstrations.</li> <li>In the top right corner of the Portal, select your user account.</li> <li>Notice you can View account and Switch directory.</li> <li>Switch directory lets you view My permissions and View my bill.</li> <li>Select the Settings icon (top right menu bar - cog icon).</li> <li>Review the Portal settings including the General and Language &amp; region settings.</li> <li>Use the Search resources, services, and docs textbox to search for Virtual machines.</li> <li>You can search for not only general Azure resources but specifically but named resources.</li> <li>Select Use the Portal menu (left corner three bars icon).</li> <li>Notice you can Create a resource, view All services, and view All resources.</li> <li>Take some time to browse around the interface, search and explore different areas.</li> <li>Launch the Cloud Shell (first icon top menu bar).</li> <li>Notice the drop-down for PowerShell or Bash.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-2-azure-rbac-role-assignments","title":"Task 2 - Azure RBAC Role Assignments","text":"<p>In this task, we'll learn about role assignments.</p> <p>Locate Access Control blade</p> <ol> <li>Access the Azure portal, and select a resource group. Make a note of what resource group you use.</li> <li>Select the Access Control (IAM) blade.</li> <li>This blade is available for many different resources so you can control access.</li> </ol> <p>Review role permissions</p> <ol> <li>Click the Roles tab (top).</li> <li>Select a desired role from the list by clicking the associated box next to the Role Name.</li> <li>Click the View link under the Details column on the far right of the page.</li> <li>The Permissions view is displayed including three columns from left to right that is (i.e., Other, Read, Write, and Delete) Permissions, and Description.</li> <li>Return to the Access Control (IAM) blade.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#task-3-manage-resource-locks","title":"Task 3 - Manage resource locks","text":"<p>Note: This task requires a resource group.</p> <p>In this task, we'll create resource locks.</p> <ol> <li>In the Portal navigate to a resource group.</li> <li>In the Settings section, click Locks, and then click + Add.</li> <li>Discuss the different types of locks and applying the locks at different levels.</li> <li>Create a new lock with a Lock type of Delete.</li> <li>From the Overview blade, click Delete resource group. Type the name of the resource group and click OK.</li> <li>You should receive an error message stating the resource group is locked and can't be deleted.</li> <li>Add a Storage Account to the resource group.</li> <li>After the storage account is created, try to delete the storage account.</li> <li>You receive an error message stating the resource or its parent has a delete lock.</li> <li>Review how the storage account inherits the lock from the parent and can't be deleted.</li> <li>Return to the resource group blade and, in the Settings section, click Locks.</li> <li>Scroll all the way to the right, then click the Delete link to the right of the lock.</li> <li>Return to the storage account and confirm you can now delete the resource.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#knowledge-check_3","title":"Knowledge check","text":"<p>Choose the best response for each of the questions below. Then select Check your answers.</p>"},{"location":"Cloud/Azure/AZ-500/Manage-Identity-and-Access.html#check-your-knowledge_1","title":"Check your knowledge","text":"<ol> <li> <p>The company hires a new administrator and needs to create a new Azure AD user account for them. The new hire must be able to: - Read/write resource deployments they're responsible for. - Read Azure AD access permissions They shouldn't be able to view Azure subscription information. What should be configured to make this work?</p> </li> <li> <p>Assign the user the Contributor role at the resource group level. (Ans)</p> </li> <li>Assign the user the Owner role at the resource level.</li> <li> <p>Assign the user the Global Administrator role.</p> </li> <li> <p>Which of the following would be good example of when to use a resource lock?</p> </li> <li> <p>An ExpressRoute circuit with connectivity back to your on-premises network. (Ans)</p> </li> <li>A virtual machine used to test occasional application builds.</li> <li> <p>A storage account used to store images processed in a development environment.</p> </li> <li> <p>A company has three virtual machines (VM1, VM2, and VM3) in a resource group. The Helpdesk hires a new employee. The new employee must be able to modify the settings on VM3, but not on VM1 and VM2. Your solution must minimize administrative overhead. What should be set up?</p> </li> <li> <p>Assign the user to the Contributor role on the resource group.</p> </li> <li>Assign the user to the Contributor role on VM3. (Ans)</li> <li> <p>Move VM3 to a new resource group and assign the user to the Contributor role on VM3.</p> </li> <li> <p>You need to target policies and review spend budgets across several subscriptions you manage. What should be created for the subscriptions?</p> </li> <li> <p>A billing group</p> </li> <li>A management group (Ans)</li> <li> <p>A nested resource group</p> </li> <li> <p>A manager asks for an explanation of how Azure uses resource groups. Which of the following capabilities is a feature of how Azure uses resource groups?</p> </li> <li> <p>Resources can be in multiple resource groups.</p> </li> <li>Resources can be moved from one resource group to another resource group. (Ans)</li> <li>Resource groups can be nested.</li> </ol>"},{"location":"Cloud/Azure/AZ-500/Manage-security-operation.html","title":"AZ-500: Microsoft Certified: Azure Security Engineer Associate","text":""},{"location":"Cloud/Azure/AZ-500/Manage-security-operation.html#manage-security-operation","title":"Manage security operation","text":"<p>Once you have deployed and secured your Azure environment, learn to monitor, operate, and continuously improve the security of your solutions.</p> <p>This learning path helps prepare you for Exam AZ-500: Microsoft Azure Security Technologies.</p> <ol> <li>Configure and manage Azure Monitor<ul> <li>Introduction</li> <li>Explore Azure Monitor</li> <li>Configure and monitor metrics and logs</li> <li>Enable Log Analytics</li> <li>Manage connected sources for log analytics</li> <li>Enable Azure monitor Alerts</li> <li>Configure properties for diagnostic logging</li> <li>Perform try-this exercises</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> <li>Enable and manage Microsoft Defender for Cloud<ul> <li>Introduction</li> <li>MITRE Attack matrix</li> <li>Implement Microsoft Defender for Cloud</li> <li>Security posture</li> <li>Workload protections</li> <li>Deploy Microsoft Defender for Cloud</li> <li>Azure Arc</li> <li>Azure Arc capabilities</li> <li>Microsoft cloud security benchmark</li> <li>Configure Microsoft Defender for Cloud policies</li> <li>View and edit security policies</li> <li>Manage and implement Microsoft Defender for Cloud recommendations</li> <li>Explore secure score</li> <li>Define brute force attacks</li> <li>Understand just-in-time VM access</li> <li>Implement just-in-time VM access</li> <li>Perform try-this exercises</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> <li>Configure and monitor Microsoft Sentinel<ul> <li>Introduction</li> <li>Enable Azure Sentinel</li> <li>Configure data connections to Sentinel</li> <li>Create workbooks for explore Sentinel data</li> <li>Enable rules to create incidents</li> <li>Configure playbooks</li> <li>Hunt and investigate potential breaches</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Secure-your-data-and-applications.html","title":"AZ-500: Microsoft Certified: Azure Security Engineer Associate","text":""},{"location":"Cloud/Azure/AZ-500/Secure-your-data-and-applications.html#secure-your-data-and-applications","title":"Secure your data and applications","text":"<p>Application running within Azure access your confidential data need to be locked down. Learn to secure your applications, storage, databases, and key vaults.</p> <p>This learning path helps prepare you for Exam AZ-500: Microsoft Azure Security Technologies.</p> <ol> <li>Deploy and secure Azure Key Vault<ul> <li>Introduction</li> <li>Explore Azure Key Vault</li> <li>Configure Key Vault access</li> <li>Review a secure Key Vault example</li> <li>Deploy and manage Key Vault certificates</li> <li>Create Key Vault keys</li> <li>Manage customer managed keys</li> <li>Enable Key Vault secrets</li> <li>Configure key rotation</li> <li>Manage Key Vault safety and recovery features</li> <li>Perform Try-This exercises</li> <li>Explore the Azure Hardware Security Module</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> <li>Configure application security features<ul> <li>Introduction</li> <li>Review the Microsoft identity platform</li> <li>Explore Azure AD application scenarios</li> <li>Register an application with App Registration</li> <li>Configure Microsoft Graph permissions</li> <li>Enable managed identities</li> <li>Azure App Services</li> <li>App Service Environment</li> <li>Azure App Service plan</li> <li>App Service Environment networking</li> <li>Availability Zone Support for App Service Environments</li> <li>App Service Environment Certificates</li> <li>Perform Try-This exercises</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> <li>Implement storage security<ul> <li>Introduction</li> <li>Define data sovereignty</li> <li>Configure Azure storage access</li> <li>Deploy shared access signatures</li> <li>Manage Azure AD storage authentication</li> <li>Implement storage service encryption</li> <li>Configure blob data retention policies</li> <li>Configure Azure files authentication</li> <li>Enable the secure transfer required\u200b property</li> <li>Perform Try-This exercises</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> <li>Configure and manage SQL database security<ul> <li>Introduction</li> <li>Enable SQL database authentication</li> <li>Configure SQL database firewalls</li> <li>Enable and monitor database auditing</li> <li>Implement data discovery and classification</li> <li>Microsoft Defender for SQL</li> <li>Vulnerability assessment for SQL Server</li> <li>SQL Advanced Threat Protection</li> <li>Explore detection of a suspicious event</li> <li>SQL vulnerability assessment express and classic configurations</li> <li>Configure dynamic data masking</li> <li>Implement transparent data encryption</li> <li>Deploy always encrypted\u200b features</li> <li>Deploy an always encrypted implementation</li> <li>Perform Try-This exercises</li> <li>Knowledge check</li> <li>Summary</li> </ul> </li> </ol>"},{"location":"Cloud/Azure/AZ-500/Secure-your-data-and-applications.html#explore-azure-key-vault","title":"Explore Azure Key Vault","text":"<p>Protecting your keys is essential to protecting your identity and data in the cloud.</p> <p>Azure Key Vault helps safeguard cryptographic keys and secrets that cloud applications and services use. Key Vault streamlines the key management process and enables you to maintain control of keys that access and encrypt your data. Developers can create keys for development and testing in minutes, and then migrate them to production keys. Security administrators can grant (and revoke) permission to keys, as needed.</p> <p>You can use Key Vault to create multiple secure containers, called vaults. Vaults help reduce the chances of accidental loss of security information by centralizing application secrets storage. Key vaults also control and log the access to anything stored in them.</p> <p>Azure Key Vault can manage requesting and renewing TLS certificates. It provides features for a robust solution for certificate lifecycle management.</p> <p>Azure Key Vault helps address the following issues:</p> <ul> <li>Secrets management. You can use Azure Key Vault to securely store and tightly control access to tokens, passwords, certificates, API keys, and other secrets.</li> <li>Key management. You use Azure Key Vault as a key management solution, making it easier to create and control the encryption keys used to encrypt your data.</li> <li>Certificate management. Azure Key Vault is also a service that lets you easily provision, manage, and deploy public and private SSL/TLS certificates for use with Azure and your internal connected resources.</li> <li>Store secrets backed by hardware security modules (HSMs). The secrets and keys can be protected either by software, or FIPS 140-2 Level 2 validates HSMs.</li> </ul> <p>Azure Key Vault is designed to support application keys and secrets. Key Vault is not intended as storage for user passwords.</p> <p>The following table lists security best practices for using Key Vault.</p> Best practice Solution Grant access to users, groups, and applications at a specific scope. Use RBAC\u2019s predefined roles. For example, to grant access to a user to manage key vaults, you would assign the predefined role Key Vault Contributor to this user at a specific scope. The scope in this case would be a subscription, a resource group, or just a specific key vault. If the predefined roles don\u2019t fit your needs, you can define your own roles. Control what users have access to. Access to a key vault is controlled through two separate interfaces: management plane, and data plane. The management plane and data plane access controls work independently. Use RBAC to control what users have access to. For example, if you want to grant an application access to use keys in a key vault, you only need to grant data plane access permissions by using key vault access policies, and no management plane access is needed for this application. Conversely, if you want a user to be able to read vault properties and tags but not have any access to keys, secrets, or certificates, you can grant this user read access by using RBAC, and no access to the data plane is required. Store certificates in your key vault. Azure Resource Manager can securely deploy certificates stored in Azure Key Vault to Azure VMs when the VMs are deployed. By setting appropriate access policies for the key vault, you also control who gets access to your certificate. Another benefit is that you manage all your certificates in one place in Azure Key Vault. Ensure that you can recover a deletion of key vaults or key vault objects. Deletion of key vaults or key vault objects can be either inadvertent or malicious. Enable the soft delete and purge protection features of Key Vault, particularly for keys that are used to encrypt data at rest. Deletion of these keys is equivalent to data loss, so you can recover deleted vaults and vault objects if needed. Practice Key Vault recovery operations on a regular basis. <p>Azure Key Vault is offered in two service tiers\u2014standard and premium</p> <p>The main difference between Standard and Premium is that Premium supports HSM-protected keys.</p> <pre><code>Important\n\nIf a user has contributor permissions (RBAC) to a key vault management plane, they can grant themselves access to the data plane by setting a key vault access policy. We recommend that you tightly control who has contributor access to your key vaults, to ensure that only authorized persons can access and manage your key vaults, keys, secrets, and certificates.\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html","title":"SonarQube","text":""},{"location":"Devops/tools/CQT/Sonarqube.html#how-to-install-sonarqube-on-ubuntu-2004-lts","title":"How to Install SonarQube on Ubuntu 20.04 LTS","text":"<ul> <li> <p>Prerequisites:</p> <ul> <li>Ubuntu 20.04 LTS with minimum 2GB RAM and 1 CPU.</li> <li>PostgreSQL Version 9.3 or higher</li> <li>SSH access with sudo privileges</li> <li>Firewall Port: 9000</li> </ul> </li> <li> <p>Hardware requirements:</p> <ol> <li>A small-scale (individual or small team) instance of the SonarQube server requires at least 2GB of RAM to run efficiently and 1GB of free RAM for the OS. If you are installing an instance for a large      team or an enterprise, please consider the additional recommendations below.</li> <li>The amount of disk space you need will depend on how much code you analyze with SonarQube.</li> <li>SonarQube must be installed on hard drives that have excellent read &amp; write performance. Most importantly, the \"data\" folder houses the Elasticsearch indices on which a huge amount of I/O will be               done when the server is up and running. Read and write hard drive performance will therefore have a big impact on the overall SonarQube server performance.</li> </ol> </li> </ul> <pre><code>sudo sysctl -w vm.max_map_count=262144\n</code></pre> <pre><code>sudo sysctl -w fs.file-max=65536\n</code></pre> <pre><code>ulimit -n 65536\n</code></pre> <pre><code>ulimit -u 4096\n</code></pre> <p>To Increase the vm.max_map_count kernal ,file discriptor and ulimit permanently . Open the below config file and Insert the below value as shown below,</p> <pre><code>sudo vi /etc/security/limits.conf\n</code></pre> <pre><code>sonarqube - nofile 65536\n</code></pre> <pre><code>sonarqube - nproc 4096\n</code></pre> <ul> <li>Enterprise hardware recommendations: For large teams or enterprise-scale installations of SonarQube, additional hardware is required. At the enterprise level, monitoring your SonarQube instance is essential and should guide further hardware upgrades as your instance grows. A starting configuration should include at least:<ul> <li>8 cores, to allow the main SonarQube platform to run with multiple compute engine workers</li> <li>16GB of RAM For additional requirements and recommendations relating to database and Elasticsearch.</li> </ul> </li> </ul> <p>Supported platforms:     1. Java: The SonarQube server requires Java version 17 and the SonarQube scanners require Java version 11 or 17.     2. Database: PostgreSQL version = 11,12,13,14,15     3. xxxxxx: xxxxx </p> <p>To Increase the vm.max_map_count kernal ,file discriptor and ulimit permanently . Open the below config file and Insert the below value as shown below,</p> <pre><code>sudo vi /etc/security/limits.conf\n</code></pre> <pre><code>sonarqube   -   nofile   65536\nsonarqube   -   nproc    4096\n</code></pre> <p>OR If you are using systemd to manage the sonarqube services then add below value in sonarqube unit file under [service] section.</p> <pre><code>[Service]\n...\nLimitNOFILE=65536\nLimitNPROC=4096\n...\n</code></pre> <p>Before installing, Lets update and upgrade System Packages</p> <pre><code>sudo apt-get update\nsudo apt-get upgrade\n</code></pre> <p>Install wget and unzip package</p> <pre><code>sudo apt-get install wget unzip -y\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#step-1-install-openjdk","title":"Step #1: Install OpenJDK","text":"<p>Install OpenJDK and JRE 11 using following command,</p> <pre><code>sudo apt-get install openjdk-11-jdk -y\nsudo apt-get install openjdk-11-jre -y\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#set-default-jdk","title":"SET Default JDK","text":"<pre><code>sudo update-alternatives --config java\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#check-java-version","title":"Check JAVA Version:","text":"<pre><code>java -version\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#step-2-install-and-setup-postgresql-10-database-for-sonarqube","title":"Step #2: Install and Setup PostgreSQL 10 Database For SonarQube","text":"<p>Add and download the PostgreSQL Repo</p> <pre><code>sudo sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main\" &gt;&gt; /etc/apt/sources.list.d/pgdg.list'\nwget -q https://www.postgresql.org/media/keys/ACCC4CF8.asc -O - | sudo apt-key add -\n</code></pre> <p>Install the PostgreSQL database Server by using following command,</p> <pre><code>sudo apt-get -y install postgresql postgresql-contrib\n</code></pre> <p>Start PostgreSQL Database server</p> <pre><code>sudo systemctl start postgresql\n</code></pre> <p>Enable it to start automatically at boot time.</p> <pre><code>sudo systemctl enable postgresql\n</code></pre> <p>Change the password for the default PostgreSQL user.</p> <pre><code>sudo passwd postgres\n</code></pre> <p>Switch to the postgres user.</p> <pre><code>su - postgres\n</code></pre> <p>Create a new user by typing:</p> <pre><code>createuser sonar\n</code></pre> <p>Switch to the PostgreSQL shell.</p> <pre><code>psql\n</code></pre> <p>Set a password for the newly created user for SonarQube database.</p> <pre><code>ALTER USER sonar WITH ENCRYPTED password 'sonar';\n</code></pre> <p>Create a new database for PostgreSQL database by running:</p> <pre><code>CREATE DATABASE sonarqube OWNER sonar;\n</code></pre> <p>grant all privileges to sonar user on sonarqube Database.</p> <pre><code>grant all privileges on DATABASE sonarqube to sonar;\n</code></pre> <p>Exit from the psql shell:</p> <pre><code>\\q\n</code></pre> <p>Switch back to the sudo user by running the exit command.</p> <pre><code>exit\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#step-3-how-to-install-sonarqube-on-ubuntu-2004-lts","title":"Step #3: How to Install SonarQube on Ubuntu 20.04 LTS","text":"<p>Download sonaqube installer files archieve To download latest version of visit SonarQube (https://www.sonarsource.com/products/sonarqube/downloads/)</p> <pre><code>cd /tmp\nsudo https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.9.1.44547.zip\n</code></pre> <p>Unzip the archeve setup to /opt directory</p> <pre><code>sudo unzip sonarqube-8.9.1.zip -d /opt\n</code></pre> <p>Move extracted setup to /opt/sonarqube directory</p> <pre><code>sudo mv /opt/sonarqube-8.9.1 /opt/sonarqube\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#step-4-configure-sonarqube","title":"Step #4: Configure SonarQube","text":"<p>We can\u2019t run Sonarqube as a root user , if you run using root user it stops automatically. We have found solution on this to create saparate group and user to run sonarqube.</p>"},{"location":"Devops/tools/CQT/Sonarqube.html#1-create-group-and-user","title":"1. Create Group and User:","text":"<p>Create a group as sonar</p> <pre><code>sudo groupadd sonar\n</code></pre> <p>Now add the user with directory access</p> <pre><code>sudo useradd -c \"user to run SonarQube\" -d /opt/sonarqube -g sonar sonar \nsudo chown sonar:sonar /opt/sonarqube -R\n</code></pre> <p>Open the SonarQube configuration file using your favorite text editor.</p> <pre><code>sudo nano /opt/sonarqube/conf/sonar.properties\n</code></pre> <p>Find the following lines.</p> <pre><code>#sonar.jdbc.username=\n#sonar.jdbc.password=\n</code></pre> <p>Uncomment and Type the PostgreSQL Database username and password which we have created in above steps and add the postgres connection string.</p> <pre><code>vi /opt/sonarqube/conf/sonar.properties\n\n#--------------------------------------------------------------------------------------------------\n\n# DATABASE\n\n#\n\n# IMPORTANT:\n\n# - The embedded H2 database is used by default. It is recommended for tests but not for\n\n#   production use. Supported databases are Oracle, PostgreSQL and Microsoft SQLServer.\n\n# - Changes to database connection URL (sonar.jdbc.url) can affect SonarSource licensed products.\n\n# User credentials.\n\n# Permissions to create tables, indices and triggers must be granted to JDBC user.\n\n# The schema must be created first.\n\nsonar.jdbc.username=sonar\nsonar.jdbc.password=sonar\nsonar.jdbc.url=jdbc:postgresql://localhost:5432/sonarqube\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#2-start-sonarqube","title":"2. Start SonarQube:","text":"<p>Now to start SonarQube we need to do following: Switch to sonar user</p> <pre><code>sudo su sonar\n</code></pre> <p>Move to the script directory</p> <pre><code>cd /opt/sonarqube/bin/linux-x86-64/\n</code></pre> <p>Run the script to start SonarQube</p> <pre><code>./sonar.sh start\n</code></pre> <p>We can also add this in service and can run as a service.</p>"},{"location":"Devops/tools/CQT/Sonarqube.html#3-check-sonarqube-running-status","title":"3. Check SonarQube Running Status:","text":"<p>To check if sonaqube is running enter below command,</p> <pre><code>./sonar.sh status\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#4-sonarqube-logs","title":"4. SonarQube Logs:","text":"<p>To check sonarqube logs, navigate to /opt/sonarqube/logs/sonar.log directory</p> <pre><code>tail /opt/sonarqube/logs/sonar.log\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#step-5-configure-systemd-service","title":"Step #5: Configure Systemd service","text":"<p>First stop the SonarQube service as we started manually using above steps Navigate to the SonarQube installed path</p> <pre><code>cd /opt/sonarqube/bin/linux-x86-64/\n</code></pre> <p>Run the script to start SonarQube</p> <pre><code>./sonar.sh stop\n</code></pre> <p>Create a systemd service file for SonarQube to run as System Startup.</p> <pre><code>sudo vi /etc/systemd/system/sonar.service\n\nAdd the below lines,\n\n[Unit]\nDescription=SonarQube service\nAfter=syslog.target network.target\n\n[Service]\nType=forking\n\nExecStart=/opt/sonarqube/bin/linux-x86-64/sonar.sh start\nExecStop=/opt/sonarqube/bin/linux-x86-64/sonar.sh stop\n\nUser=sonar\nGroup=sonar\nRestart=always\n\nLimitNOFILE=65536\nLimitNPROC=4096\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Save and close the file. Now stop the sonarqube script earlier we started to run using as daemon. Start the Sonarqube daemon by running:</p> <pre><code>sudo systemctl start sonar\n</code></pre> <p>Enable the SonarQube service to automatically  at boot time System Startup.</p> <pre><code>sudo systemctl enable sonar\n</code></pre> <p>check if the sonarqube service is running,</p> <pre><code>sudo systemctl status sonar\n</code></pre>"},{"location":"Devops/tools/CQT/Sonarqube.html#step-6-access-sonarqube","title":"Step #6: Access SonarQube","text":"<p>To access the SonarQube using browser type server IP followed by port 9000.</p> <pre><code>http://server_IP:9000 OR http://localhost:9000\n</code></pre> <p>Login to SonarQube  with default administrator username and password is admin.</p>"},{"location":"Devops/tools/CQT/Sonarqube.html#ref","title":"Ref:","text":"<p>https://www.fosstechnix.com/how-to-install-sonarqube-on-ubuntu-20-04/</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html","title":"Hashicorp Vault","text":""},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#what-is-vault","title":"What is Vault?","text":"<p>HashiCorp Vault is an identity-based secrets and encryption management system.A secret is anything that you want to tightly control access to, such as API encryption keys, passwords, and certificates. Vault provides encryption services that are gated by authentication and authorization methods. Using Vault\u2019s UI, CLI, or HTTP API, access to secrets and other sensitive data can be securely stored and managed, tightly controlled (restricted), and auditable.</p> <p>A modern system requires access to a multitude of secrets, including database credentials, API keys for external services, credentials for service-oriented architecture communication, etc. It can be difficult to understand who is accessing which secrets, especially since this can be platform-specific. Adding on key rolling, secure storage, and detailed audit logs is almost impossible without a custom solution. This is where Vault steps in.</p> <p>Vault validates and authorizes clients (users, machines, apps) before providing them access to secrets or stored sensitive data.</p> <p></p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#how-does-vault-work","title":"How does Vault work?","text":"<p>Vault works primarily with tokens and a token is associated to the client's policy. Each policy is path-based and policy rules constrains the actions and accessibility to the paths for each client. With Vault, you can create tokens manually and assign them to your clients, or the clients can log in and obtain a token. The illustration below displays Vault's core workflow.</p> <p></p> <p>The core Vault workflow consists of four stages:</p> <ul> <li>Authenticate: Authentication in Vault is the process by which a client supplies information that Vault uses to determine if they are who they say they are. Once the client is authenticated against an auth method, a token is generated and associated to a policy.</li> <li>Validation: Vault validates the client against third-party trusted sources, such as Github, LDAP, AppRole, and more.</li> <li>Authorize: A client is matched against the Vault security policy. This policy is a set of rules defining which API endpoints a client has access to with its Vault token. Policies provide a declarative way to grant or forbid access to certain paths and operations in Vault.</li> <li>Access: Vault grants access to secrets, keys, and encryption capabilities by issuing a token based on policies associated with the client\u2019s identity. The client can then use their Vault token for future operations.</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#why-vault","title":"Why Vault?","text":"<p>Most enterprises today have credentials sprawled across their organizations. Passwords, API keys, and credentials are stored in plain text, app source code, config files, and other locations. Because these credentials live everywhere, the sprawl can make it difficult and daunting to really know who has access and authorization to what. Having credentials in plain text also increases the potential for malicious attacks, both by internal and external attackers.</p> <p>Vault was designed with these challenges in mind. Vault takes all of these credentials and centralizes them so that they are defined in one location, which reduces unwanted exposure to credentials. But Vault takes it a few steps further by making sure users, apps, and systems are authenticated and explicitly authorized to access resources, while also providing an audit trail that captures and preserves a history of clients' actions.</p> <p>The key features of Vault are:</p> <ul> <li> <p>Secure Secret Storage: Arbitrary key/value secrets can be stored in Vault. Vault encrypts these secrets prior to writing them to persistent storage, so gaining access to the raw storage isn't enough to access your secrets. Vault can write to disk, Consul, and more.</p> </li> <li> <p>Dynamic Secrets: Vault can generate secrets on-demand for some systems, such as AWS or SQL databases. For example, when an application needs to access an S3 bucket, it asks Vault for credentials, and Vault will generate an AWS keypair with valid permissions on demand. After creating these dynamic secrets, Vault will also automatically revoke them after the lease is up.</p> </li> <li> <p>Data Encryption: Vault can encrypt and decrypt data without storing it. This allows security teams to define encryption parameters and developers to store encrypted data in a location such as a SQL database without having to design their own encryption methods.</p> </li> <li> <p>Leasing and Renewal: All secrets in Vault have a lease associated with them. At the end of the lease, Vault will automatically revoke that secret. Clients are able to renew leases via built-in renew APIs.</p> </li> <li> <p>Revocation: Vault has built-in support for secret revocation. Vault can revoke not only single secrets, but a tree of secrets, for example all secrets read by a specific user, or all secrets of a particular type. Revocation assists in key rolling as well as locking down systems in the case of an intrusion.</p> </li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#what-is-hcp-vault","title":"What is HCP Vault?","text":"<p>HashiCorp Cloud Platform (HCP) Vault is a hosted version of Vault, which is operated by HashiCorp to allow organizations to get up and running quickly. HCP Vault uses the same binary as self-hosted Vault, which means you will have a consistent user experience. You can use the same Vault clients to communicate with HCP Vault as you use to communicate with a self-hosted Vault.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#use-cases","title":"Use Cases","text":""},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#general-secret-storage","title":"General Secret Storage","text":"<p>As workloads become more and more ephemeral and short-lived, having long-lived static credentials pose a big security threat vector. What if credentials are accidentally leaked, or an employee leaves with their post it notes that contain the AWS access key, or someone checks their S3 access token to a public GH repo? With Vault, you can generate short-lived, just-in-time credentials that are automatically revoked when their time expires. This means users and security teams do not have to worry about manually revoking or changing these credentials.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#static-secrets","title":"Static Secrets","text":"<p>Credentials can be long-lived and static, where they don't change or are changed infrequently. Vault can store these secrets bedhind its cryptographic barrier, and clients can request them to use in their applications.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#dynamic-secrets","title":"Dynamic Secrets","text":"<p>The key value with secrets storage is the ability to dynamically generate credentials. These credentials are created when clients need them. Vault can also manage the lifecycle of these credentials, including but not limited to, deleting them after a defined period of time.</p> <p>In addition to database credential management, Vault can manage your Active Directory accounts, SSH keys, PKI certificates and more.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#dynamic-secrets-database-secrets-engine","title":"Dynamic Secrets: Database Secrets Engine","text":"<p>Vault can generate secrets on-demand for some systems. For example, when an app needs to access an Amazon S3 bucket, it asks Vault for AWS credentials. Vault will generate an AWS credential granting permissions to access the S3 bucket. In addition, Vault will automatically revoke this credential after the time-to-live (TTL) expires.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#challenge","title":"Challenge","text":"<p>Data protection is a top priority, and database credential rotation is a critical part of any data protection initiative. Each role has a different set of permissions granted to access the database. When a system is attacked by hackers, continuous credential rotation becomes necessary and needs to be automated.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#solution","title":"Solution","text":"<p>Applications ask Vault for database credentials rather than setting them as environment variables. The administrator specifies the TTL of the database credentials to enforce its validity so that they are automatically revoked when they are no longer used.</p> <p></p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#personas","title":"Personas","text":"<p>Involves two personas:</p> <ul> <li>admin with privileged permissions to configure secrets engines</li> <li>apps read the secrets from Vault</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#policy-requirements","title":"Policy requirements","text":"<p>Each persona requires a different set of capabilities. These are expressed in policies. If you are not familiar with policies. The admin tasks require these capabilities.</p> <pre><code># Mount secrets engines\npath \"sys/mounts/*\" {\n  capabilities = [ \"create\", \"read\", \"update\", \"delete\", \"list\" ]\n}\n\n# Configure the database secrets engine and create roles\npath \"database/*\" {\n  capabilities = [ \"create\", \"read\", \"update\", \"delete\", \"list\" ]\n}\n\n# Manage the leases\npath \"sys/leases/+/database/creds/readonly/*\" {\n  capabilities = [ \"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\" ]\n}\n\npath \"sys/leases/+/database/creds/readonly\" {\n  capabilities = [ \"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\" ]\n}\n\n# Write ACL policies\npath \"sys/policies/acl/*\" {\n  capabilities = [ \"create\", \"read\", \"update\", \"delete\", \"list\" ]\n}\n\n# Manage tokens for verification\npath \"auth/token/create\" {\n  capabilities = [ \"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\" ]\n}\n</code></pre> <p>The apps tasks require these capabilities.</p> <pre><code># Get credentials from the database secrets engine 'readonly' role.\npath \"database/creds/readonly\" {\n  capabilities = [ \"read\" ]\n}\n</code></pre>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#data-encryption","title":"Data Encryption","text":"<p>Many organizations seek solutions to encrypt/decrypt application data within a cloud or multi-datacenter environment; deploying cryptography and maintaining a complex key management infrastructure can be expensive and challenging to develop. Vault provides encryption as a service with centralized key management to simplify encrypting data in transit and stored across clouds and datacenters. Vault can encrypt/decrypt data stored elsewhere, essentially allowing applications to encrypt their data while storing it in the primary data store. Vault's security team manages and maintains the responsibility of the data encryption within the Vault environment, allowing developers to focus solely on encrypting/decrypting data as needed.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#resources","title":"Resources","text":"<ul> <li> <p>Try  Encryption as a Service: Transit Secrets Engine to learn the essential workings of the Transit secrets engine handles cryptographic functions on data in-transit.   https://developer.hashicorp.com/vault/tutorials/encryption-as-a-service</p> </li> <li> <p>For more advanced data protection, refer to the Advanced Data Protection tutorial series. Vault's Transform secrets engine handles secure data transformation and tokenization against provided input value.   https://developer.hashicorp.com/vault/tutorials/adp</p> </li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#identity-based-access","title":"Identity-Based Access","text":"<p>Organizations need a way to manage identity sprawl with the proliferation of different clouds, services, and systems- all with their identity providers. The risk of compromising an organization's security infrastructure increases as organizations are forced to manage multiple identity management systems as they try to implement solutions to unify a single logical identity across numerous cloud platforms. Different platforms support different methods and constructs for identity, making it difficult to recognize a user or identity across multiple forms of credentials.</p> <p>Vault solves this challenge by using a unified ACL system to broker access to systems and secrets and merges identities across providers. With identity-based access, organizations can leverage any trusted resource identity to regulate and manage system and application access, and authentication across various clouds, systems, and endpoints.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#resources_1","title":"Resources","text":"<ul> <li> <p>Try  Identity: Entities and Groups tutorial to learn how Vault's unified identity system works.   https://developer.hashicorp.com/vault/tutorials/auth-methods/identity</p> </li> <li> <p>Follow the Policies tutorial series to learn how Vault enforces role-based access control (RBAC) across multiple cloud environments.   https://developer.hashicorp.com/vault/tutorials/policies</p> </li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#key-management","title":"Key Management","text":"<p>Working with cloud providers requires that you use their security features, which involve encryption keys issued and stored by the provider in its own key management system (KMS). You may also have a requirement to maintain root of trust and control of the encryption key lifecycle, both within and outside of the cloud. The Vault Key Management Secrets Engine provides a consistent workflow for distribution and lifecycle management of cloud provider keys, allowing organizations to maintain centralized control of their keys in Vault while leveraging the cryptographic capabilities native to the KMS providers.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#resources_2","title":"Resources","text":"<ul> <li> <p>Try Key Management Secrets Engine with Azure Key Vault to enable management of the Key Vault key with the Key Management secrets engine.   https://developer.hashicorp.com/vault/tutorials/adp/key-management-secrets-engine-azure-key-vault</p> </li> <li> <p>Try our Key Management Secrets Engine with GCP Cloud KMS to enable management of the Key Value key with the Key Management secrets engine.   https://developer.hashicorp.com/vault/tutorials/adp/key-management-secrets-engine-azure-key-vault</p> </li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#vault-agent","title":"Vault Agent","text":"<p>A valid client token must accompany most requests to Vault. This includes all API requests, as well as via the Vault CLI and other libraries. Therefore, Vault clients must first authenticate with Vault to acquire a token. Vault provides several different authentication methods to assist in delivering this initial token.</p> <p></p> <p>If the client can securely acquire the token, all subsequent requests (e.g., request database credentials, read key/value secrets) are processed based on the trust established by a successful authentication.</p> <p>This means that client application must invoke the Vault API to authenticate with Vault and manage the acquired token, in addition to invoking the API to request secrets from Vault. This implies code changes to client applications along with additional testing and maintenance of the application.</p> <p>The following code example implements Vault API to authenticate with Vault through AppRole auth method, and then uses the returned client token to read secrets at kv-v2/data/creds.</p> <pre><code>package main\n\nimport (\n    ...snip...\n    vault \"github.com/hashicorp/vault/api\"\n)\n\n// Fetches a key-value secret (kv-v2) after authenticating via AppRole\nfunc getSecretWithAppRole() (string, error) {\n    config := vault.DefaultConfig()\n\n    client := vault.NewClient(config)\n    wrappingToken := ioutil.ReadFile(\"path/to/wrapping-token\")\n    unwrappedToken := client.Logical().Unwrap(strings.TrimSuffix(string(wrappingToken), \"\\n\"))\n\n    secretID := unwrappedToken.Data[\"secret_id\"]\n    roleID := os.Getenv(\"APPROLE_ROLE_ID\")\n\n    params := map[string]interface{}{\n        \"role_id\":   roleID,\n        \"secret_id\": secretID,\n    }\n    resp := client.Logical().Write(\"auth/approle/login\", params)\n    client.SetToken(resp.Auth.ClientToken)\n\n    secret, err := client.Logical().Read(\"kv-v2/data/creds\")\n    if err != nil {\n        return \"\", fmt.Errorf(\"unable to read secret: %w\", err)\n    }\n\n    data := secret.Data[\"data\"].(map[string]interface{})\n\n    ...snip...\n}\n</code></pre> <p>For some Vault deployments, making (and maintaining) these changes to applications may not be a problem, and may actually be preferred. This may be applied to scenarios where you have a small number of applications or you want to keep strict, customized control over how each application interacts with Vault. However, in other situations where you have a large number of applications, as in large enterprises, you may not have the resources or expertise to update and maintain the Vault integration code for every application. When third party applications are being deployed by the application, it is prohibited to add the Vault integration code.</p> <p>Vault Agent aims to remove this initial hurdle to adopt Vault by providing a more scalable and simpler way for applications to integrate with Vault.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#what-is-vault-agent","title":"What is Vault Agent?","text":"<p>Vault Agent is a client daemon that provides the following features:</p> <ul> <li> <p>Auto-Auth - Automatically authenticate to Vault and manage the token renewal process for locally-retrieved dynamic secrets.</p> </li> <li> <p>API Proxy - Allows Vault Agent to act as a proxy for Vault's API, optionally using (or forcing the use of) the Auto-Auth token.</p> </li> <li> <p>Caching - Allows client-side caching of responses containing newly created tokens and responses containing leased secrets generated off of these newly created tokens. The agent also manages the renewals of the cached tokens and leases.</p> </li> <li> <p>Windows Service - Allows running the Vault Agent as a Windows service.</p> </li> <li> <p>Templating - Allows rendering of user-supplied templates by Vault Agent, using the token generated by the Auto-Auth step.</p> </li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#auto-auth","title":"Auto-Auth","text":"<p>Vault Agent allows easy authentication to Vault in a wide variety of environments. Auto-Auth functionality takes place within an auto_auth configuration stanza.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#api-proxy","title":"API Proxy","text":"<p>Vault Agent can act as an API proxy for Vault, allowing you to talk to Vault's API via a listener defined for Agent. It can be configured to optionally allow or force the automatic use of the Auto-Auth token for these requests.</p> <p>API Proxy functionality takes place within a defined listener, and its behaviour can be configured with an api_proxy stanza.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#caching","title":"Caching","text":"<p>Vault Agent allows client-side caching of responses containing newly created tokens and responses containing leased secrets generated off of these newly created tokens.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#start-vault-agent","title":"Start Vault Agent","text":"<p>To run Vault Agent:</p> <ul> <li> <p>Download the Vault binary where the client application runs (virtual machine, Kubernetes pod, etc.)</p> </li> <li> <p>Create a Vault Agent configuration file. (See the Example Configuration section for an example configuration.)</p> </li> <li> <p>Start a Vault Agent with the configuration file.</p> </li> </ul> <p>Example:</p> <pre><code>vault agent -config=/etc/vault/agent-config.hcl\n</code></pre> <p>To get help, run:</p> <pre><code>vault agent -h\n</code></pre>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#example-configuration","title":"Example Configuration","text":"<p>An example configuration, with very contrived values, follows:</p> <pre><code>pid_file = \"./pidfile\"\n\nvault {\n  address = \"https://vault-fqdn:8200\"\n  retry {\n    num_retries = 5\n  }\n}\n\nauto_auth {\n  method \"aws\" {\n    mount_path = \"auth/aws-subaccount\"\n    config = {\n      type = \"iam\"\n      role = \"foobar\"\n    }\n  }\n\n  sink \"file\" {\n    config = {\n      path = \"/tmp/file-foo\"\n    }\n  }\n\n  sink \"file\" {\n    wrap_ttl = \"5m\"\n    aad_env_var = \"TEST_AAD_ENV\"\n    dh_type = \"curve25519\"\n    dh_path = \"/tmp/file-foo-dhpath2\"\n    config = {\n      path = \"/tmp/file-bar\"\n    }\n  }\n}\n\ncache {\n  // An empty cache stanza still enables caching\n}\n\napi_proxy {\n  use_auto_auth_token = true\n}\n\nlistener \"unix\" {\n  address = \"/path/to/socket\"\n  tls_disable = true\n\n  agent_api {\n    enable_quit = true\n  }\n}\n\nlistener \"tcp\" {\n  address = \"127.0.0.1:8100\"\n  tls_disable = true\n}\n\ntemplate {\n  source = \"/etc/vault/server.key.ctmpl\"\n  destination = \"/etc/vault/server.key\"\n}\n\ntemplate {\n  source = \"/etc/vault/server.crt.ctmpl\"\n  destination = \"/etc/vault/server.crt\"\n}\n</code></pre>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#secrets-engines","title":"Secrets Engines","text":"<p>Secrets engines are components which store, generate, or encrypt data. Secrets engines are incredibly flexible, so it is easiest to think about them in terms of their function. Secrets engines are provided some set of data, they take some action on that data, and they return a result.</p> <p>Some secrets engines simply store and read data - like encrypted Redis/Memcached. Other secrets engines connect to other services and generate dynamic credentials on demand. Other secrets engines provide encryption as a service, totp generation, certificates, and much more.</p> <p>Secrets engines are enabled at a path in Vault. When a request comes to Vault, the router automatically routes anything with the route prefix to the secrets engine. In this way, each secrets engine defines its own paths and properties. To the user, secrets engines behave similar to a virtual filesystem, supporting operations like read, write, and delete.</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#secrets-engines-lifecycle","title":"Secrets Engines Lifecycle","text":"<p>Most secrets engines can be enabled, disabled, tuned, and moved via the CLI or API.</p> <ul> <li>Enable - This enables a secrets engine at a given path. With a few exceptions, secrets engines can be enabled at multiple paths. Each secrets engine is isolated to its path. By default, they are enabled at their \"type\" (e.g. \"aws\" enables at aws/).</li> </ul> <pre><code>Case-sensitive: The path where you enable secrets engines is case-sensitive. For example, the KV secrets engine enabled at kv/ and KV/ are treated as two distinct instances of KV secrets engine.\n</code></pre> <ul> <li> <p>Disable - This disables an existing secrets engine. When a secrets engine is disabled, all of its secrets are revoked (if they support it), and all the data stored for that engine in the physical storage layer is deleted.</p> </li> <li> <p>Move - This moves the path for an existing secrets engine. This process revokes all secrets, since secret leases are tied to the path where they were created. The configuration data stored for the engine persists through the move.</p> </li> <li> <p>Tune - This tunes global configuration for the secrets engine such as the TTLs.</p> </li> </ul> <p>Once a secrets engine is enabled, you can interact with it directly at its path according to its own API. Use vault path-help to determine the paths it responds to.</p> <p>Note that mount points cannot conflict with each other in Vault. There are two broad implications of this fact. The first is that you cannot have a mount which is prefixed with an existing mount. The second is that you cannot create a mount point that is named as a prefix of an existing mount. As an example, the mounts foo/bar and foo/baz can peacefully coexist with each other whereas foo and foo/baz cannot</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#barrier-view","title":"Barrier View","text":"<p>Secrets engines receive a barrier view to the configured Vault physical storage. This is a lot like a chroot.</p> <p>When a secrets engine is enabled, a random UUID is generated. This becomes the data root for that engine. Whenever that engine writes to the physical storage layer, it is prefixed with that UUID folder. Since the Vault storage layer doesn't support relative access (such as ../), this makes it impossible for an enabled secrets engine to access other data.</p> <p>This is an important security feature in Vault - even a malicious engine cannot access the data from any other engine.</p> <ul> <li>Active Directory Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/ad)</li> <li>AliCloud Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/alicloud)</li> <li>AWS Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/aws)</li> <li>Azure Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/azure)</li> <li>Consul Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/consul)</li> <li>Cubbyhole Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/cubbyhole)</li> <li>Databases:             - Cassandra Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/cassandra)             - Couchbase Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/couchbase)             - Elasticsearch Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/elasticdb)             - HANA Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/hanadb)             - IBM Db2 (https://developer.hashicorp.com/vault/docs/secrets/databases/db2)             - InfluxDB Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/influxdb)             - MongoDB Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/mongodb)             - MongoDB Atlas Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/mongodbatlas)             - MSSQL Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/mssql)             - MySQL/MariaDB Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/mysql-maria)             - Oracle Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/oracle)             - PostgreSQL Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/postgresql)             - Redis Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/redis)             - Redis ElastiCache Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/rediselasticache)             - Redshift Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/redshift)             - Snowflake Database Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/databases/snowflake)             - Custom Database Secrets Engines (https://developer.hashicorp.com/vault/docs/secrets/databases/custom)</li> <li>Google Cloud Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/gcp)</li> <li>Google Cloud KMS Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/gcpkms)</li> <li>Identity Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/identity)             - Identity Tokens (https://developer.hashicorp.com/vault/docs/secrets/identity/identity-token)             - OIDC Identity Provider (https://developer.hashicorp.com/vault/docs/secrets/identity/oidc-provider)</li> <li>Key Management Secrets Engine(ENTERPRISE) (https://developer.hashicorp.com/vault/docs/secrets/key-management)             - Azure Key Vault (https://developer.hashicorp.com/vault/docs/secrets/key-management/azurekeyvault)             - AWS KMS (https://developer.hashicorp.com/vault/docs/secrets/key-management/awskms)             - GCP Cloud KMS (https://developer.hashicorp.com/vault/docs/secrets/key-management/gcpkms)</li> <li>KV Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/kv)             - KV Secrets Engine - Version 1 (https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v1)             - KV Secrets Engine - Version 2 (https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2)</li> <li>KMIP Secrets Engine(ENTERPRISE) (https://developer.hashicorp.com/vault/docs/secrets/kmip)</li> <li>Kubernetes Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/kubernetes)</li> <li>MongoDB Atlas Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/mongodbatlas)</li> <li>Nomad Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/nomad)</li> <li>LDAP Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/ldap)</li> <li>PKI Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/pki)             - PKI Secrets Engine - Setup and Usage (https://developer.hashicorp.com/vault/docs/secrets/pki/setup)             - PKI Secrets Engine - Quick Start - Root CA Setup (https://developer.hashicorp.com/vault/docs/secrets/pki/quick-start-root-ca)             - PKI Secrets Engine - Quick Start - Intermediate CA Setup (https://developer.hashicorp.com/vault/docs/secrets/pki/quick-start-intermediate-ca)             - PKI Secrets Engine - Considerations (https://developer.hashicorp.com/vault/docs/secrets/pki/considerations)             - PKI Secrets Engine - Rotation Primitives (https://developer.hashicorp.com/vault/docs/secrets/pki/rotation-primitives)</li> <li>RabbitMQ Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/rabbitmq)</li> <li>SSH Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/ssh)             - Signed SSH Certificates (https://developer.hashicorp.com/vault/docs/secrets/ssh/signed-ssh-certificates)             - One-Time SSH Passwords (https://developer.hashicorp.com/vault/docs/secrets/ssh/one-time-ssh-passwords)</li> <li>Terraform Cloud Secret Backend (https://developer.hashicorp.com/vault/docs/secrets/terraform)</li> <li>TOTP Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/totp)</li> <li>Transform Secrets Engine(ENTERPRISE) (https://developer.hashicorp.com/vault/docs/secrets/transform)             - FF3-1 Tweak Usage Documentation (https://developer.hashicorp.com/vault/docs/secrets/transform/ff3-tweak-details)             - Tokenization Transform (ENTERPRISE) (https://developer.hashicorp.com/vault/docs/secrets/transform/tokenization)</li> <li>Transit Secrets Engine (https://developer.hashicorp.com/vault/docs/secrets/transit)             - Key Wrapping for Transit Key Import (https://developer.hashicorp.com/vault/docs/secrets/transit/key-wrapping-guide)</li> <li>Venafi Secrets Engine for HashiCorp Vault (https://developer.hashicorp.com/vault/docs/secrets/venafi)</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#auth-methods","title":"Auth Methods","text":"<ul> <li>AppRole Auth Method (https://developer.hashicorp.com/vault/docs/auth/approle)</li> <li>AliCloud Auth Method (https://developer.hashicorp.com/vault/docs/auth/alicloud)</li> <li>AWS Auth Method (https://developer.hashicorp.com/vault/docs/auth/aws)</li> <li>Azure Auth Method (https://developer.hashicorp.com/vault/docs/auth/azure)</li> <li>Cloud Foundry (CF) Auth Method (https://developer.hashicorp.com/vault/docs/auth/cf)</li> <li>GitHub Auth Method (https://developer.hashicorp.com/vault/docs/auth/github)</li> <li>Google Cloud Auth Method (https://developer.hashicorp.com/vault/docs/auth/gcp)</li> <li>JWT/OIDC Auth Method (https://developer.hashicorp.com/vault/docs/auth/jwt)                     - OIDC Provider Configuration (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers)                                                 - Auth0 (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/auth0)                                                 - Azure Active Directory (AAD) (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/azuread)                                                 - ForgeRock (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/forgerock)                                                 - Gitlab (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/gitlab)                                                 - Google (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/google)                                                 - Keycloak (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/keycloak)                                                 - Kubernetes (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/kubernetes)                                                 - Okta (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/okta)                                                 - SecureAuth (https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/secureauth)</li> <li>Kerberos Auth Method (https://developer.hashicorp.com/vault/docs/auth/kerberos)</li> <li>Kubernetes Auth Method (https://developer.hashicorp.com/vault/docs/auth/kubernetes)</li> <li>LDAP Auth Method (https://developer.hashicorp.com/vault/docs/auth/ldap)</li> <li>Login MFA (https://developer.hashicorp.com/vault/docs/auth/login-mfa)</li> <li>OCI Auth Method (https://developer.hashicorp.com/vault/docs/auth/oci)</li> <li>Okta Auth Method (https://developer.hashicorp.com/vault/docs/auth/okta)</li> <li>RADIUS Auth Method (https://developer.hashicorp.com/vault/docs/auth/radius)</li> <li>TLS Certificates Auth Method (https://developer.hashicorp.com/vault/docs/auth/cert)</li> <li>Token Auth Method (https://developer.hashicorp.com/vault/docs/auth/token)</li> <li>Userpass Auth Method (https://developer.hashicorp.com/vault/docs/auth/userpass)</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#audit-devices","title":"Audit Devices","text":"<p>Audit devices are the components in Vault that collectively keep a detailed log of all requests and response to Vault. Because every operation with Vault is an API request/response, when using a single audit device, the audit log contains every authenticated interaction with Vault, including errors.</p> <p>https://developer.hashicorp.com/vault/docs/audit</p> <ul> <li>File Audit Device (https://developer.hashicorp.com/vault/docs/audit/file)</li> <li>Syslog Audit Device (https://developer.hashicorp.com/vault/docs/audit/syslog)</li> <li>Socket Audit Device (https://developer.hashicorp.com/vault/docs/audit/socket)</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#plugin-system","title":"Plugin System","text":"<p>Vault supports 3 types of plugins; auth methods, secret engines, and database plugins. This concept allows both built-in and external plugins to be treated like building blocks. Any plugin can exist at multiple different mount paths. Different versions of a plugin may be at each location, with each version differing from Vault's version.</p> <p>A plugin is uniquely identified by its type (one of secret, auth, or database), name (e.g. aws), and version (e.g v1.0.0). An empty version implies either the built-in plugin or the single unversioned plugin that can be registered.</p> <p>https://developer.hashicorp.com/vault/docs/upgrading/plugins#plugin-upgrade-procedure</p> <ul> <li>External Plugin Architecture (https://developer.hashicorp.com/vault/docs/plugins/plugin-architecture)</li> <li>Plugin Development (https://developer.hashicorp.com/vault/docs/plugins/plugin-development)</li> <li>Plugin Management (https://developer.hashicorp.com/vault/docs/plugins/plugin-management)</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#vault-interoperability-matrix","title":"Vault Interoperability Matrix","text":"<p>Vault integrates with various appliances, platforms and applications for different use cases. Below are two tables indicating the partner\u2019s product that has been verified to work with Vault for Auto Unsealing / HSM Support and External Key Management.</p> <p>Auto Unseal and HSM Support was developed to aid in reducing the operational complexity of keeping the unseal key secure. This feature delegates the responsibility of securing the unseal key from users to a trusted device or service. At startup Vault will connect to the device or service implementing the seal and ask it to decrypt the root key Vault read from storage.</p> <p>Vault centrally manages and automates encryption keys across environments allowing customers to control their own encryption keys used in third party services or products.</p> <p>https://developer.hashicorp.com/vault/docs/interoperability-matrix</p>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#monitor-troubleshoot","title":"Monitor &amp; Troubleshoot","text":"<ul> <li>Troubleshooting Vault (https://developer.hashicorp.com/vault/tutorials/monitoring/troubleshooting-vault)</li> <li>Troubleshooting Vault on Kubernetes (https://developer.hashicorp.com/vault/tutorials/monitoring/kubernetes-troubleshooting)</li> <li>Diagnose Server Issues (https://developer.hashicorp.com/vault/tutorials/monitoring/diagnose-startup-issues)</li> <li>Use hcdiag with Vault (https://developer.hashicorp.com/vault/tutorials/monitoring/hcdiag-with-vault)</li> <li>Monitoring Vault Replication (https://developer.hashicorp.com/vault/tutorials/monitoring/monitor-replication)</li> <li>Vault Usage Metrics (https://developer.hashicorp.com/vault/tutorials/monitoring/usage-metrics)</li> <li>Monitor Telemetry &amp; Audit Device Log Data (https://developer.hashicorp.com/vault/tutorials/monitoring/monitor-telemetry-audit-splunk)</li> <li>Monitor Telemetry with Prometheus &amp; Grafana (https://developer.hashicorp.com/vault/tutorials/monitoring/monitor-telemetry-grafana-prometheus)</li> <li>Inspect Data in BoltDB  (https://developer.hashicorp.com/vault/tutorials/monitoring/inspect-data-boltdb)</li> <li>Inspecting Data in Consul Storage (https://developer.hashicorp.com/vault/tutorials/monitoring/inspecting-data-consul)</li> <li>Inspect Data in Integrated Storage (https://developer.hashicorp.com/vault/tutorials/monitoring/inspect-data-integrated-storage)</li> <li>Blocked Audit Devices (https://developer.hashicorp.com/vault/tutorials/monitoring/blocked-audit-devices)</li> <li>Query audit device logs (https://developer.hashicorp.com/vault/tutorials/monitoring/query-audit-device-logs)</li> <li>Troubleshoot Irrevocable Leases (https://developer.hashicorp.com/vault/tutorials/monitoring/troubleshoot-irrevocable-leases)</li> <li>Vault Cluster Lost Quorum Recovery (https://developer.hashicorp.com/vault/tutorials/monitoring/raft-lost-quorum)</li> <li>Operate Vault in Recovery Mode (https://developer.hashicorp.com/vault/tutorials/monitoring/recovery-mode)</li> <li>Telemetry Metrics Reference (https://developer.hashicorp.com/vault/tutorials/monitoring/telemetry-metrics-reference)</li> <li>Monitoring Vault with Datadog (https://developer.hashicorp.com/vault/tutorials/monitoring/monitoring-vault-with-datadog)</li> <li>Audit device logs and incident response with Elasticsearch (https://developer.hashicorp.com/vault/tutorials/monitoring/audit-elastic-incident-response)</li> </ul>"},{"location":"Security/Hashicorp-vault/Hashicorp-vault.html#app-integration","title":"App Integration","text":"<ul> <li>Secure Introduction of Vault Clients (https://developer.hashicorp.com/vault/tutorials/app-integration/secure-introduction)</li> <li>Use Consul Template and Envconsul with Vault (https://developer.hashicorp.com/vault/tutorials/app-integration/application-integration)</li> <li>AppRole With Terraform &amp; Chef (https://developer.hashicorp.com/vault/tutorials/app-integration/approle-trusted-entities)</li> <li>Java Application Demo (https://developer.hashicorp.com/vault/tutorials/app-integration/eaas-spring-demo)</li> <li>Transit Secrets Re-wrapping (https://developer.hashicorp.com/vault/tutorials/app-integration/eaas-transit-rewrap)</li> <li>Encrypting data with Transform secrets engine (https://developer.hashicorp.com/vault/tutorials/app-integration/transform-code-example)</li> <li>Using HashiCorp Vault C# Client with .NET Core (https://developer.hashicorp.com/vault/tutorials/app-integration/dotnet-httpclient)</li> <li>Using HashiCorp Vault Agent with .NET Core ( https://developer.hashicorp.com/vault/tutorials/app-integration/dotnet-vault-agent)</li> <li>Build Your Own Plugins (https://developer.hashicorp.com/vault/tutorials/app-integration/plugin-backends)</li> <li>Vault GitHub Actions (https://developer.hashicorp.com/vault/tutorials/app-integration/github-actions)</li> <li>Vault AWS Lambda Extension (https://developer.hashicorp.com/vault/tutorials/app-integration/aws-lambda)</li> <li>Introduction to the Vault AWS Lambda Extension (https://developer.hashicorp.com/vault/tutorials/app-integration/intro-vault-aws-lambda-extension)</li> </ul>"}]}